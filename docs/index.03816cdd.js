function t(t){return t&&t.__esModule?t.default:t}function e(t){return t&&t.__esModule?t.default:t}var n={};const a=Math.pow(2,-52),o=new Uint32Array(512);class r{static from(t,e=g,n=E){const a=t.length,o=new Float64Array(2*a);for(let r=0;r<a;r++){const a=t[r];o[2*r]=e(a),o[2*r+1]=n(a)}return new r(o)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:o,_hullHash:r}=this,i=t.length>>1;let s=1/0,l=1/0,u=-1/0,c=-1/0;for(let e=0;e<i;e++){const n=t[2*e],a=t[2*e+1];n<s&&(s=n),a<l&&(l=a),n>u&&(u=n),a>c&&(c=a),this._ids[e]=e}const d=(s+u)/2,h=(l+c)/2;let g,E,V,T=1/0;for(let e=0;e<i;e++){const n=m(d,h,t[2*e],t[2*e+1]);n<T&&(g=e,T=n)}const v=t[2*g],x=t[2*g+1];T=1/0;for(let e=0;e<i;e++){if(e===g)continue;const n=m(v,x,t[2*e],t[2*e+1]);n<T&&n>0&&(E=e,T=n)}let b=t[2*E],w=t[2*E+1],k=1/0;for(let e=0;e<i;e++){if(e===g||e===E)continue;const n=y(v,x,b,w,t[2*e],t[2*e+1]);n<k&&(V=e,k=n)}let _=t[2*V],B=t[2*V+1];if(k===1/0){for(let e=0;e<i;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];f(this._ids,this._dists,0,i-1);const e=new Uint32Array(i);let n=0;for(let t=0,a=-1/0;t<i;t++){const o=this._ids[t];this._dists[o]>a&&(e[n++]=o,a=this._dists[o])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(p(v,x,b,w,_,B)){const t=E,e=b,n=w;E=V,b=_,w=B,V=t,_=e,B=n}const A=function(t,e,n,a,o,r){const i=n-t,s=a-e,l=o-t,u=r-e,m=i*i+s*s,c=l*l+u*u,p=.5/(i*u-s*l);return{x:t+(u*m-s*c)*p,y:e+(i*c-l*m)*p}}(v,x,b,w,_,B);this._cx=A.x,this._cy=A.y;for(let e=0;e<i;e++)this._dists[e]=m(t[2*e],t[2*e+1],A.x,A.y);f(this._ids,this._dists,0,i-1),this._hullStart=g;let C=3;n[g]=e[V]=E,n[E]=e[g]=V,n[V]=e[E]=g,o[g]=0,o[E]=1,o[V]=2,r.fill(-1),r[this._hashKey(v,x)]=g,r[this._hashKey(b,w)]=E,r[this._hashKey(_,B)]=V,this.trianglesLen=0,this._addTriangle(g,E,V,-1,-1,-1);for(let i,s,l=0;l<this._ids.length;l++){const u=this._ids[l],m=t[2*u],c=t[2*u+1];if(l>0&&Math.abs(m-i)<=a&&Math.abs(c-s)<=a)continue;if(i=m,s=c,u===g||u===E||u===V)continue;let d=0;for(let t=0,e=this._hashKey(m,c);t<this._hashSize&&(d=r[(e+t)%this._hashSize],-1===d||d===n[d]);t++);d=e[d];let y,f=d;for(;y=n[f],!p(m,c,t[2*f],t[2*f+1],t[2*y],t[2*y+1]);)if(f=y,f===d){f=-1;break}if(-1===f)continue;let h=this._addTriangle(f,u,n[f],-1,-1,o[f]);o[u]=this._legalize(h+2),o[f]=h,C++;let T=n[f];for(;y=n[T],p(m,c,t[2*T],t[2*T+1],t[2*y],t[2*y+1]);)h=this._addTriangle(T,u,y,o[u],-1,o[T]),o[u]=this._legalize(h+2),n[T]=T,C--,T=y;if(f===d)for(;y=e[f],p(m,c,t[2*y],t[2*y+1],t[2*f],t[2*f+1]);)h=this._addTriangle(y,u,f,-1,o[f],o[y]),this._legalize(h+2),o[y]=h,n[f]=f,C--,f=y;this._hullStart=e[u]=f,n[f]=e[T]=u,n[u]=T,r[this._hashKey(m,c)]=u,r[this._hashKey(t[2*f],t[2*f+1])]=f}this.hull=new Uint32Array(C);for(let t=0,e=this._hullStart;t<C;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:a}=this;let r=0,i=0;for(;;){const s=n[t],l=t-t%3;if(i=l+(t+2)%3,-1===s){if(0===r)break;t=o[--r];continue}const u=s-s%3,m=l+(t+1)%3,c=u+(s+2)%3,p=e[i],y=e[t],f=e[m],h=e[c];if(d(a[2*p],a[2*p+1],a[2*y],a[2*y+1],a[2*f],a[2*f+1],a[2*h],a[2*h+1])){e[t]=h,e[s]=p;const a=n[c];if(-1===a){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,a),this._link(s,n[i]),this._link(i,c);const l=u+(s+1)%3;r<o.length&&(o[r++]=l)}else{if(0===r)break;t=o[--r]}}return i}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,a,o,r){const i=this.trianglesLen;return this._triangles[i]=t,this._triangles[i+1]=e,this._triangles[i+2]=n,this._link(i,a),this._link(i+1,o),this._link(i+2,r),this.trianglesLen+=3,i}}var i,s,l,u;function m(t,e,n,a){const o=t-n,r=e-a;return o*o+r*r}function c(t,e,n,a,o,r){const i=(a-e)*(o-t),s=(n-t)*(r-e);return Math.abs(i-s)>=33306690738754716e-32*Math.abs(i+s)?i-s:0}function p(t,e,n,a,o,r){return(c(o,r,t,e,n,a)||c(t,e,n,a,o,r)||c(n,a,o,r,t,e))<0}function d(t,e,n,a,o,r,i,s){const l=t-i,u=e-s,m=n-i,c=a-s,p=o-i,d=r-s,y=m*m+c*c,f=p*p+d*d;return l*(c*f-y*d)-u*(m*f-y*p)+(l*l+u*u)*(m*d-c*p)<0}function y(t,e,n,a,o,r){const i=n-t,s=a-e,l=o-t,u=r-e,m=i*i+s*s,c=l*l+u*u,p=.5/(i*u-s*l),d=(u*m-s*c)*p,y=(i*c-l*m)*p;return d*d+y*y}function f(t,e,n,a){if(a-n<=20)for(let o=n+1;o<=a;o++){const a=t[o],r=e[a];let i=o-1;for(;i>=n&&e[t[i]]>r;)t[i+1]=t[i--];t[i+1]=a}else{let o=n+1,r=a;h(t,n+a>>1,o),e[t[n]]>e[t[a]]&&h(t,n,a),e[t[o]]>e[t[a]]&&h(t,o,a),e[t[n]]>e[t[o]]&&h(t,n,o);const i=t[o],s=e[i];for(;;){do{o++}while(e[t[o]]<s);do{r--}while(e[t[r]]>s);if(r<o)break;h(t,o,r)}t[n+1]=t[r],t[r]=i,a-o+1>=r-n?(f(t,e,o,a),f(t,e,n,r-1)):(f(t,e,n,r-1),f(t,e,o,a))}}function h(t,e,n){const a=t[e];t[e]=t[n],t[n]=a}function g(t){return t[0]}function E(t){return t[1]}i=n,s="default",l=function(){return r},Object.defineProperty(i,s,{get:l,enumerable:!0}),u=n,Object.defineProperty(u,"__esModule",{value:!0});var V=e(n);const T=t=>t.reduce(((t,e)=>t.concat(e)),[]),v=t=>({data:new Float32Array(T(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),x=t=>"folder"===t.type||"sprite"===t.type,b=(t,e,n=[])=>{for(const a of t){e(a,n);for(const t of a.mutationVectors)e(t,[...n,a]);"folder"===a.type&&b(a.items,e,[...n,a])}},w={translate:1,stretch:2,rotate:3,deform:4,opacity:5},k=(t,e)=>{const n=t[t.length-1];if(x(n)){const a=e?n.mutationVectors.indexOf(e):-1;if(a>0)return n.mutationVectors[a-1];for(let n=t.length-(e?2:1);n>=0;n--){const e=t[n];if(e&&x(e)&&e.mutationVectors.length>0)return e.mutationVectors[e.mutationVectors.length-1]}}return null},_=t=>{const e=t.controls.map((t=>t.name));return t.animations.map((t=>{const n=[],a=[];return t.keyframes.reduce(((t,e)=>(e.event&&a.push([e.time,e.event]),t.concat(Object.keys(e.controlValues)))),[]).filter(((t,e,n)=>n.indexOf(t)===e)).forEach((a=>{const o=[];t.keyframes.forEach((t=>{const e=t.controlValues[a];void 0!==e&&o.push([t.time,e])})),n.push([e.indexOf(a),new Float32Array(T(o))])})),{name:t.name,duration:0===t.keyframes.length?0:t.keyframes[t.keyframes.length-1].time,looping:t.looping,tracks:n,events:a}}))};var B=t=>{if("1.0"!==t.version)throw new Error("Only version 1.0 files are supported");const e=[],n=[],a=[];b(t.shapes,(t=>{if("sprite"!==t.type)return;const o=(t=>{let e=1/0,n=-1/0,a=1/0,o=-1/0;return t.points.forEach((([t,r])=>{e=t<e?t:e,n=t>n?t:n,a=r<a?r:a,o=r>o?r:o})),[(e+n)/2,(a+o)/2]})(t),r=(i=t.points,V.from(i).triangles);var i;const s=[...t.translate,.1*e.length],l=n.length;e.push({name:t.name,start:2*a.length,amount:r.length,mutator:0,x:s[0],y:s[1],z:1e-4*s[2]-.9}),t.points.forEach((([t,e])=>{n.push([t-o[0],e-o[1],t,e])})),r.forEach((t=>{a.push(t+l)}))}));const o=(t=>{const e=[],n=[],a={};b(t,((t,o)=>{if((t=>"deform"===t.type||"rotate"===t.type||"translate"===t.type||"stretch"===t.type||"opacity"===t.type)(t)){const i=[w[(r=t).type],r.origin[0],r.origin[1],"deform"===r.type||"translate"===r.type?r.radius:-1],s=n.length;n.push(i);const l=k(o,t),u=null===l?-1:e.findIndex((t=>t.name===l.name));e.push({name:t.name,index:s,parent:u}),a[t.name]=u}var r}));const o={};b(t,((t,n)=>{if(x(t)){const a=k(n.concat(t)),r=null===a?-1:e.findIndex((t=>t.name===a.name));o[t.name]=r}}));const r=new Int32Array(n.length);return e.forEach(((t,e)=>{r[e]=t.parent})),{mutatorMapping:a,parentList:r,vectorSettings:n,shapeMutatorMapping:o}})(t.shapes),r=o.parentList.length,i=Object.keys(o.mutatorMapping),s=[],l=new Float32Array(2*r);Object.entries(t.defaultFrame).forEach((([t,e])=>{const n=i.indexOf(t);-1!==n&&(l[2*n]=e[0],l[2*n+1]=e[1])}));const u=[],m=[],c=[];e.forEach((t=>{t.mutator=o.shapeMutatorMapping[t.name]})),e.sort(((t,e)=>(e.z||0)-(t.z||0)));const p=new Float32Array(t.controls.length),d=t.controls.reduce(((e,n,a)=>{const o=n.steps.reduce(((t,e)=>t.concat(Object.keys(e).filter((e=>!t.includes(e))))),[]);return s.push({name:n.name,steps:n.steps.length}),p[a]=t.controlValues[n.name],o.forEach((a=>{const o=i.indexOf(a),r=n.steps.map((t=>t[a])),s=(null==t?void 0:t.controls.findIndex((t=>t.name===n.name)))||0,l={name:n.name,controlIndex:s,valueStartIndex:0,values:r,stepType:0};e={...e,[o]:(e[o]||[]).concat(l)}})),e}),{});c.length=o.vectorSettings.length,c.fill([0,0]);let y=0;const f=[];return Object.entries(d).forEach((([t,e])=>{const n=parseInt(t,10);if(1===e.length){const t=e[0],a=o.vectorSettings[n][0];return void f.push({mutation:n,mixMultiply:a===w.stretch||a===w.opacity,control:t.controlIndex,stepType:t.stepType,trackX:new Float32Array(t.values.reduce(((t,e,n)=>t.concat(n,e[0])),[])),trackY:new Float32Array(t.values.reduce(((t,e,n)=>t.concat(n,e[1])),[]))})}if(0===e.length)return;for(const t of e)t.valueStartIndex=u.length,u.push(...t.values);const a=e.map((t=>[t.valueStartIndex,t.controlIndex,t.stepType]));c[n]=[m.length,a.length],y=Math.max(y,a.length),m.push(...a)})),{directControls:f,mutators:v(o.vectorSettings),mutatorParents:{data:o.parentList,length:o.parentList.length,stride:1},mutationValues:{data:l,length:o.parentList.length,stride:2},controlMutationValues:v(u),mutationValueIndices:v(m),controlMutationIndices:v(c),defaultControlValues:p,shapeVertices:v(n),shapeIndices:new Uint16Array(a),shapes:e,controls:s,maxIteration:y,animations:_(t)}},A=e("precision mediump float;\n#define GLSLIFY 1\nvarying mediump vec2 vTextureCoord;varying mediump float vOpacity;uniform sampler2D uSampler;uniform mediump vec2 uTextureDimensions;void main(void){highp vec2 A=vTextureCoord.xy/uTextureDimensions;mediump vec4 B=texture2D(uSampler,A);gl_FragColor=vec4(B.rgb*B.a*vOpacity,B.a*vOpacity);}"),C=e("#define GLSLIFY 1\n#define A 0.017453292519943295\nuniform vec2 viewport;uniform vec3 basePosition;uniform vec3 translate;uniform float mutation;uniform vec4 scale;uniform vec2 uMutValues[MAX_MUT];uniform vec4 uMutVectors[MAX_MUT];uniform int uMutParent[MAX_MUT];attribute vec2 coordinates;attribute vec2 aTextureCoord;varying lowp vec2 vTextureCoord;varying lowp float vOpacity;mat4 B=mat4(2./viewport.x,0,0,0,0,-2./viewport.y,0,0,0,0,1,0,-1,+1,0,1);vec2 C(int D,int E){vec2 F=uMutValues[D];vec2 G=uControlMutIndices[D];int H=int(G.x);int I=int(G.y);if(I==0){return F;}for(int J=0;J<MAX_IT;J++){if(J<I){vec3 K=uMutValueIndices[H+J];float L=uControlValues[int(K.y)];int M=int(floor(K.x+L));int N=int(ceil(K.x+L));float O=L-floor(L);vec2 P=uControlMutValues[M];vec2 Q=uControlMutValues[N];vec2 R=mix(P,Q,O);if(E==2||E==5){F*=R;}else{F+=R;}}else{return F;}}return F;}vec3 S(vec3 T,int D){vec4 mutation=uMutVectors[D];int E=int(mutation.x);vec2 U=C(D,E);vec2 V=mutation.yz;vec3 F=T;if(E==1){float W=1.;if(mutation.a>0.&&distance(T.xy,V)>mutation.a){W=0.;}F=vec3(T.xy+U*W,T.z);}if(E==2){F=vec3(V.xy+vec2((T.x-V.x)*U.x,(T.y-V.y)*U.y),T.z);}if(E==3){float X=U.x*A;mat2 Y=mat2(cos(X),sin(X),-sin(X),cos(X));F=vec3((T.xy-V)*Y+V,T.z);}if(E==4){float W=1.-clamp(distance(T.xy,V),0.,mutation.a)/mutation.a;F=vec3(T.xy+U*W,T.z);}if(E==5){float Z=U.x;F=vec3(T.xy,T.z*Z);}return F;}vec3 a(vec3 T,int D){int b=D;vec3 F=T;for(int J=0;J<MAX_MUT;J++){if(b==-1){return F;}F=S(F,b);b=uMutParent[b];}return F;}void main(){vec3 c=a(vec3(coordinates+translate.xy,1.),int(mutation));vec4 d=B*vec4((c.xy+basePosition.xy)*scale.x,translate.z-basePosition.z,1.);gl_Position=vec4((d.xy+scale.ba)*scale.y,d.z,1.);vTextureCoord=aTextureCoord.xy;vOpacity=c.z;}");const R=(t,e,n=0)=>{for(let a=0;a<t.length;a+=2)if(t[a]>e){const o=a>1?t[a-2]:0,r=a>1?t[a-1]:n,i=(e-o)/(t[a]-o);return r*(1-i)+t[a+1]*i}return t[t.length-1]},M={zoom:1,panX:0,panY:0,zIndex:0},L=t=>{const e=t.getContext("webgl",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"});if(!e)throw new Error("Canvas has no webgl context available");return e};const S=t=>{const e=L(t),n=[];let a=[],o=[];return{render:()=>{e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,t.width,t.height)},addAnimation:(r,i,s,l)=>{const u=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9][s],[m,c,p]=((t,e)=>{const n=t.createProgram();if(!n)throw new Error("Failed to create shader program");const a=(t=>`\n  #define MAX_MUT ${t.mutators.length}\n  #define MAX_IT ${t.maxIteration}\n  uniform vec2 uControlMutValues[${t.controlMutationValues.length}];\n  uniform vec3 uMutValueIndices[${t.mutationValueIndices.length}];\n  uniform vec2 uControlMutIndices[${t.controlMutationIndices.length}];\n  uniform float uControlValues[${t.controls.length}];\n  ${C}\n`)(e),o=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!o||!r)throw t.deleteProgram(n),t.deleteShader(o),t.deleteShader(r),new Error("Failed to create shader program");if(t.shaderSource(o,a),t.shaderSource(r,A),t.compileShader(o),t.compileShader(r),t.attachShader(n,o),t.attachShader(n,r),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw console.error("Link failed: "+t.getProgramInfoLog(n)),console.error("vs info-log: "+t.getShaderInfoLog(o)),console.error("fs info-log: "+t.getShaderInfoLog(r)),new Error("Could not initialise shaders");return[n,o,r]})(e,r);e.useProgram(m);const d=((t,e,n)=>{const a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.useProgram(e),t.uniform2f(t.getUniformLocation(e,"uTextureDimensions"),n.width,n.height),a})(e,m,i),y=e.getUniformLocation(m,"uMutParent");e.uniform1iv(y,r.mutatorParents.data);const f=((t,e)=>(n,a)=>{const o=t.getUniformLocation(e,n),r=a.stride;return 2==r?t.uniform2fv(o,a.data):3==r?t.uniform3fv(o,a.data):4==r&&t.uniform4fv(o,a.data),o})(e,m),h=f("uMutValues",r.mutationValues);f("uMutVectors",r.mutators),f("uControlMutValues",r.controlMutationValues),f("uMutValueIndices",r.mutationValueIndices),f("uControlMutIndices",r.controlMutationIndices);const g=e.getUniformLocation(m,"uControlValues");e.uniform1fv(g,r.defaultControlValues);const E=new Float32Array(r.defaultControlValues),V=new Float32Array(r.defaultControlValues),T=e.createBuffer(),v=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,T),e.bufferData(e.ARRAY_BUFFER,r.shapeVertices.data,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,v),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.shapeIndices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);const x=e.getUniformLocation(m,"basePosition"),b=e.getUniformLocation(m,"translate"),w=e.getUniformLocation(m,"mutation"),k=e.getUniformLocation(m,"viewport"),_=e.getUniformLocation(m,"scale"),B=e.getAttribLocation(m,"coordinates"),L=e.getAttribLocation(m,"aTextureCoord");let S=0,F=0,{zoom:I,panX:U,panY:P,zIndex:D}={...M,...l},z=[0,0],X=1;const O=[],N=r.animations.map((t=>t.name)),W=r.controls.map((t=>t.name)),H=r.animations.map((t=>t.looping)),Y=t=>{const e=O.findIndex((e=>e.name===t));if(-1===e)return;const n=O[e];let o=+new Date-n.startedAt+n.startAt;const i=r.animations[n.index];H[n.index]&&(o%=i.duration),O.splice(e,1);for(const[t,e]of i.tracks){const n=R(e,o,E[t]);E[t]=n}for(const e of a)e(t)},G=t=>{const e=W.indexOf(t);if(-1===e)throw new Error(`Control ${t} does not exist in ${W.join(",")}`);return e},j=t=>{const e=N.indexOf(t);if(-1===e)throw new Error(`Track ${t} does not exist in ${N.join(",")}`);return e},J={destroy:function(){e.deleteShader(c),e.deleteShader(p),e.deleteProgram(m),e.deleteTexture(d),e.deleteBuffer(T),e.deleteBuffer(v),n.splice(n.indexOf(J),1)},setLooping:function(t,e){const n=j(e);H[n]=t},startTrack:function(t,{startAt:e=0,speed:n=1}={}){const a=j(t),o=r.animations[a].tracks.map((([t])=>t));for(const t of O)r.animations[t.index].tracks.some((([t])=>o.includes(t)))&&Y(N[t.index]);O.push({name:t,index:a,startAt:e,speed:n,startedAt:+new Date,iterationStartedAt:+new Date-e/n,lastRender:0})},stopTrack:Y,setControlValue:(t,e)=>{const n=G(t),a=r.controls[n].steps-1;if(e<0||e>a)throw new Error(`Control ${t} value shoulde be between 0 and ${a}. ${e} is out of bounds.`);for(const t of O)r.animations[t.index].tracks.some((([t])=>t===n))&&Y(N[t.index]);E[n]=e,V[n]=e},getControlValue:t=>E[G(t)],setPanning:function(t,e){U=t,P=e},setZoom:function(t){I=t},setZIndex:function(t){D=t},render:function(){if(e.useProgram(m),e.bindBuffer(e.ARRAY_BUFFER,T),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,v),e.vertexAttribPointer(B,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),e.enableVertexAttribArray(B),e.vertexAttribPointer(L,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,2*Float32Array.BYTES_PER_ELEMENT),e.enableVertexAttribArray(L),t.width!==S||t.height!==F){const n=t.width,a=t.height,o=i.width/n>i.height/a;X=o?n/i.width:a/i.height,e.uniform2f(k,n,a),z=[n/2/X,a/2/X],S=t.width,F=t.height}e.uniform4f(_,X,I,U,P),e.activeTexture(u),e.bindTexture(e.TEXTURE_2D,d),e.uniform1i(e.getUniformLocation(m,"uSampler"),s),e.uniform3f(x,z[0],z[1],.01*D);const n=+new Date;for(const t of O){const e=(n-t.iterationStartedAt)*t.speed,a=r.animations[t.index],i=e%a.duration;if(a.duration<e){if(!H[t.index]){Y(a.name);continue}t.iterationStartedAt=n-i;for(const[t]of a.tracks)E[t]=V[t]}for(const[e,r]of a.events){const a=t.iterationStartedAt+e;if(a<n&&a>t.lastRender)for(const n of o)n(r,t.name,e)}t.lastRender=n;for(const[t,e]of a.tracks){const n=R(e,i,E[t]);V[t]=n}}const a=Float32Array.from(r.mutationValues.data);for(const t of r.directControls){const e=V[t.control],n=R(t.trackX,e),o=R(t.trackY,e);t.mixMultiply?(a[2*t.mutation]*=n,a[2*t.mutation+1]*=o):(a[2*t.mutation]+=n,a[2*t.mutation+1]+=o)}e.uniform2fv(h,a),e.uniform1fv(g,V);for(const t of r.shapes)e.uniform3f(b,t.x,t.y,t.z),e.uniform1f(w,t.mutator),e.drawElements(e.TRIANGLES,t.amount,e.UNSIGNED_SHORT,t.start)},onTrackStopped:function(t){return a=a.concat(t),()=>{a=a.filter((e=>e!==t))}},onEvent:function(t){return o=o.concat(t),()=>{o=o.filter((e=>e!==t))}}};return n.push(J),J},destroy:function(){for(const t of n)t.destroy();n.length=0}}};var F=null;var I=function(){return F||(F=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),F},U=t(I()+"scenery.8635c172.png"),P=t(JSON.parse('{"animations":[{"name":"Wheel","looping":true,"keyframes":[{"time":0,"controlValues":{"WheelRotate":1}},{"time":19200,"controlValues":{"WheelRotate":0}}]},{"name":"Tree","looping":true,"keyframes":[{"time":0,"controlValues":{"TreeLeaves1":0}},{"time":500,"controlValues":{"TreeLeaves2":0}},{"time":8000,"controlValues":{"TreeLeaves1":1}},{"time":8500,"controlValues":{"TreeLeaves2":1}},{"time":16000,"controlValues":{"TreeLeaves1":0,"TreeLeaves2":0.04}}]},{"name":"Bird","looping":true,"keyframes":[{"time":6000,"controlValues":{"Beak":0}},{"time":6200,"controlValues":{"Beak":1}},{"time":7000,"controlValues":{"Beak":1}},{"time":7200,"controlValues":{"Beak":0}}]},{"name":"Cloud1","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud1":0.5}},{"time":20000,"controlValues":{"Cloud1":1}},{"time":20001,"controlValues":{"Cloud1":0}},{"time":40000,"controlValues":{"Cloud1":0.5}}]},{"name":"Eyes","looping":true,"keyframes":[{"time":0,"controlValues":{"EyesBlink":1}},{"time":3000,"controlValues":{"EyesBlink":1}},{"time":3300,"controlValues":{"EyesBlink":0}},{"time":3500,"controlValues":{"EyesBlink":0}},{"time":3700,"controlValues":{"EyesBlink":1}}]},{"name":"ButterflyWings","looping":true,"keyframes":[{"time":300,"controlValues":{"ButterflyWings":1}},{"time":600,"controlValues":{"ButterflyWings":0}}]},{"name":"Smoke","looping":true,"keyframes":[{"time":0,"controlValues":{"Rook":0,"Smoke":0}},{"time":10000,"controlValues":{"Rook":1,"Smoke":1}}]},{"name":"Cloud2","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud2":0.8}},{"time":30000,"controlValues":{"Cloud2":0}},{"time":30001,"controlValues":{"Cloud2":1}},{"time":40000,"controlValues":{"Cloud2":0.8}}]},{"name":"Cloud3","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud3":0.2}},{"time":10000,"controlValues":{"Cloud3":0}},{"time":10001,"controlValues":{"Cloud3":1}},{"time":40000,"controlValues":{"Cloud3":0.2}}]},{"name":"WheelBlades","looping":true,"keyframes":[{"time":0,"controlValues":{"WheelBlades":0}},{"time":1600,"controlValues":{"WheelBlades":1}}]},{"name":"Water","looping":true,"keyframes":[{"time":0,"controlValues":{"Bubble":1.6,"Bubble2":0.9,"Bubble3":0.3}},{"time":400,"controlValues":{"Bubble":2}},{"time":401,"controlValues":{"Bubble":0}},{"time":1600,"controlValues":{"Bubble2":1.6,"Bubble3":0.9,"Bubble":0.3}},{"time":2000,"controlValues":{"Bubble2":2}},{"time":2001,"controlValues":{"Bubble2":0}},{"time":3200,"controlValues":{"Bubble3":1.6,"Bubble":0.9,"Bubble2":0.3}},{"time":3600,"controlValues":{"Bubble3":2}},{"time":3601,"controlValues":{"Bubble3":0}},{"time":4800,"controlValues":{"Bubble2":0.9,"Bubble3":0.3,"Bubble":1.6}}]}],"controlValues":{"WheelRotate":0.78,"TreeLeaves1":0,"TreeLeaves2":0.19,"Beak":0,"Cloud1":0.5,"EyesBlink":1,"ButterflyWings":0,"Rook":1,"Cloud2":0.8,"Cloud3":1,"New Control":1,"Butterflyturn":1,"ButterflyZoom":1,"ButterflyX":0.49,"ButterflyY":0.29,"ButterflyTurn":0,"WheelBlades":0.66,"Smoke":0,"Buble":1.46,"Bubble":0.3,"Bubble2":0.9,"Bubble3":1.6},"controls":[{"name":"Bubble3","type":"slider","steps":[{"o":[-11,0]},{"o":[-77,49]},{"o":[-126,107]}]},{"name":"Bubble2","type":"slider","steps":[{"n":[-9,2]},{"n":[-75,51]},{"n":[-130,110]}]},{"name":"Bubble","type":"slider","steps":[{"m":[-19,0]},{"m":[-85,43]},{"m":[-149,115]}]},{"name":"WheelBlades","type":"slider","steps":[{"u":[0,0],"v":[1,0.8],"w":[0,0],"x":[1,0],"z":[0,0],"y":[1,1],"r":[0,0],"s":[0.65,1],"t":[11,0],"C":[33,0],"B":[1,0.03],"A":[0,0],"D":[43,0]},{"u":[-33,-19],"v":[1,0.7],"w":[10,0],"x":[-31,-65],"z":[13,0],"y":[1,0.75],"r":[-10,-83],"s":[0.66,0.05],"t":[0,0],"C":[17,0],"B":[1,-0.37],"A":[9,-88],"D":[-2,0]}]},{"name":"Smoke","type":"slider","steps":[{"I":[0,0]},{"I":[0,-128]}]},{"name":"ButterflyY","type":"slider","steps":[{"f":[0,-216]},{"f":[0,210]}]},{"name":"ButterflyX","type":"slider","steps":[{"f":[-400,0]},{"f":[200,0]}]},{"name":"ButterflyZoom","type":"slider","steps":[{"g":[1,1]},{"g":[0.5,0.5]}]},{"name":"ButterflyTurn","type":"slider","steps":[{"g":[1,1]},{"g":[-1,1]}]},{"name":"ButterflyWings","type":"slider","steps":[{"i":[1,1],"j":[1,1]},{"i":[1,-1.05],"j":[1,-0.4]}]},{"name":"EyesBlink","type":"slider","steps":[{"N":[1,1]},{"N":[0,0]}]},{"name":"Cloud1","type":"slider","steps":[{"K":[1200,0]},{"K":[-1300,0]}]},{"name":"Cloud2","type":"slider","steps":[{"L":[-2101,0]},{"L":[270,0]}]},{"name":"Cloud3","type":"slider","steps":[{"M":[-546,0]},{"M":[1753,0]}]},{"name":"Beak","type":"slider","steps":[{"e":[0,0],"d":[0,0]},{"e":[-19,0],"d":[7,0]}]},{"name":"TreeLeaves2","type":"slider","steps":[{"k":[-42,0],"b":[-11,0],"J":[-12,0],"O":[0,0]},{"k":[48,0],"b":[8,0],"J":[13,0],"O":[0,13]}]},{"name":"TreeLeaves1","type":"slider","steps":[{"l":[-27,0],"a":[-13,0],"c":[-6,0]},{"l":[40,0],"a":[12,0],"c":[11,0]}]},{"name":"WheelRotate","type":"slider","steps":[{"F":[0,0],"q":[0,0]},{"F":[360,0],"q":[360,0]}]}],"defaultFrame":{"p":[0.45,1],"E":[0.45,1],"q":[0,0],"F":[90,0],"l":[0,0],"k":[0,0],"d":[0,0],"e":[0,0],"a":[0,0],"b":[0,0],"c":[0,0],"N":[1,0],"i":[1,1],"j":[1,0.85],"h":[-41,0],"H":[37,0],"G":[23,0],"g":[1,1],"J":[0,0],"v":[1,1],"w":[0,0],"y":[1,0.7],"z":[10,0],"s":[1,0.53],"r":[-8,3],"t":[24,0],"B":[1,1],"A":[30,-25],"C":[0,0],"O":[0,-9]},"shapes":[{"type":"sprite","points":[[277,1220],[295,1149],[308,1110],[345,1126],[350,1160],[345,1201],[331,1226],[387,1236],[379,1191],[379,1138],[398,1097],[423,1071],[449,1103],[457,1134],[457,1167],[463,1211],[454,1240],[502,1244],[493,1212],[490,1173],[495,1127],[502,1087],[528,1079],[566,1097],[571,1139],[587,1175],[582,1211],[562,1240],[622,1177],[621,1146],[621,1111],[643,1079],[672,1109],[680,1147],[651,1178],[678,1195],[693,1138],[706,1124],[706,1088],[724,1090],[737,1112],[744,1135],[747,1169],[728,1198]],"translate":[429,-310],"mutationVectors":[{"type":"deform","origin":[289,-335],"name":"a","radius":73},{"type":"deform","origin":[453,-353],"name":"b","radius":83},{"type":"deform","origin":[600,-355],"name":"c","radius":66}],"name":"a"},{"name":"b","type":"folder","items":[{"type":"sprite","points":[[1119,1056],[1120,1068],[1171,1065],[1168,1055]],"translate":[112,-386],"mutationVectors":[{"type":"rotate","origin":[88,-386],"name":"d"}],"name":"c"},{"type":"sprite","points":[[1120,1091],[1120,1101],[1151,1101],[1152,1092]],"translate":[104,-384],"mutationVectors":[{"type":"rotate","origin":[90,-384],"name":"e"}],"name":"d"}],"mutationVectors":[]},{"name":"e","type":"folder","items":[{"type":"sprite","points":[[63,1352],[137,1356],[143,1311],[65,1308]],"translate":[760,222],"mutationVectors":[{"type":"stretch","origin":[753,241],"name":"i"}],"name":"f"},{"type":"sprite","points":[[61,1376],[61,1358],[130,1363],[130,1379]],"translate":[747,240],"mutationVectors":[],"name":"g"},{"type":"sprite","points":[[63,1352],[137,1356],[143,1311],[65,1308]],"translate":[757,222],"mutationVectors":[{"type":"stretch","origin":[752,243],"name":"j"}],"name":"h"}],"mutationVectors":[{"name":"f","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[765,236],"name":"g"},{"type":"rotate","origin":[754,244],"name":"h"}]},{"name":"i","type":"folder","items":[{"type":"sprite","points":[[2012,1214],[2016,1361],[2009,1423],[2010,1476],[2002,1510],[2019,1564],[2004,1586],[2000,1626],[2009,1656],[1994,1683],[1994,1716],[1959,1716],[1953,1683],[1955,1620],[1952,1566],[1955,1504],[1957,1433],[1966,1348],[1976,1279],[1975,1240],[1975,1220],[1952,1259],[1945,1283],[1944,1319],[1939,1347],[1932,1385],[1922,1417],[1914,1453],[1901,1483],[1900,1512],[1902,1548],[1911,1582],[1902,1605],[1904,1631],[1904,1663],[1877,1672],[1862,1649],[1861,1593],[1852,1545],[1857,1495],[1863,1458],[1864,1396],[1876,1347],[1861,1353],[1853,1390],[1849,1421],[1852,1453],[1842,1482],[1842,1510],[1846,1540],[1845,1579],[1845,1607],[1849,1635],[1842,1656],[1856,1699],[1833,1715],[1813,1699],[1807,1670],[1802,1632],[1801,1591],[1801,1553],[1803,1512],[1805,1475],[1808,1435],[1808,1397],[1814,1357],[1818,1336],[1802,1330],[1786,1364],[1777,1383],[1780,1407],[1789,1440],[1786,1471],[1769,1501],[1766,1522],[1773,1552],[1782,1589],[1778,1617],[1755,1627],[1736,1611],[1721,1571],[1724,1533],[1727,1499],[1729,1465],[1729,1427],[1733,1393],[1738,1364],[1743,1323],[1752,1294],[1760,1262],[1780,1252],[1811,1261],[1829,1265],[1865,1247],[1786,1229],[1728,1232],[1749,1680]],"translate":[883,-221],"mutationVectors":[{"type":"deform","origin":[906,-79],"name":"k","radius":298}],"name":"j"},{"type":"sprite","points":[[1442,1246],[1679,1233],[1654,1356],[1643,1500],[1640,1638],[1642,1721],[1632,1752],[1595,1746],[1579,1705],[1573,1638],[1568,1572],[1569,1508],[1573,1420],[1573,1383],[1564,1412],[1559,1458],[1551,1502],[1552,1545],[1550,1573],[1541,1615],[1540,1647],[1520,1664],[1502,1652],[1497,1617],[1496,1577],[1504,1536],[1504,1497],[1504,1462],[1516,1424],[1520,1388],[1506,1385],[1509,1425],[1498,1452],[1495,1473],[1492,1501],[1485,1513],[1493,1543],[1490,1576],[1469,1580],[1454,1568],[1446,1538],[1444,1500],[1454,1466],[1456,1442],[1451,1401],[1458,1363],[1463,1335],[1424,1274],[1422,1396],[1423,1483],[1427,1557],[1438,1617],[1687,1739],[1678,1603],[1675,1440]],"translate":[901,-220],"mutationVectors":[{"type":"deform","origin":[895,-93],"name":"l","radius":298}],"name":"k"}],"mutationVectors":[]},{"name":"l","type":"folder","items":[{"type":"sprite","points":[[947,1271],[1382,1271],[1409,1821],[962,1871]],"translate":[79,56],"mutationVectors":[],"name":"m"},{"name":"n","type":"folder","items":[{"type":"sprite","points":[[782,1778],[797,1755],[857,1773],[835,1804]],"translate":[95,171],"mutationVectors":[{"name":"m","type":"translate","origin":[0,0],"radius":-1}],"name":"o"},{"type":"sprite","points":[[782,1796],[755,1819],[800,1842],[823,1811]],"translate":[73,171],"mutationVectors":[{"name":"n","type":"translate","origin":[0,0],"radius":-1}],"name":"p"},{"type":"sprite","points":[[747,1839],[723,1861],[762,1883],[781,1863]],"translate":[71,172],"mutationVectors":[{"name":"o","type":"translate","origin":[71,172],"radius":-1}],"name":"q"}],"mutationVectors":[]},{"type":"sprite","points":[[1076,1892],[1187,1888],[1192,1978],[1073,1983]],"translate":[33,193],"mutationVectors":[],"name":"r"},{"type":"sprite","points":[[340,1312],[703,1312],[703,1675],[340,1675]],"translate":[142,5],"mutationVectors":[{"type":"stretch","origin":[141,4],"name":"p"},{"type":"rotate","origin":[141,4],"name":"q"}],"name":"s"},{"type":"sprite","points":[[775,1306],[899,1303],[907,1682],[771,1678]],"translate":[102,6],"mutationVectors":[],"name":"t"},{"name":"u","type":"folder","items":[{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[48,56],"mutationVectors":[{"name":"r","type":"translate","origin":[48,56],"radius":-1},{"type":"stretch","origin":[-12,82],"name":"s"},{"name":"t","type":"translate","origin":[-12,31],"radius":6}],"name":"v"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[105,142],"mutationVectors":[{"name":"u","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[97,168],"name":"v"},{"name":"w","type":"translate","origin":[46,113],"radius":24}],"name":"w"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[71,122],"mutationVectors":[{"name":"x","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[62,152],"name":"y"},{"name":"z","type":"translate","origin":[14,98],"radius":16}],"name":"x"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[0,0],"mutationVectors":[{"name":"A","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[-60,27],"name":"B"},{"name":"C","type":"translate","origin":[-61,-27],"radius":8}],"name":"y"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[107,149],"mutationVectors":[{"name":"D","type":"translate","origin":[0,0],"radius":-1}],"name":"z"}],"mutationVectors":[]},{"type":"sprite","points":[[340,1312],[703,1312],[703,1675],[340,1675]],"translate":[48,0],"mutationVectors":[{"type":"stretch","origin":[48,0],"name":"E"},{"type":"rotate","origin":[48,0],"name":"F"}],"name":"A"}],"mutationVectors":[]},{"type":"sprite","points":[[814,123],[869,119],[930,128],[934,133],[936,264],[810,268]],"translate":[-151,-319],"mutationVectors":[],"name":"B"},{"type":"sprite","points":[[96,1696],[96,1440],[236,1440],[236,1696],[96,1664],[96,1472],[96,1504],[96,1536],[96,1568],[96,1600],[96,1632],[236,1472],[236,1504],[236,1536],[236,1568],[236,1600],[236,1632],[236,1664],[46,1696],[46,1630],[46,1440],[46,1568],[46,1504],[285,1440],[285,1504],[285,1568],[285,1632],[285,1696]],"translate":[-147,-384],"mutationVectors":[{"type":"deform","origin":[-227,-407],"name":"G","radius":64},{"type":"deform","origin":[-73,-496],"name":"H","radius":63},{"name":"I","type":"translate","origin":[0,0],"radius":-1}],"name":"C"},{"type":"sprite","points":[[1129,1236],[1129,1201],[1125,1160],[1141,1159],[1143,1197],[1145,1237],[1160,1238],[1158,1199],[1161,1160],[1175,1159],[1173,1200],[1174,1240]],"translate":[325,-77],"mutationVectors":[{"type":"deform","origin":[326,-121],"name":"J","radius":55}],"name":"D"},{"name":"E","type":"folder","items":[{"type":"sprite","points":[[1038,1136],[758,1140],[758,1070],[1021,1065]],"translate":[77,-454],"mutationVectors":[{"name":"K","type":"translate","origin":[0,0],"radius":-1}],"name":"F"},{"type":"sprite","points":[[1251,1049],[1258,1119],[1464,1119],[1447,1055]],"translate":[906,-458],"mutationVectors":[{"name":"L","type":"translate","origin":[0,0],"radius":-1}],"name":"G"},{"type":"sprite","points":[[62,1106],[63,1159],[237,1158],[231,1107]],"translate":[-603,-444],"mutationVectors":[{"name":"M","type":"translate","origin":[0,0],"radius":-1}],"name":"H"}],"mutationVectors":[]},{"type":"sprite","points":[[1416,1009],[1451,1020],[1456,1002],[1428,988]],"translate":[431,473],"mutationVectors":[{"type":"opacity","origin":[0,0],"name":"N"}],"name":"I"},{"type":"sprite","points":[[847,1204],[853,1204],[853,1217],[848,1217],[843,1220],[845,1229],[858,1227]],"translate":[-356,-247],"mutationVectors":[{"name":"O","type":"translate","origin":[-356,-241],"radius":9}],"name":"J"},{"type":"sprite","points":[[0,0],[0,1024],[2048,1024],[2048,0]],"translate":[0,0],"mutationVectors":[],"name":"K"}],"version":"1.0"}')),D=t(I()+"innkeeper.07de7d66.png"),z=t(JSON.parse('{"animations":[{"name":"Eye blink","looping":true,"keyframes":[{"time":2500,"controlValues":{"LeftEyeClose":0,"RightEyeClose":0}},{"time":2750,"controlValues":{"LeftEyeClose":1,"RightEyeClose":1}},{"time":3000,"controlValues":{"RightEyeClose":0,"LeftEyeClose":0}}]},{"name":"Look around","looping":true,"keyframes":[{"time":1000,"controlValues":{"LeftEye-x":0.18,"RightEye-x":0.24}},{"time":2000,"controlValues":{"LeftEye-x":1,"RightEye-x":1.02}},{"time":3980,"controlValues":{"LeftEye-x":1.02,"RightEye-x":1}},{"time":5000,"controlValues":{"RightEye-x":1.8,"LeftEye-x":1.84}},{"time":6000,"controlValues":{"LeftEye-x":0.98,"RightEye-x":1.06}},{"time":8000,"controlValues":{"RightEye-x":1,"LeftEye-x":1}}]},{"name":"Talking","looping":true,"keyframes":[{"time":1000,"controlValues":{"Mouth":0}},{"time":1340,"controlValues":{"Mouth":0.62}},{"time":1670,"controlValues":{"Mouth":0}},{"time":2120,"controlValues":{"Mouth":0}},{"time":2430,"controlValues":{"Mouth":0.68}},{"time":2790,"controlValues":{"Mouth":0.24}},{"time":3160,"controlValues":{"Mouth":1}},{"time":3470,"controlValues":{"Mouth":0}}]},{"name":"No","looping":false,"keyframes":[{"time":510,"controlValues":{"HeadTurn":0.38}},{"time":1270,"controlValues":{"HeadTurn":0}},{"time":2180,"controlValues":{"HeadTurn":1}},{"time":2990,"controlValues":{"HeadTurn":0}},{"time":3980,"controlValues":{"HeadTurn":0.48}}]},{"name":"HeadTilt","looping":true,"keyframes":[{"time":1000,"controlValues":{"HeadTilt":0.42}},{"time":6000,"controlValues":{"HeadTilt":0.53}},{"time":9000,"controlValues":{"HeadTilt":0.14}},{"time":12000,"controlValues":{"HeadTilt":0.43}}]},{"name":"EyeWink","looping":false,"keyframes":[{"time":500,"controlValues":{"RightEyeClose":0,"LeftEyeClose":0}},{"time":800,"controlValues":{"RightEyeClose":1}},{"time":1200,"controlValues":{"RightEyeClose":1}},{"time":1500,"controlValues":{"RightEyeClose":0}}]},{"name":"Eyebrows","looping":true,"keyframes":[{"time":990,"controlValues":{"Eyebrows":1.32}},{"time":3940,"controlValues":{"Eyebrows":0.92}},{"time":6820,"controlValues":{"Eyebrows":1.88}},{"time":10220,"controlValues":{"Eyebrows":0.88}}]},{"name":"StopTalking","looping":false,"keyframes":[{"time":310,"controlValues":{"Mouth":0}}]},{"name":"EyebrowReset","looping":false,"keyframes":[{"time":530,"controlValues":{"Eyebrows":1}}]}],"controlValues":{"Eyebrows":1,"HeadTilt":0.55,"HeadTurn":0.5,"Mouth":0,"RightEye-y":0.5,"LeftEye-y":0.5,"RightEye-x":1,"LeftEye-x":1,"RightEyeClose":0,"LeftEyeClose":0,"ArmTop":0,"ArmBottom":1,"ArmLeftTop":0,"ArmLeftBottom":1},"controls":[{"name":"ArmRightTop","type":"slider","steps":[{},{},{}]},{"name":"Eyebrows","type":"slider","steps":[{"i":[0,6],"j":[-10,0],"k":[0,6],"l":[10,0]},{"i":[0,0],"j":[0,0],"k":[0,0],"l":[0,0]},{"i":[0,0],"j":[9,0],"k":[0,0],"l":[-9,0]}]},{"name":"HeadTilt","type":"slider","steps":[{"B":[15,0],"c":[15,0],"f":[-34,0],"e":[-29,0],"A":[-75,0]},{"c":[-15,0],"B":[-15,0],"f":[32,0],"e":[42,0],"A":[103,0]}]},{"name":"HeadTurn","type":"slider","steps":[{"p":[-9,0],"q":[-2,0],"h":[7,0],"d":[3,0],"g":[2,0],"C":[-7,0],"y":[1,0],"v":[1,0]},{"h":[-5,0],"p":[3,0],"q":[7,0],"d":[-3,0],"g":[-2,0],"C":[10,0],"v":[-1,0],"y":[-1,0]}]},{"name":"Mouth","type":"slider","steps":[{"t":[1,1],"s":[1,1],"o":[0,0],"r":[0,0]},{"t":[1,1.1],"s":[1,3.85],"o":[0,-20],"r":[0,3]}]},{"name":"RightEye-y","type":"slider","steps":[{"v":[0,-8]},{"v":[0,11]}]},{"name":"LeftEye-y","type":"slider","steps":[{"y":[0,-7]},{"y":[0,11]}]},{"name":"RightEye-x","type":"slider","steps":[{"v":[-7,0],"w":[0.85,1]},{"v":[1,0],"w":[1,1]},{"v":[13,0],"w":[0.85,1]}]},{"name":"LeftEye-x","type":"slider","steps":[{"y":[-12,0],"z":[0.85,1]},{"z":[1,1],"y":[0,0]},{"y":[9,0],"z":[0.85,1]}]},{"name":"RightEyeClose","type":"slider","steps":[{"n":[1,1],"u":[0,0]},{"u":[0,48],"n":[1,-1.2]}]},{"name":"LeftEyeClose","type":"slider","steps":[{"x":[0,0],"m":[1,1]},{"m":[1,-1.1],"x":[0,50]}]}],"defaultFrame":{"u":[0,-29],"n":[1,1],"w":[1,1],"v":[0,0],"x":[0,-25],"m":[1,1],"z":[1,1],"y":[0,0],"t":[1,1],"s":[1,0.25],"o":[0,0],"c":[-1,0],"B":[0,0],"f":[0,0],"e":[0,0],"A":[0,0],"j":[0,0],"i":[0,0],"l":[0,0],"k":[0,0],"a":[97,0],"b":[16,0]},"shapes":[{"name":"a","type":"folder","items":[{"type":"sprite","points":[[92,688],[139,676],[186,690],[173,869],[70,764],[144,904],[94,908]],"translate":[277,593],"mutationVectors":[],"name":"b"},{"type":"sprite","points":[[452,597],[529,600],[413,697],[435,747],[516,759],[537,704]],"translate":[271,719],"mutationVectors":[],"name":"c"}],"mutationVectors":[]},{"name":"d","type":"folder","items":[{"type":"sprite","points":[[80,1054],[183,1046],[202,1203],[182,1283],[123,1289],[83,1174]],"translate":[-230,584],"mutationVectors":[],"name":"e"},{"type":"sprite","points":[[212,1432],[229,1591],[94,1596],[109,1435]],"translate":[-224,748],"mutationVectors":[],"name":"f"}],"mutationVectors":[{"type":"rotate","origin":[-245,483],"name":"a"}]},{"type":"sprite","points":[[552,363],[633,363],[635,1808],[770,2028],[725,2040],[552,2010],[503,1913]],"translate":[157,958],"mutationVectors":[{"type":"rotate","origin":[128,682],"name":"b"}],"name":"g"},{"name":"h","type":"folder","items":[{"type":"sprite","points":[[1013,495],[1023,467],[1021,419],[1024,374],[1023,323],[1000,281],[955,263],[888,267],[836,303],[817,354],[813,412],[811,457],[822,473],[840,459],[847,431],[854,398],[856,368],[912,338],[917,361],[934,337],[971,345],[998,363],[998,409],[994,435],[999,471]],"translate":[-6,-36],"mutationVectors":[{"type":"deform","origin":[-98,48],"name":"e","radius":96},{"type":"deform","origin":[87,54],"name":"f","radius":101},{"name":"g","type":"translate","origin":[0,0],"radius":-1}],"name":"i"},{"type":"sprite","points":[[221,213],[265,212],[266,230],[223,233]],"translate":[2,46],"mutationVectors":[{"name":"h","type":"translate","origin":[0,0],"radius":-1}],"name":"j"},{"type":"sprite","points":[[776,110],[780,98],[793,90],[805,91],[818,92],[830,95],[842,106],[833,114],[818,110],[795,108]],"translate":[-42,-46],"mutationVectors":[{"name":"i","type":"translate","origin":[0,0],"radius":-1},{"type":"rotate","origin":[-55,-48],"name":"j"}],"name":"k"},{"type":"sprite","points":[[774,139],[783,154],[794,148],[810,146],[824,148],[837,150],[837,139],[825,132],[808,129],[788,132]],"translate":[41,-43],"mutationVectors":[{"name":"k","type":"translate","origin":[0,0],"radius":-1},{"type":"rotate","origin":[54,-44],"name":"l"}],"name":"l"},{"name":"m","type":"sprite","points":[[679,86],[679,108],[738,111],[736,86]],"translate":[-47,-13],"mutationVectors":[{"type":"stretch","origin":[-47,-6],"name":"m","radius":-1}]},{"name":"n","type":"sprite","points":[[613,106],[668,108],[667,86],[611,84]],"translate":[43,-14],"mutationVectors":[{"type":"stretch","origin":[37,-6],"name":"n","radius":-1}]},{"name":"o","type":"sprite","points":[[431,266],[485,277],[509,270],[507,259],[435,255],[481,248],[462,248],[462,277],[572,54],[373,52],[572,272],[375,277]],"translate":[2,-34],"mutationVectors":[{"type":"deform","origin":[2,79],"name":"o","radius":26}]},{"type":"sprite","points":[[128,165],[135,173],[145,170],[162,129],[160,113],[151,102],[134,113],[130,121]],"translate":[93,-3],"mutationVectors":[{"name":"p","type":"translate","origin":[0,0],"radius":-1}],"name":"p"},{"type":"sprite","points":[[103,111],[112,168],[103,176],[92,174],[74,110],[86,104]],"translate":[-91,-6],"mutationVectors":[{"name":"q","type":"translate","origin":[0,0],"radius":-1}],"name":"q"},{"name":"r","type":"sprite","points":[[636,235],[717,236],[717,247],[694,256],[653,256],[636,245]],"translate":[0,65],"mutationVectors":[{"name":"r","type":"translate","origin":[0,0]}]},{"name":"s","type":"sprite","points":[[759,189],[761,210],[770,228],[785,235],[814,235],[833,232],[844,218],[847,194]],"translate":[0,83],"mutationVectors":[{"type":"stretch","origin":[1,65],"name":"s","radius":-1}]},{"name":"t","type":"sprite","points":[[612,266],[787,262],[777,310],[737,355],[701,362],[662,352],[622,313]],"translate":[0,87],"mutationVectors":[{"type":"stretch","origin":[0,40],"name":"t","radius":-1}]},{"name":"u","type":"folder","items":[{"name":"v","type":"sprite","points":[[618,149],[664,142],[657,131],[646,128],[630,128],[620,138],[634,149],[645,148]],"translate":[41,-11],"mutationVectors":[{"type":"deform","origin":[38,-6],"name":"u","radius":15}]},{"name":"w","type":"sprite","points":[[624,79],[630,79],[630,71],[621,71]],"translate":[30,-10],"mutationVectors":[]},{"name":"x","type":"sprite","points":[[653,186],[653,160],[627,160],[627,186]],"translate":[37,-9],"mutationVectors":[{"name":"v","type":"translate","origin":[0,0]},{"type":"stretch","origin":[38,-9],"name":"w","radius":-1}]},{"name":"y","type":"sprite","points":[[621,197],[620,228],[667,197],[666,227]],"translate":[40,-6],"mutationVectors":[]}],"mutationVectors":[]},{"name":"z","type":"folder","items":[{"name":"A","type":"sprite","points":[[688,143],[695,131],[709,127],[721,129],[731,136],[736,151],[704,146],[716,148]],"translate":[-42,-12],"mutationVectors":[{"type":"deform","origin":[-42,-9],"name":"x","radius":15}]},{"name":"B","type":"sprite","points":[[697,77],[705,78],[706,70],[697,70]],"translate":[-48,-12],"mutationVectors":[]},{"name":"C","type":"sprite","points":[[698,161],[698,186],[724,186],[724,161]],"translate":[-42,-11],"mutationVectors":[{"name":"y","type":"translate","origin":[0,0]},{"type":"stretch","origin":[-41,-10],"name":"z","radius":-1}]},{"name":"D","type":"sprite","points":[[685,197],[685,227],[734,229],[733,197]],"translate":[-43,-6],"mutationVectors":[]}],"mutationVectors":[]}],"mutationVectors":[{"type":"rotate","origin":[-5,98],"name":"c"},{"name":"d","type":"translate","origin":[0,0],"radius":-1}]},{"type":"sprite","points":[[1214,246],[2027,1820],[1738,244],[961,1842],[1620,334],[1681,336],[1678,350],[1629,369]],"translate":[14,896],"mutationVectors":[],"name":"E"},{"type":"sprite","points":[[325,586],[430,939],[384,658],[320,941],[198,687],[197,654],[269,585]],"translate":[227,359],"mutationVectors":[],"name":"F"},{"type":"sprite","points":[[415,1020],[482,1105],[434,1125],[335,1373],[268,1384],[238,1331],[284,1061],[346,1031]],"translate":[-173,354],"mutationVectors":[],"name":"G"},{"type":"sprite","points":[[779,611],[822,582],[864,568],[921,567],[979,582],[1013,632],[1042,707],[1038,813],[1028,847],[1040,912],[1030,948],[1027,1024],[990,1103],[954,1120],[907,1064],[867,1106],[822,1083],[779,1105],[750,1084],[754,992],[743,934],[759,844],[753,753],[761,709],[747,660]],"translate":[-2,108],"mutationVectors":[{"type":"deform","origin":[-7,263],"name":"A","radius":331},{"type":"rotate","origin":[-3,106],"name":"B"},{"name":"C","type":"translate","origin":[0,0],"radius":-1}],"name":"H"}],"version":"1.0"}'));let X=[];const O=t=>{X=X.filter((e=>e.name!==t))},N=(t,e,n,a,o)=>new Promise((r=>{O(t);let i=e;X=X.concat({name:t,ticker:()=>{i===n?(O(t),r()):i<n?i+=Math.min(a,n-i):i-=Math.min(a,i-n),o(i)}})})),W=(t,e)=>new Promise((n=>{O(t);let a=e;X=X.concat({name:t,ticker:()=>{0===a?(O(t),n()):a--}})})),H=document.getElementById("root"),Y=(t,e)=>async n=>{t.startTrack("Talking",{startAt:800}),t.startTrack("Eyebrows");const a=(t=>{const n=document.createElement("div");n.classList.add("dialogbox");const a=document.createElement("h3");a.classList.add("dialogname"),a.textContent=e,n.appendChild(a),H.appendChild(n);const o=document.createElement("p");return o.textContent=t,n.appendChild(o),()=>{H.removeChild(n)}})(n);(async e=>{await W("talking",6*e.length),t.startTrack("StopTalking"),t.startTrack("EyebrowReset")})(n),await(async()=>new Promise((t=>{const e=document.getElementsByClassName("dialogbox")[0],n=()=>{t(),e.removeEventListener("click",n)};e.addEventListener("click",n)})))(),t.startTrack("StopTalking"),t.startTrack("EyebrowReset"),a()},G=async t=>{let e=!0;const n={endDialog:()=>{e=!1}};for(;e;){const e=document.createElement("div");e.classList.add("choicebox"),H.appendChild(e);const a=await new Promise((n=>{Object.keys(t).forEach((t=>{const a=document.createElement("button");a.textContent=t,a.addEventListener("click",(()=>{H.removeChild(e),setTimeout((()=>{n(t)}))})),e.appendChild(a)}))}));await t[a](n)}},j=["Hi! Welcome adventurer, welcome to my inn! Is there something you want to know?",{"What is Geppetto?":["Geppetto consists of two parts. A desktop application to define animated images, and a JavaScript library to play them.",{"Is Geppetto free?":["Yes! It is free to use and distribute. It's also opensource (MIT License). So everyone can see how it works and extend it."],"How does it work?":["You need to create a texture file as .PNG. in Geppetto you will make layers from your texture, and compose them into your image.","The next step is to add mutations to your layer tree to create motion. You can then create timelines to define multiple animations.",{"Why not [Other product here]?":["Other solutions exist for animation. Some are paid, some are not open source, some use vector graphics.","Using a single texture file is fast (single http request) and adding more detail to your image doesn't have any rendering cost."],"What are the features?":["Real-time control and animations. Did you know I can look in the direction you click in this image?","Smooth transition between animations.","Fast, most of the processing is on the GPU","Free as in beer and speech. Isn't that great! It also means Matthijs doesn't make any money from it, and only works on it in his free time. But, feel free to contribute!"],"Sounds great!":["END"]}],"I want to talk about something else":["END"]}],"What can you tell me about your world?":["I hope the world I live in will be expanded into a full game! Wouldn't that be great?","For now it functions as a demo, to see if a game like environment could be created.","Can you spot all the moving elements?","END"],"I think I'll start exploring!":["Good luck!","END"]}],J=async(t,e)=>{for(const n of t)if("string"==typeof n&&"END"!==n&&await e(n),"object"==typeof n){const t=Object.entries(n).reduce(((t,[n,a])=>({...t,[n]:async({endDialog:t})=>{await J(a,e),"END"===a[a.length-1]&&t()}})),{});await G(t)}},K=document.getElementById("theatre"),$=(t=>{const e=L(t);return e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),S(t)})(K),q=async t=>new Promise((e=>{const n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=()=>e(n)}));(async()=>{const t=await q(U),e=B(P),n=$.addAnimation(e,t,0,{zoom:2,panX:0}),a=await q(D),o=B(z),r={zoom:.26,panX:-2.1,panY:-.5,zIndex:2},i=2.2,s=-.3,l=.1,u=$.addAnimation(o,a,1,r),m=()=>{const t=K.getBoundingClientRect(),e=navigator.userAgent.includes("SMART-TV")?2:1;K.width=Math.min(2048,t.width*window.devicePixelRatio*e),K.height=Math.min(1024,t.height*window.devicePixelRatio*e)};m(),window.addEventListener("resize",(()=>{m()})),n.startTrack("Wheel"),n.startTrack("WheelBlades"),n.startTrack("Tree"),n.startTrack("Bird"),n.startTrack("Cloud1",{speed:.15}),n.startTrack("Cloud2",{speed:.1}),n.startTrack("Cloud3",{speed:.15}),n.startTrack("Eyes"),n.startTrack("Smoke"),n.startTrack("Water");let c=!0;u.startTrack("Eye blink"),u.startTrack("HeadTilt");(()=>{let t=[0,0];const e=[.145,.388],n=(e,n)=>Promise.all([N("eye-X",t[0],e,.025,(e=>{t[0]=e,u.setControlValue("RightEye-x",e+1),u.setControlValue("LeftEye-x",e+1),u.setControlValue("HeadTurn",1-.5*(e+1))})),N("eye-Y",t[1],n,.025,(e=>{t[1]=e,u.setControlValue("RightEye-y",.5*(e+1)),u.setControlValue("LeftEye-y",.5*(e+1))}))]).then((()=>{}));K.addEventListener("click",(async t=>{const a=K.getBoundingClientRect(),o=[t.x/a.width,t.y/a.height];if(o[0]>.203&&o[0]<.263&&o[1]>.458&&o[1]<.706&&c)return u.setZoom(i),u.setPanning(s,l),c=!1,void(async t=>{await W("startTalking",60);const e=Y(t,"Innkeeper");await J(j,e)})(u).then((()=>{u.setZoom(r.zoom),u.setPanning(r.panX,r.panY),c=!0}));const m=Math.min(1,Math.max(-1,(o[0]-e[0])/.4)),p=Math.min(1,Math.max(-1,(o[1]-e[1])/.4));O("resetDelay"),await n(m,p),await W("resetDelay",180),await n(0,-.1)})),n(0,-.1)})(),(async()=>{const t=.0025,e={x:.72,y:.87,z:.8},a=.51,o=.29,r=.95,i={...e};n.setControlValue("ButterflyX",i.x),n.setControlValue("ButterflyY",i.y),n.setControlValue("ButterflyZoom",i.z),n.startTrack("ButterflyWings",{speed:.2}),await W("bfParked",320);let s=!1;const l=(e,a,o)=>(s||(n.startTrack("ButterflyWings"),s=!0),e<i.x?n.setControlValue("ButterflyTurn",0):n.setControlValue("ButterflyTurn",1),Promise.all([N("ButterflyX",i.x,e,t,(t=>{i.x=t,n.setControlValue("ButterflyX",t)})),N("ButterflyY",i.y,a,t,(t=>{i.y=t,n.setControlValue("ButterflyY",t)})),N("ButterflyZoom",i.z,o,.025,(t=>{i.z=t,n.setControlValue("ButterflyZoom",t)}))])),u=()=>{const t=.3*Math.random();let e=Math.random()>.5?1:-1,n=Math.random()>.5?1:-1;(i.x+e*t>1||i.x+e*t<0)&&(e*=-1),(i.y+n*t>1||i.y+n*t<0)&&(n*=-1);const a=i.x+e*t,o=i.y+n*t,r=Math.min(Math.max(i.z+Math.random()*t,0),1);return l(a,o,r)};for(;;){const t=Math.random();t>.95?(await l(e.x,e.y,e.z),s&&(n.startTrack("ButterflyWings",{speed:.2}),s=!1),await W("bfParked",320)):t<.05?(await l(a,o,r),s&&(n.startTrack("ButterflyWings",{speed:.2}),s=!1),await W("bfParked",320)):await u()}})();const p=()=>{(()=>{for(const t of X)t.ticker()})(),$.render(),n.render(),u.render(),window.requestAnimationFrame(p)};window.requestAnimationFrame(p)})();
//# sourceMappingURL=index.03816cdd.js.map
