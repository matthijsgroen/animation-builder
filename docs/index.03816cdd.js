function t(t){return t&&t.__esModule?t.default:t}function e(t){return t&&t.__esModule?t.default:t}var a={};const o=Math.pow(2,-52),r=new Uint32Array(512);class n{static from(t,e=w,a=M){const o=t.length,r=new Float64Array(2*o);for(let n=0;n<o;n++){const o=t[n];r[2*n]=e(o),r[2*n+1]=a(o)}return new n(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const a=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*a),this._halfedges=new Int32Array(3*a),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:a,_hullTri:r,_hullHash:n}=this,i=t.length>>1;let s=1/0,u=1/0,l=-1/0,c=-1/0;for(let e=0;e<i;e++){const a=t[2*e],o=t[2*e+1];a<s&&(s=a),o<u&&(u=o),a>l&&(l=a),o>c&&(c=o),this._ids[e]=e}const d=(s+l)/2,f=(u+c)/2;let w,M,g,N=1/0;for(let e=0;e<i;e++){const a=m(d,f,t[2*e],t[2*e+1]);a<N&&(w=e,N=a)}const E=t[2*w],V=t[2*w+1];N=1/0;for(let e=0;e<i;e++){if(e===w)continue;const a=m(E,V,t[2*e],t[2*e+1]);a<N&&a>0&&(M=e,N=a)}let T=t[2*M],x=t[2*M+1],_=1/0;for(let e=0;e<i;e++){if(e===w||e===M)continue;const a=y(E,V,T,x,t[2*e],t[2*e+1]);a<_&&(g=e,_=a)}let v=t[2*g],b=t[2*g+1];if(_===1/0){for(let e=0;e<i;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];h(this._ids,this._dists,0,i-1);const e=new Uint32Array(i);let a=0;for(let t=0,o=-1/0;t<i;t++){const r=this._ids[t];this._dists[r]>o&&(e[a++]=r,o=this._dists[r])}return this.hull=e.subarray(0,a),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(p(E,V,T,x,v,b)){const t=M,e=T,a=x;M=g,T=v,x=b,g=t,v=e,b=a}const k=function(t,e,a,o,r,n){const i=a-t,s=o-e,u=r-t,l=n-e,m=i*i+s*s,c=u*u+l*l,p=.5/(i*l-s*u);return{x:t+(l*m-s*c)*p,y:e+(i*c-u*m)*p}}(E,V,T,x,v,b);this._cx=k.x,this._cy=k.y;for(let e=0;e<i;e++)this._dists[e]=m(t[2*e],t[2*e+1],k.x,k.y);h(this._ids,this._dists,0,i-1),this._hullStart=w;let R=3;a[w]=e[g]=M,a[M]=e[w]=g,a[g]=e[M]=w,r[w]=0,r[M]=1,r[g]=2,n.fill(-1),n[this._hashKey(E,V)]=w,n[this._hashKey(T,x)]=M,n[this._hashKey(v,b)]=g,this.trianglesLen=0,this._addTriangle(w,M,g,-1,-1,-1);for(let i,s,u=0;u<this._ids.length;u++){const l=this._ids[u],m=t[2*l],c=t[2*l+1];if(u>0&&Math.abs(m-i)<=o&&Math.abs(c-s)<=o)continue;if(i=m,s=c,l===w||l===M||l===g)continue;let d=0;for(let t=0,e=this._hashKey(m,c);t<this._hashSize&&(d=n[(e+t)%this._hashSize],-1===d||d===a[d]);t++);d=e[d];let y,h=d;for(;y=a[h],!p(m,c,t[2*h],t[2*h+1],t[2*y],t[2*y+1]);)if(h=y,h===d){h=-1;break}if(-1===h)continue;let f=this._addTriangle(h,l,a[h],-1,-1,r[h]);r[l]=this._legalize(f+2),r[h]=f,R++;let N=a[h];for(;y=a[N],p(m,c,t[2*N],t[2*N+1],t[2*y],t[2*y+1]);)f=this._addTriangle(N,l,y,r[l],-1,r[N]),r[l]=this._legalize(f+2),a[N]=N,R--,N=y;if(h===d)for(;y=e[h],p(m,c,t[2*y],t[2*y+1],t[2*h],t[2*h+1]);)f=this._addTriangle(y,l,h,-1,r[h],r[y]),this._legalize(f+2),r[y]=f,a[h]=h,R--,h=y;this._hullStart=e[l]=h,a[h]=e[N]=l,a[l]=N,n[this._hashKey(m,c)]=l,n[this._hashKey(t[2*h],t[2*h+1])]=h}this.hull=new Uint32Array(R);for(let t=0,e=this._hullStart;t<R;t++)this.hull[t]=e,e=a[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const a=t/(Math.abs(t)+Math.abs(e));return(e>0?3-a:1+a)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:a,coords:o}=this;let n=0,i=0;for(;;){const s=a[t],u=t-t%3;if(i=u+(t+2)%3,-1===s){if(0===n)break;t=r[--n];continue}const l=s-s%3,m=u+(t+1)%3,c=l+(s+2)%3,p=e[i],y=e[t],h=e[m],f=e[c];if(d(o[2*p],o[2*p+1],o[2*y],o[2*y+1],o[2*h],o[2*h+1],o[2*f],o[2*f+1])){e[t]=f,e[s]=p;const o=a[c];if(-1===o){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,o),this._link(s,a[i]),this._link(i,c);const u=l+(s+1)%3;n<r.length&&(r[n++]=u)}else{if(0===n)break;t=r[--n]}}return i}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,a,o,r,n){const i=this.trianglesLen;return this._triangles[i]=t,this._triangles[i+1]=e,this._triangles[i+2]=a,this._link(i,o),this._link(i+1,r),this._link(i+2,n),this.trianglesLen+=3,i}}var i,s,u,l;function m(t,e,a,o){const r=t-a,n=e-o;return r*r+n*n}function c(t,e,a,o,r,n){const i=(o-e)*(r-t),s=(a-t)*(n-e);return Math.abs(i-s)>=33306690738754716e-32*Math.abs(i+s)?i-s:0}function p(t,e,a,o,r,n){return(c(r,n,t,e,a,o)||c(t,e,a,o,r,n)||c(a,o,r,n,t,e))<0}function d(t,e,a,o,r,n,i,s){const u=t-i,l=e-s,m=a-i,c=o-s,p=r-i,d=n-s,y=m*m+c*c,h=p*p+d*d;return u*(c*h-y*d)-l*(m*h-y*p)+(u*u+l*l)*(m*d-c*p)<0}function y(t,e,a,o,r,n){const i=a-t,s=o-e,u=r-t,l=n-e,m=i*i+s*s,c=u*u+l*l,p=.5/(i*l-s*u),d=(l*m-s*c)*p,y=(i*c-u*m)*p;return d*d+y*y}function h(t,e,a,o){if(o-a<=20)for(let r=a+1;r<=o;r++){const o=t[r],n=e[o];let i=r-1;for(;i>=a&&e[t[i]]>n;)t[i+1]=t[i--];t[i+1]=o}else{let r=a+1,n=o;f(t,a+o>>1,r),e[t[a]]>e[t[o]]&&f(t,a,o),e[t[r]]>e[t[o]]&&f(t,r,o),e[t[a]]>e[t[r]]&&f(t,a,r);const i=t[r],s=e[i];for(;;){do{r++}while(e[t[r]]<s);do{n--}while(e[t[n]]>s);if(n<r)break;f(t,r,n)}t[a+1]=t[n],t[n]=i,o-r+1>=n-a?(h(t,e,r,o),h(t,e,a,n-1)):(h(t,e,a,n-1),h(t,e,r,o))}}function f(t,e,a){const o=t[e];t[e]=t[a],t[a]=o}function w(t){return t[0]}function M(t){return t[1]}i=a,s="default",u=function(){return n},Object.defineProperty(i,s,{get:u,enumerable:!0}),l=a,Object.defineProperty(l,"__esModule",{value:!0});var g=e(a);const N=t=>t.reduce(((t,e)=>t.concat(e)),[]),E=t=>({data:new Float32Array(N(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),V=t=>"folder"===t.type||"sprite"===t.type,T=(t,e,a=[])=>{for(const o of t){e(o,a);for(const t of o.mutationVectors)e(t,[...a,o]);"folder"===o.type&&T(o.items,e,[...a,o])}},x={translate:1,stretch:2,rotate:3,deform:4,opacity:5},_=(t,e)=>{const a=t[t.length-1];if(V(a)){const o=e?a.mutationVectors.indexOf(e):-1;if(o>0)return a.mutationVectors[o-1];for(let a=t.length-(e?2:1);a>=0;a--){const e=t[a];if(e&&V(e)&&e.mutationVectors.length>0)return e.mutationVectors[e.mutationVectors.length-1]}}return null},v=t=>{const e=t.controls.map((t=>t.name));return t.animations.map((t=>{const a=[],o=[];return t.keyframes.reduce(((t,e)=>(e.event&&o.push([e.time,e.event]),t.concat(Object.keys(e.controlValues)))),[]).filter(((t,e,a)=>a.indexOf(t)===e)).forEach((o=>{const r=[];t.keyframes.forEach((t=>{const e=t.controlValues[o];void 0!==e&&r.push([t.time,e])})),a.push([e.indexOf(o),new Float32Array(N(r))])})),{name:t.name,duration:0===t.keyframes.length?0:t.keyframes[t.keyframes.length-1].time,looping:t.looping,tracks:a,events:o}}))};var b=t=>{if("1.0"!==t.version)throw new Error("Only version 1.0 files are supported");const e=[],a=[],o=[];T(t.shapes,(t=>{if("sprite"!==t.type)return;const r=(t=>{let e=1/0,a=-1/0,o=1/0,r=-1/0;return t.points.forEach((([t,n])=>{e=t<e?t:e,a=t>a?t:a,o=n<o?n:o,r=n>r?n:r})),[(e+a)/2,(o+r)/2]})(t),n=(i=t.points,g.from(i).triangles);var i;const s=[...t.translate,.1*e.length],u=a.length;e.push({name:t.name,start:2*o.length,amount:n.length,mutator:0,x:s[0],y:s[1],z:1e-4*s[2]-.9}),t.points.forEach((([t,e])=>{a.push([t-r[0],e-r[1],t,e])})),n.forEach((t=>{o.push(t+u)}))}));const r=(t=>{const e=[],a=[],o={};T(t,((t,r)=>{if((t=>"deform"===t.type||"rotate"===t.type||"translate"===t.type||"stretch"===t.type||"opacity"===t.type)(t)){const i=[x[(n=t).type],n.origin[0],n.origin[1],"deform"===n.type||"translate"===n.type?n.radius:-1],s=a.length;a.push(i);const u=_(r,t),l=null===u?-1:e.findIndex((t=>t.name===u.name));e.push({name:t.name,index:s,parent:l}),o[t.name]=l}var n}));const r={};T(t,((t,a)=>{if(V(t)){const o=_(a.concat(t)),n=null===o?-1:e.findIndex((t=>t.name===o.name));r[t.name]=n}}));const n=new Int32Array(a.length);return e.forEach(((t,e)=>{n[e]=t.parent})),{mutatorMapping:o,parentList:n,vectorSettings:a,shapeMutatorMapping:r}})(t.shapes),n=r.parentList.length,i=Object.keys(r.mutatorMapping),s=[],u=new Float32Array(2*n);Object.entries(t.defaultFrame).forEach((([t,e])=>{const a=i.indexOf(t);-1!==a&&(u[2*a]=e[0],u[2*a+1]=e[1])}));const l=[],m=[],c=[];e.forEach((t=>{t.mutator=r.shapeMutatorMapping[t.name]})),e.sort(((t,e)=>(e.z||0)-(t.z||0)));const p=new Float32Array(t.controls.length),d=t.controls.reduce(((e,a,o)=>{const r=a.steps.reduce(((t,e)=>t.concat(Object.keys(e).filter((e=>!t.includes(e))))),[]);return s.push({name:a.name,steps:a.steps.length}),p[o]=t.controlValues[a.name],r.forEach((o=>{const r=i.indexOf(o),n=a.steps.map((t=>t[o])),s=(null==t?void 0:t.controls.findIndex((t=>t.name===a.name)))||0,u={name:a.name,controlIndex:s,valueStartIndex:l.length,values:n,stepType:0};l.push(...n),e={...e,[r]:{controls:((e[r]||{}).controls||[]).concat(u)}}})),e}),{}),y=Math.max(...Object.keys(d).map((t=>parseInt(t,10))));c.length=y,c.fill([0,0]);let h=0;return Object.entries(d).forEach((([t,e])=>{const a=e.controls.map((t=>[t.valueStartIndex,t.controlIndex,t.stepType]));c[parseInt(t,10)]=[m.length,a.length],h=Math.max(h,a.length),m.push(...a)})),{mutators:E(r.vectorSettings),mutatorParents:{data:r.parentList,length:r.parentList.length,stride:1},mutationValues:{data:u,length:r.parentList.length,stride:2},controlMutationValues:E(l),mutationValueIndices:E(m),controlMutationIndices:E(c),defaultControlValues:p,shapeVertices:E(a),shapeIndices:new Uint16Array(o),shapes:e,controls:s,maxIteration:h,animations:v(t)}},k=e("precision mediump float;\n#define GLSLIFY 1\nvarying mediump vec2 vTextureCoord;varying mediump float vOpacity;uniform sampler2D uSampler;uniform mediump vec2 uTextureDimensions;void main(void){highp vec2 A=vTextureCoord.xy/uTextureDimensions;mediump vec4 B=texture2D(uSampler,A);gl_FragColor=vec4(B.rgb*B.a*vOpacity,B.a*vOpacity);}"),R=e("#define GLSLIFY 1\n#define A 0.017453292519943295\nuniform vec2 viewport;uniform vec3 basePosition;uniform vec3 translate;uniform float mutation;uniform vec4 scale;uniform vec2 uMutationValues[MAX_MUT];uniform vec4 uMutationVectors[MAX_MUT];uniform int uMutationParent[MAX_MUT];attribute vec2 coordinates;attribute vec2 aTextureCoord;varying lowp vec2 vTextureCoord;varying lowp float vOpacity;mat4 B=mat4(2./viewport.x,0,0,0,0,-2./viewport.y,0,0,0,0,1,0,-1,+1,0,1);vec2 C(int D,int E){vec2 F=uMutationValues[D];vec2 G=uControlMutationIndices[D];int H=int(G.x);int I=int(G.y);if(I==0){return F;}for(int J=0;J<MAX_IT;J++){if(J<I){vec3 K=uMutationValueIndices[H+J];float L=uControlValues[int(K.y)];int M=int(floor(K.x+L));int N=int(ceil(K.x+L));float O=L-floor(L);vec2 P=uControlMutationValues[M];vec2 Q=uControlMutationValues[N];vec2 R=mix(P,Q,O);if(E==2||E==5){F*=R;}else{F+=R;}}else{return F;}}return F;}vec3 S(vec3 T,int D){vec4 mutation=uMutationVectors[D];int E=int(mutation.x);vec2 U=C(D,E);vec2 V=mutation.yz;vec3 F=T;if(E==1){float W=1.;if(mutation.a>0.&&distance(T.xy,V)>mutation.a){W=0.;}F=vec3(T.xy+U*W,T.z);}if(E==2){F=vec3(V.xy+vec2((T.x-V.x)*U.x,(T.y-V.y)*U.y),T.z);}if(E==3){float X=U.x*A;mat2 Y=mat2(cos(X),sin(X),-sin(X),cos(X));F=vec3((T.xy-V)*Y+V,T.z);}if(E==4){float W=1.-clamp(distance(T.xy,V),0.,mutation.a)/mutation.a;F=vec3(T.xy+U*W,T.z);}if(E==5){float Z=U.x;F=vec3(T.xy,T.z*Z);}return F;}vec3 a(vec3 T,int D){int b=D;vec3 F=T;for(int J=0;J<MAX_MUT;J++){if(b==-1){return F;}F=S(F,b);b=uMutationParent[b];}return F;}void main(){vec3 c=a(vec3(coordinates+translate.xy,1.),int(mutation));vec4 d=B*vec4((c.xy+basePosition.xy)*scale.x,translate.z-basePosition.z,1.);gl_Position=vec4((d.xy+scale.ba)*scale.y,d.z,1.);vTextureCoord=aTextureCoord.xy;vOpacity=c.z;}");const B=(t,e,a=0)=>{for(let o=0;o<t.length;o+=2)if(t[o]>e){const r=o>1?t[o-2]:0,n=o>1?t[o-1]:a,i=(e-r)/(t[o]-r);return n*(1-i)+t[o+1]*i}return t[t.length-1]},L={zoom:1,panX:0,panY:0,zIndex:0},A=t=>{const e=t.getContext("webgl",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"});if(!e)throw new Error("Canvas has no webgl context available");return e};const C=t=>{const e=A(t),a=[];let o=[],r=[];return{render:()=>{e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,t.width,t.height)},addAnimation:(n,i,s,u)=>{const l=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9][s],[m,c,p]=((t,e)=>{const a=t.createProgram();if(!a)throw new Error("Failed to create shader program");const o=(t=>`\n  #define MAX_MUT ${t.mutators.length}\n  #define MAX_IT ${t.maxIteration}\n  uniform vec2 uControlMutationValues[${t.controlMutationValues.length}];\n  uniform vec3 uMutationValueIndices[${t.mutationValueIndices.length}];\n  uniform vec2 uControlMutationIndices[${t.controlMutationIndices.length}];\n  uniform float uControlValues[${t.controls.length}];\n  ${R}\n`)(e),r=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER);if(!r||!n)throw t.deleteProgram(a),t.deleteShader(r),t.deleteShader(n),new Error("Failed to create shader program");if(t.shaderSource(r,o),t.shaderSource(n,k),t.compileShader(r),t.compileShader(n),t.attachShader(a,r),t.attachShader(a,n),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw console.error("Link failed: "+t.getProgramInfoLog(a)),console.error("vs info-log: "+t.getShaderInfoLog(r)),console.error("fs info-log: "+t.getShaderInfoLog(n)),new Error("Could not initialise shaders");return[a,r,n]})(e,n);e.useProgram(m);const d=((t,e,a)=>{const o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),t.useProgram(e),t.uniform2f(t.getUniformLocation(e,"uTextureDimensions"),a.width,a.height),o})(e,m,i),y=e.getUniformLocation(m,"uMutationParent");e.uniform1iv(y,n.mutatorParents.data);const h=((t,e)=>(a,o)=>{const r=t.getUniformLocation(e,a),n=o.stride;2==n?t.uniform2fv(r,o.data):3==n?t.uniform3fv(r,o.data):4==n&&t.uniform4fv(r,o.data)})(e,m);h("uMutationVectors",n.mutators),h("uMutationValues",n.mutationValues),h("uControlMutationValues",n.controlMutationValues),h("uMutationValueIndices",n.mutationValueIndices),h("uControlMutationIndices",n.controlMutationIndices);const f=e.getUniformLocation(m,"uControlValues");e.uniform1fv(f,n.defaultControlValues);const w=new Float32Array(n.defaultControlValues),M=new Float32Array(n.defaultControlValues),g=e.createBuffer(),N=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,g),e.bufferData(e.ARRAY_BUFFER,n.shapeVertices.data,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,N),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n.shapeIndices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);const E=e.getUniformLocation(m,"basePosition"),V=e.getUniformLocation(m,"translate"),T=e.getUniformLocation(m,"mutation"),x=e.getUniformLocation(m,"viewport"),_=e.getUniformLocation(m,"scale"),v=e.getAttribLocation(m,"coordinates"),b=e.getAttribLocation(m,"aTextureCoord");let A=0,C=0,{zoom:S,panX:I,panY:F,zIndex:U}={...L,...u},P=[0,0],W=1;const X=[],z=n.animations.map((t=>t.name)),D=n.controls.map((t=>t.name)),H=n.animations.map((t=>t.looping)),O=t=>{const e=X.findIndex((e=>e.name===t));if(-1===e)return;const a=X[e];let r=+new Date-a.startedAt+a.startAt;const i=n.animations[a.index];H[a.index]&&(r%=i.duration),X.splice(e,1);for(const[t,e]of i.tracks){const a=B(e,r,w[t]);w[t]=a}for(const e of o)e(t)},Y=t=>{const e=D.indexOf(t);if(-1===e)throw new Error(`Control ${t} does not exist in ${D.join(",")}`);return e},G=t=>{const e=z.indexOf(t);if(-1===e)throw new Error(`Track ${t} does not exist in ${z.join(",")}`);return e},$={destroy:function(){e.deleteShader(c),e.deleteShader(p),e.deleteProgram(m),e.deleteTexture(d),e.deleteBuffer(g),e.deleteBuffer(N),a.splice(a.indexOf($),1)},setLooping:function(t,e){const a=G(e);H[a]=t},startTrack:function(t,{startAt:e=0,speed:a=1}={}){const o=G(t),r=n.animations[o].tracks.map((([t])=>t));for(const t of X)n.animations[t.index].tracks.some((([t])=>r.includes(t)))&&O(z[t.index]);X.push({name:t,index:o,startAt:e,speed:a,startedAt:+new Date,iterationStartedAt:+new Date-e/a,lastRender:0})},stopTrack:O,setControlValue:(t,e)=>{const a=Y(t),o=n.controls[a].steps-1;if(e<0||e>o)throw new Error(`Control ${t} value shoulde be between 0 and ${o}. ${e} is out of bounds.`);for(const t of X)n.animations[t.index].tracks.some((([t])=>t===a))&&O(z[t.index]);w[a]=e,M[a]=e},getControlValue:t=>w[Y(t)],setPanning:function(t,e){I=t,F=e},setZoom:function(t){S=t},setZIndex:function(t){U=t},render:function(){if(e.useProgram(m),e.bindBuffer(e.ARRAY_BUFFER,g),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,N),e.vertexAttribPointer(v,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),e.enableVertexAttribArray(v),e.vertexAttribPointer(b,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,2*Float32Array.BYTES_PER_ELEMENT),e.enableVertexAttribArray(b),t.width!==A||t.height!==C){const a=t.width,o=t.height,r=i.width/a>i.height/o;W=r?a/i.width:o/i.height,e.uniform2f(x,a,o),P=[a/2/W,o/2/W],A=t.width,C=t.height}e.uniform4f(_,W,S,I,F),e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,d),e.uniform1i(e.getUniformLocation(m,"uSampler"),s),e.uniform3f(E,P[0],P[1],.01*U);const a=+new Date;for(const t of X){const e=(a-t.iterationStartedAt)*t.speed,o=n.animations[t.index],i=e%o.duration;if(o.duration<e){if(!H[t.index]){O(o.name);continue}t.iterationStartedAt=a-i;for(const[t]of o.tracks)w[t]=M[t]}for(const[e,n]of o.events){const o=t.iterationStartedAt+e;if(o<a&&o>t.lastRender)for(const a of r)a(n,t.name,e)}t.lastRender=a;for(const[t,e]of o.tracks){const a=B(e,i,w[t]);M[t]=a}}e.uniform1fv(f,M);for(const t of n.shapes)e.uniform3f(V,t.x,t.y,t.z),e.uniform1f(T,t.mutator),e.drawElements(e.TRIANGLES,t.amount,e.UNSIGNED_SHORT,t.start)},onTrackStopped:function(t){return o=o.concat(t),()=>{o=o.filter((e=>e!==t))}},onEvent:function(t){return r=r.concat(t),()=>{r=r.filter((e=>e!==t))}}};return a.push($),$},destroy:function(){for(const t of a)t.destroy();a.length=0}}};var S=null;var I=function(){return S||(S=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),S},F=t(I()+"scenery.8635c172.png"),U=t(JSON.parse('{"animations":[{"name":"Wheel","looping":true,"keyframes":[{"time":0,"controlValues":{"WheelRotate":1}},{"time":19200,"controlValues":{"WheelRotate":0}}]},{"name":"Tree","looping":true,"keyframes":[{"time":0,"controlValues":{"TreeLeaves1":0}},{"time":500,"controlValues":{"TreeLeaves2":0}},{"time":8000,"controlValues":{"TreeLeaves1":1}},{"time":8500,"controlValues":{"TreeLeaves2":1}},{"time":16000,"controlValues":{"TreeLeaves1":0,"TreeLeaves2":0.04}}]},{"name":"Bird","looping":true,"keyframes":[{"time":6000,"controlValues":{"Beak":0}},{"time":6200,"controlValues":{"Beak":1}},{"time":7000,"controlValues":{"Beak":1}},{"time":7200,"controlValues":{"Beak":0}}]},{"name":"Cloud1","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud1":0.5}},{"time":20000,"controlValues":{"Cloud1":1}},{"time":20001,"controlValues":{"Cloud1":0}},{"time":40000,"controlValues":{"Cloud1":0.5}}]},{"name":"Eyes","looping":true,"keyframes":[{"time":0,"controlValues":{"EyesBlink":1}},{"time":3000,"controlValues":{"EyesBlink":1}},{"time":3300,"controlValues":{"EyesBlink":0}},{"time":3500,"controlValues":{"EyesBlink":0}},{"time":3700,"controlValues":{"EyesBlink":1}}]},{"name":"ButterflyWings","looping":true,"keyframes":[{"time":300,"controlValues":{"ButterflyWings":1}},{"time":600,"controlValues":{"ButterflyWings":0}}]},{"name":"Smoke","looping":true,"keyframes":[{"time":0,"controlValues":{"Rook":0,"Smoke":0}},{"time":10000,"controlValues":{"Rook":1,"Smoke":1}}]},{"name":"Cloud2","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud2":0.8}},{"time":30000,"controlValues":{"Cloud2":0}},{"time":30001,"controlValues":{"Cloud2":1}},{"time":40000,"controlValues":{"Cloud2":0.8}}]},{"name":"Cloud3","looping":true,"keyframes":[{"time":0,"controlValues":{"Cloud3":0.2}},{"time":10000,"controlValues":{"Cloud3":0}},{"time":10001,"controlValues":{"Cloud3":1}},{"time":40000,"controlValues":{"Cloud3":0.2}}]},{"name":"WheelBlades","looping":true,"keyframes":[{"time":0,"controlValues":{"WheelBlades":0}},{"time":1600,"controlValues":{"WheelBlades":1}}]},{"name":"Water","looping":true,"keyframes":[{"time":0,"controlValues":{"Bubble":1.6,"Bubble2":0.9,"Bubble3":0.3}},{"time":400,"controlValues":{"Bubble":2}},{"time":401,"controlValues":{"Bubble":0}},{"time":1600,"controlValues":{"Bubble2":1.6,"Bubble3":0.9,"Bubble":0.3}},{"time":2000,"controlValues":{"Bubble2":2}},{"time":2001,"controlValues":{"Bubble2":0}},{"time":3200,"controlValues":{"Bubble3":1.6,"Bubble":0.9,"Bubble2":0.3}},{"time":3600,"controlValues":{"Bubble3":2}},{"time":3601,"controlValues":{"Bubble3":0}},{"time":4800,"controlValues":{"Bubble2":0.9,"Bubble3":0.3,"Bubble":1.6}}]}],"controlValues":{"WheelRotate":0.78,"TreeLeaves1":0,"TreeLeaves2":0.19,"Beak":0,"Cloud1":0.5,"EyesBlink":1,"ButterflyWings":0,"Rook":1,"Cloud2":0.8,"Cloud3":1,"New Control":1,"Butterflyturn":1,"ButterflyZoom":1,"ButterflyX":0.49,"ButterflyY":0.29,"ButterflyTurn":0,"WheelBlades":0.66,"Smoke":0,"Buble":1.46,"Bubble":0.3,"Bubble2":0.9,"Bubble3":1.6},"controls":[{"name":"Bubble3","type":"slider","steps":[{"New Mutator (40)":[-11,0]},{"New Mutator (40)":[-77,49]},{"New Mutator (40)":[-126,107]}]},{"name":"Bubble2","type":"slider","steps":[{"New Mutator (39)":[-9,2]},{"New Mutator (39)":[-75,51]},{"New Mutator (39)":[-130,110]}]},{"name":"Bubble","type":"slider","steps":[{"New Mutator (38)":[-19,0]},{"New Mutator (38)":[-85,43]},{"New Mutator (38)":[-149,115]}]},{"name":"WheelBlades","type":"slider","steps":[{"New Mutator (24)":[0,0],"New Mutator (25)":[1,0.8],"New Mutator (26)":[0,0],"New Mutator (27)":[1,0],"New Mutator (28)":[0,0],"New Mutator (29)":[1,1],"New Mutator (30)":[0,0],"New Mutator (31)":[0.65,1],"New Mutator (32)":[11,0],"New Mutator (35)":[33,0],"New Mutator (34)":[1,0.03],"New Mutator (33)":[0,0],"New Mutator (37)":[43,0]},{"New Mutator (24)":[-33,-19],"New Mutator (25)":[1,0.7],"New Mutator (26)":[10,0],"New Mutator (27)":[-31,-65],"New Mutator (28)":[13,0],"New Mutator (29)":[1,0.75],"New Mutator (30)":[-10,-83],"New Mutator (31)":[0.66,0.05],"New Mutator (32)":[0,0],"New Mutator (35)":[17,0],"New Mutator (34)":[1,-0.37],"New Mutator (33)":[9,-88],"New Mutator (37)":[-2,0]}]},{"name":"Smoke","type":"slider","steps":[{"New Mutator (16)":[0,0]},{"New Mutator (16)":[0,-128]}]},{"name":"ButterflyY","type":"slider","steps":[{"New Mutator (22)":[0,-216]},{"New Mutator (22)":[0,210]}]},{"name":"ButterflyX","type":"slider","steps":[{"New Mutator (22)":[-400,0]},{"New Mutator (22)":[200,0]}]},{"name":"ButterflyZoom","type":"slider","steps":[{"New Mutator (21)":[1,1]},{"New Mutator (21)":[0.5,0.5]}]},{"name":"ButterflyTurn","type":"slider","steps":[{"New Mutator (21)":[1,1]},{"New Mutator (21)":[-1,1]}]},{"name":"ButterflyWings","type":"slider","steps":[{"New Mutator (13)":[1,1],"New Mutator (14)":[1,1]},{"New Mutator (13)":[1,-1.05],"New Mutator (14)":[1,-0.4]}]},{"name":"EyesBlink","type":"slider","steps":[{"New Mutator (12)":[1,1]},{"New Mutator (12)":[0,0]}]},{"name":"Cloud1","type":"slider","steps":[{"New Mutator (11)":[1200,0]},{"New Mutator (11)":[-1300,0]}]},{"name":"Cloud2","type":"slider","steps":[{"New Mutator (19)":[-2101,0]},{"New Mutator (19)":[270,0]}]},{"name":"Cloud3","type":"slider","steps":[{"New Mutator (20)":[-546,0]},{"New Mutator (20)":[1753,0]}]},{"name":"Beak","type":"slider","steps":[{"New Mutator (7)":[0,0],"New Mutator (6)":[0,0]},{"New Mutator (7)":[-19,0],"New Mutator (6)":[7,0]}]},{"name":"TreeLeaves2","type":"slider","steps":[{"New Mutator (5)":[-42,0],"New Mutator (9)":[-11,0],"New Mutator (23)":[-12,0],"New Mutator (36)":[0,0]},{"New Mutator (5)":[48,0],"New Mutator (9)":[8,0],"New Mutator (23)":[13,0],"New Mutator (36)":[0,13]}]},{"name":"TreeLeaves1","type":"slider","steps":[{"New Mutator (4)":[-27,0],"New Mutator (8)":[-13,0],"New Mutator (10)":[-6,0]},{"New Mutator (4)":[40,0],"New Mutator (8)":[12,0],"New Mutator (10)":[11,0]}]},{"name":"WheelRotate","type":"slider","steps":[{"New Mutator (3)":[0,0],"New Mutator (2)":[0,0]},{"New Mutator (3)":[360,0],"New Mutator (2)":[360,0]}]}],"defaultFrame":{"New Mutator":[0.45,1],"New Mutator (1)":[0.45,1],"New Mutator (2)":[0,0],"New Mutator (3)":[90,0],"New Mutator (4)":[0,0],"New Mutator (5)":[0,0],"New Mutator (6)":[0,0],"New Mutator (7)":[0,0],"New Mutator (8)":[0,0],"New Mutator (9)":[0,0],"New Mutator (10)":[0,0],"New Mutator (12)":[1,0],"New Mutator (13)":[1,1],"New Mutator (14)":[1,0.85],"New Mutator (15)":[-41,0],"New Mutator (17)":[37,0],"New Mutator (18)":[23,0],"New Mutator (21)":[1,1],"New Mutator (23)":[0,0],"New Mutator (25)":[1,1],"New Mutator (26)":[0,0],"New Mutator (29)":[1,0.7],"New Mutator (28)":[10,0],"New Mutator (31)":[1,0.53],"New Mutator (30)":[-8,3],"New Mutator (32)":[24,0],"New Mutator (34)":[1,1],"New Mutator (33)":[30,-25],"New Mutator (35)":[0,0],"New Mutator (36)":[0,-9]},"shapes":[{"type":"sprite","points":[[277,1220],[295,1149],[308,1110],[345,1126],[350,1160],[345,1201],[331,1226],[387,1236],[379,1191],[379,1138],[398,1097],[423,1071],[449,1103],[457,1134],[457,1167],[463,1211],[454,1240],[502,1244],[493,1212],[490,1173],[495,1127],[502,1087],[528,1079],[566,1097],[571,1139],[587,1175],[582,1211],[562,1240],[622,1177],[621,1146],[621,1111],[643,1079],[672,1109],[680,1147],[651,1178],[678,1195],[693,1138],[706,1124],[706,1088],[724,1090],[737,1112],[744,1135],[747,1169],[728,1198]],"translate":[429,-310],"mutationVectors":[{"type":"deform","origin":[289,-335],"name":"New Mutator (8)","radius":73},{"type":"deform","origin":[453,-353],"name":"New Mutator (9)","radius":83},{"type":"deform","origin":[600,-355],"name":"New Mutator (10)","radius":66}],"name":"BackTrees"},{"name":"Bird","type":"folder","items":[{"type":"sprite","points":[[1119,1056],[1120,1068],[1171,1065],[1168,1055]],"translate":[112,-386],"mutationVectors":[{"type":"rotate","origin":[88,-386],"name":"New Mutator (6)"}],"name":"Top"},{"type":"sprite","points":[[1120,1091],[1120,1101],[1151,1101],[1152,1092]],"translate":[104,-384],"mutationVectors":[{"type":"rotate","origin":[90,-384],"name":"New Mutator (7)"}],"name":"Bottom"}],"mutationVectors":[]},{"name":"Vlinder","type":"folder","items":[{"type":"sprite","points":[[63,1352],[137,1356],[143,1311],[65,1308]],"translate":[760,222],"mutationVectors":[{"type":"stretch","origin":[753,241],"name":"New Mutator (13)"}],"name":"Vleugel1"},{"type":"sprite","points":[[61,1376],[61,1358],[130,1363],[130,1379]],"translate":[747,240],"mutationVectors":[],"name":"Lijf"},{"type":"sprite","points":[[63,1352],[137,1356],[143,1311],[65,1308]],"translate":[757,222],"mutationVectors":[{"type":"stretch","origin":[752,243],"name":"New Mutator (14)"}],"name":"Vleugel2"}],"mutationVectors":[{"name":"New Mutator (22)","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[765,236],"name":"New Mutator (21)"},{"type":"rotate","origin":[754,244],"name":"New Mutator (15)"}]},{"name":"Tree","type":"folder","items":[{"type":"sprite","points":[[2012,1214],[2016,1361],[2009,1423],[2010,1476],[2002,1510],[2019,1564],[2004,1586],[2000,1626],[2009,1656],[1994,1683],[1994,1716],[1959,1716],[1953,1683],[1955,1620],[1952,1566],[1955,1504],[1957,1433],[1966,1348],[1976,1279],[1975,1240],[1975,1220],[1952,1259],[1945,1283],[1944,1319],[1939,1347],[1932,1385],[1922,1417],[1914,1453],[1901,1483],[1900,1512],[1902,1548],[1911,1582],[1902,1605],[1904,1631],[1904,1663],[1877,1672],[1862,1649],[1861,1593],[1852,1545],[1857,1495],[1863,1458],[1864,1396],[1876,1347],[1861,1353],[1853,1390],[1849,1421],[1852,1453],[1842,1482],[1842,1510],[1846,1540],[1845,1579],[1845,1607],[1849,1635],[1842,1656],[1856,1699],[1833,1715],[1813,1699],[1807,1670],[1802,1632],[1801,1591],[1801,1553],[1803,1512],[1805,1475],[1808,1435],[1808,1397],[1814,1357],[1818,1336],[1802,1330],[1786,1364],[1777,1383],[1780,1407],[1789,1440],[1786,1471],[1769,1501],[1766,1522],[1773,1552],[1782,1589],[1778,1617],[1755,1627],[1736,1611],[1721,1571],[1724,1533],[1727,1499],[1729,1465],[1729,1427],[1733,1393],[1738,1364],[1743,1323],[1752,1294],[1760,1262],[1780,1252],[1811,1261],[1829,1265],[1865,1247],[1786,1229],[1728,1232],[1749,1680]],"translate":[883,-221],"mutationVectors":[{"type":"deform","origin":[906,-79],"name":"New Mutator (5)","radius":298}],"name":"Leaves2"},{"type":"sprite","points":[[1442,1246],[1679,1233],[1654,1356],[1643,1500],[1640,1638],[1642,1721],[1632,1752],[1595,1746],[1579,1705],[1573,1638],[1568,1572],[1569,1508],[1573,1420],[1573,1383],[1564,1412],[1559,1458],[1551,1502],[1552,1545],[1550,1573],[1541,1615],[1540,1647],[1520,1664],[1502,1652],[1497,1617],[1496,1577],[1504,1536],[1504,1497],[1504,1462],[1516,1424],[1520,1388],[1506,1385],[1509,1425],[1498,1452],[1495,1473],[1492,1501],[1485,1513],[1493,1543],[1490,1576],[1469,1580],[1454,1568],[1446,1538],[1444,1500],[1454,1466],[1456,1442],[1451,1401],[1458,1363],[1463,1335],[1424,1274],[1422,1396],[1423,1483],[1427,1557],[1438,1617],[1687,1739],[1678,1603],[1675,1440]],"translate":[901,-220],"mutationVectors":[{"type":"deform","origin":[895,-93],"name":"New Mutator (4)","radius":298}],"name":"Leaves1"}],"mutationVectors":[]},{"name":"Wheel","type":"folder","items":[{"type":"sprite","points":[[947,1271],[1382,1271],[1409,1821],[962,1871]],"translate":[79,56],"mutationVectors":[],"name":"Wheelhouse"},{"name":"Water","type":"folder","items":[{"type":"sprite","points":[[782,1778],[797,1755],[857,1773],[835,1804]],"translate":[95,171],"mutationVectors":[{"name":"New Mutator (38)","type":"translate","origin":[0,0],"radius":-1}],"name":"WaterMove"},{"type":"sprite","points":[[782,1796],[755,1819],[800,1842],[823,1811]],"translate":[73,171],"mutationVectors":[{"name":"New Mutator (39)","type":"translate","origin":[0,0],"radius":-1}],"name":"WaterMove2"},{"type":"sprite","points":[[747,1839],[723,1861],[762,1883],[781,1863]],"translate":[71,172],"mutationVectors":[{"name":"New Mutator (40)","type":"translate","origin":[71,172],"radius":-1}],"name":"WaterMove3"}],"mutationVectors":[]},{"type":"sprite","points":[[1076,1892],[1187,1888],[1192,1978],[1073,1983]],"translate":[33,193],"mutationVectors":[],"name":"Hider"},{"type":"sprite","points":[[340,1312],[703,1312],[703,1675],[340,1675]],"translate":[142,5],"mutationVectors":[{"type":"stretch","origin":[141,4],"name":"New Mutator"},{"type":"rotate","origin":[141,4],"name":"New Mutator (2)"}],"name":"WheelRight"},{"type":"sprite","points":[[775,1306],[899,1303],[907,1682],[771,1678]],"translate":[102,6],"mutationVectors":[],"name":"Side"},{"name":"Blades","type":"folder","items":[{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[48,56],"mutationVectors":[{"name":"New Mutator (30)","type":"translate","origin":[48,56],"radius":-1},{"type":"stretch","origin":[-12,82],"name":"New Mutator (31)"},{"name":"New Mutator (32)","type":"translate","origin":[-12,31],"radius":6}],"name":"Blade3"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[105,142],"mutationVectors":[{"name":"New Mutator (24)","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[97,168],"name":"New Mutator (25)"},{"name":"New Mutator (26)","type":"translate","origin":[46,113],"radius":24}],"name":"Blade1"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[71,122],"mutationVectors":[{"name":"New Mutator (27)","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[62,152],"name":"New Mutator (29)"},{"name":"New Mutator (28)","type":"translate","origin":[14,98],"radius":16}],"name":"Blade2"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[0,0],"mutationVectors":[{"name":"New Mutator (33)","type":"translate","origin":[0,0],"radius":-1},{"type":"stretch","origin":[-60,27],"name":"New Mutator (34)"},{"name":"New Mutator (35)","type":"translate","origin":[-61,-27],"radius":8}],"name":"Blade4"},{"type":"sprite","points":[[63,1216],[63,1269],[185,1216],[184,1269]],"translate":[107,149],"mutationVectors":[{"name":"New Mutator (37)","type":"translate","origin":[0,0],"radius":-1}],"name":"Blade5"}],"mutationVectors":[]},{"type":"sprite","points":[[340,1312],[703,1312],[703,1675],[340,1675]],"translate":[48,0],"mutationVectors":[{"type":"stretch","origin":[48,0],"name":"New Mutator (1)"},{"type":"rotate","origin":[48,0],"name":"New Mutator (3)"}],"name":"WheelLeft"}],"mutationVectors":[]},{"type":"sprite","points":[[814,123],[869,119],[930,128],[934,133],[936,264],[810,268]],"translate":[-151,-319],"mutationVectors":[],"name":"Schoorsteen"},{"type":"sprite","points":[[96,1696],[96,1440],[236,1440],[236,1696],[96,1664],[96,1472],[96,1504],[96,1536],[96,1568],[96,1600],[96,1632],[236,1472],[236,1504],[236,1536],[236,1568],[236,1600],[236,1632],[236,1664],[46,1696],[46,1630],[46,1440],[46,1568],[46,1504],[285,1440],[285,1504],[285,1568],[285,1632],[285,1696]],"translate":[-147,-384],"mutationVectors":[{"type":"deform","origin":[-227,-407],"name":"New Mutator (18)","radius":64},{"type":"deform","origin":[-73,-496],"name":"New Mutator (17)","radius":63},{"name":"New Mutator (16)","type":"translate","origin":[0,0],"radius":-1}],"name":"Rook"},{"type":"sprite","points":[[1129,1236],[1129,1201],[1125,1160],[1141,1159],[1143,1197],[1145,1237],[1160,1238],[1158,1199],[1161,1160],[1175,1159],[1173,1200],[1174,1240]],"translate":[325,-77],"mutationVectors":[{"type":"deform","origin":[326,-121],"name":"New Mutator (23)","radius":55}],"name":"Sigar"},{"name":"Clouds","type":"folder","items":[{"type":"sprite","points":[[1038,1136],[758,1140],[758,1070],[1021,1065]],"translate":[77,-454],"mutationVectors":[{"name":"New Mutator (11)","type":"translate","origin":[0,0],"radius":-1}],"name":"Cloud1"},{"type":"sprite","points":[[1251,1049],[1258,1119],[1464,1119],[1447,1055]],"translate":[906,-458],"mutationVectors":[{"name":"New Mutator (19)","type":"translate","origin":[0,0],"radius":-1}],"name":"Cloud2"},{"type":"sprite","points":[[62,1106],[63,1159],[237,1158],[231,1107]],"translate":[-603,-444],"mutationVectors":[{"name":"New Mutator (20)","type":"translate","origin":[0,0],"radius":-1}],"name":"Could3"}],"mutationVectors":[]},{"type":"sprite","points":[[1416,1009],[1451,1020],[1456,1002],[1428,988]],"translate":[431,473],"mutationVectors":[{"type":"opacity","origin":[0,0],"name":"New Mutator (12)"}],"name":"Eyes"},{"type":"sprite","points":[[847,1204],[853,1204],[853,1217],[848,1217],[843,1220],[845,1229],[858,1227]],"translate":[-356,-247],"mutationVectors":[{"name":"New Mutator (36)","type":"translate","origin":[-356,-241],"radius":9}],"name":"Spider"},{"type":"sprite","points":[[0,0],[0,1024],[2048,1024],[2048,0]],"translate":[0,0],"mutationVectors":[],"name":"Background"}],"version":"1.0"}')),P=t(I()+"innkeeper.07de7d66.png"),W=t(JSON.parse('{"animations":[{"name":"Eye blink","looping":true,"keyframes":[{"time":2500,"controlValues":{"LeftEyeClose":0,"RightEyeClose":0}},{"time":2750,"controlValues":{"LeftEyeClose":1,"RightEyeClose":1}},{"time":3000,"controlValues":{"RightEyeClose":0,"LeftEyeClose":0}}]},{"name":"Look around","looping":true,"keyframes":[{"time":1000,"controlValues":{"LeftEye-x":0.18,"RightEye-x":0.24}},{"time":2000,"controlValues":{"LeftEye-x":1,"RightEye-x":1.02}},{"time":3980,"controlValues":{"LeftEye-x":1.02,"RightEye-x":1}},{"time":5000,"controlValues":{"RightEye-x":1.8,"LeftEye-x":1.84}},{"time":6000,"controlValues":{"LeftEye-x":0.98,"RightEye-x":1.06}},{"time":8000,"controlValues":{"RightEye-x":1,"LeftEye-x":1}}]},{"name":"Talking","looping":true,"keyframes":[{"time":1000,"controlValues":{"Mouth":0}},{"time":1340,"controlValues":{"Mouth":0.62}},{"time":1670,"controlValues":{"Mouth":0}},{"time":2120,"controlValues":{"Mouth":0}},{"time":2430,"controlValues":{"Mouth":0.68}},{"time":2790,"controlValues":{"Mouth":0.24}},{"time":3160,"controlValues":{"Mouth":1}},{"time":3470,"controlValues":{"Mouth":0}}]},{"name":"No","looping":false,"keyframes":[{"time":510,"controlValues":{"HeadTurn":0.38}},{"time":1270,"controlValues":{"HeadTurn":0}},{"time":2180,"controlValues":{"HeadTurn":1}},{"time":2990,"controlValues":{"HeadTurn":0}},{"time":3980,"controlValues":{"HeadTurn":0.48}}]},{"name":"HeadTilt","looping":true,"keyframes":[{"time":1000,"controlValues":{"HeadTilt":0.42}},{"time":6000,"controlValues":{"HeadTilt":0.53}},{"time":9000,"controlValues":{"HeadTilt":0.14}},{"time":12000,"controlValues":{"HeadTilt":0.43}}]},{"name":"EyeWink","looping":false,"keyframes":[{"time":500,"controlValues":{"RightEyeClose":0,"LeftEyeClose":0}},{"time":800,"controlValues":{"RightEyeClose":1}},{"time":1200,"controlValues":{"RightEyeClose":1}},{"time":1500,"controlValues":{"RightEyeClose":0}}]},{"name":"Eyebrows","looping":true,"keyframes":[{"time":990,"controlValues":{"Eyebrows":1.32}},{"time":3940,"controlValues":{"Eyebrows":0.92}},{"time":6820,"controlValues":{"Eyebrows":1.88}},{"time":10220,"controlValues":{"Eyebrows":0.88}}]},{"name":"StopTalking","looping":false,"keyframes":[{"time":310,"controlValues":{"Mouth":0}}]},{"name":"EyebrowReset","looping":false,"keyframes":[{"time":530,"controlValues":{"Eyebrows":1}}]}],"controlValues":{"Eyebrows":1,"HeadTilt":0.55,"HeadTurn":0.5,"Mouth":0,"RightEye-y":0.5,"LeftEye-y":0.5,"RightEye-x":1,"LeftEye-x":1,"RightEyeClose":0,"LeftEyeClose":0,"ArmTop":0,"ArmBottom":1,"ArmLeftTop":0,"ArmLeftBottom":1},"controls":[{"name":"ArmRightTop","type":"slider","steps":[{},{},{}]},{"name":"Eyebrows","type":"slider","steps":[{"New Mutator (3)":[0,6],"New Mutator (2)":[-10,0],"New Mutator (23)":[0,6],"New Mutator (24)":[10,0]},{"New Mutator (3)":[0,0],"New Mutator (2)":[0,0],"New Mutator (23)":[0,0],"New Mutator (24)":[0,0]},{"New Mutator (3)":[0,0],"New Mutator (2)":[9,0],"New Mutator (23)":[0,0],"New Mutator (24)":[-9,0]}]},{"name":"HeadTilt","type":"slider","steps":[{"New Mutator (19)":[15,0],"New Mutator (18)":[15,0],"New Mutator (20)":[-34,0],"New Mutator (21)":[-29,0],"New Mutator (22)":[-75,0]},{"New Mutator (18)":[-15,0],"New Mutator (19)":[-15,0],"New Mutator (20)":[32,0],"New Mutator (21)":[42,0],"New Mutator (22)":[103,0]}]},{"name":"HeadTurn","type":"slider","steps":[{"New Mutator (12)":[-9,0],"New Mutator (13)":[-2,0],"New Mutator (14)":[7,0],"New Mutator (15)":[3,0],"New Mutator (16)":[2,0],"New Mutator (17)":[-7,0],"New Mutator (6)":[1,0],"New Mutator":[1,0]},{"New Mutator (14)":[-5,0],"New Mutator (12)":[3,0],"New Mutator (13)":[7,0],"New Mutator (15)":[-3,0],"New Mutator (16)":[-2,0],"New Mutator (17)":[10,0],"New Mutator":[-1,0],"New Mutator (6)":[-1,0]}]},{"name":"Mouth","type":"slider","steps":[{"New Mutator (8)":[1,1],"New Mutator (10)":[1,1],"New Mutator (9)":[0,0],"New Mutator (11)":[0,0]},{"New Mutator (8)":[1,1.1],"New Mutator (10)":[1,3.85],"New Mutator (9)":[0,-20],"New Mutator (11)":[0,3]}]},{"name":"RightEye-y","type":"slider","steps":[{"New Mutator":[0,-8]},{"New Mutator":[0,11]}]},{"name":"LeftEye-y","type":"slider","steps":[{"New Mutator (6)":[0,-7]},{"New Mutator (6)":[0,11]}]},{"name":"RightEye-x","type":"slider","steps":[{"New Mutator":[-7,0],"New Mutator (4)":[0.85,1]},{"New Mutator":[1,0],"New Mutator (4)":[1,1]},{"New Mutator":[13,0],"New Mutator (4)":[0.85,1]}]},{"name":"LeftEye-x","type":"slider","steps":[{"New Mutator (6)":[-12,0],"New Mutator (7)":[0.85,1]},{"New Mutator (7)":[1,1],"New Mutator (6)":[0,0]},{"New Mutator (6)":[9,0],"New Mutator (7)":[0.85,1]}]},{"name":"RightEyeClose","type":"slider","steps":[{"RightEyeLashes":[1,1],"New Mutator (1)":[0,0]},{"New Mutator (1)":[0,48],"RightEyeLashes":[1,-1.2]}]},{"name":"LeftEyeClose","type":"slider","steps":[{"New Mutator (5)":[0,0],"LeftEyeLashes":[1,1]},{"LeftEyeLashes":[1,-1.1],"New Mutator (5)":[0,50]}]}],"defaultFrame":{"New Mutator (1)":[0,-29],"RightEyeLashes":[1,1],"New Mutator (4)":[1,1],"New Mutator":[0,0],"New Mutator (5)":[0,-25],"LeftEyeLashes":[1,1],"New Mutator (7)":[1,1],"New Mutator (6)":[0,0],"New Mutator (8)":[1,1],"New Mutator (10)":[1,0.25],"New Mutator (9)":[0,0],"New Mutator (18)":[-1,0],"New Mutator (19)":[0,0],"New Mutator (20)":[0,0],"New Mutator (21)":[0,0],"New Mutator (22)":[0,0],"New Mutator (2)":[0,0],"New Mutator (3)":[0,0],"New Mutator (24)":[0,0],"New Mutator (23)":[0,0],"New Mutator (31)":[97,0],"New Mutator (33)":[16,0]},"shapes":[{"name":"ArmRight","type":"folder","items":[{"type":"sprite","points":[[92,688],[139,676],[186,690],[173,869],[70,764],[144,904],[94,908]],"translate":[277,593],"mutationVectors":[],"name":"BottomArmRight"},{"type":"sprite","points":[[452,597],[529,600],[413,697],[435,747],[516,759],[537,704]],"translate":[271,719],"mutationVectors":[],"name":"HandRight"}],"mutationVectors":[]},{"name":"ArmLeft","type":"folder","items":[{"type":"sprite","points":[[80,1054],[183,1046],[202,1203],[182,1283],[123,1289],[83,1174]],"translate":[-230,584],"mutationVectors":[],"name":"BottomArmLeft"},{"type":"sprite","points":[[212,1432],[229,1591],[94,1596],[109,1435]],"translate":[-224,748],"mutationVectors":[],"name":"HandLeft"}],"mutationVectors":[{"type":"rotate","origin":[-245,483],"name":"New Mutator (31)"}]},{"type":"sprite","points":[[552,363],[633,363],[635,1808],[770,2028],[725,2040],[552,2010],[503,1913]],"translate":[157,958],"mutationVectors":[{"type":"rotate","origin":[128,682],"name":"New Mutator (33)"}],"name":"Broom"},{"name":"Head","type":"folder","items":[{"type":"sprite","points":[[1013,495],[1023,467],[1021,419],[1024,374],[1023,323],[1000,281],[955,263],[888,267],[836,303],[817,354],[813,412],[811,457],[822,473],[840,459],[847,431],[854,398],[856,368],[912,338],[917,361],[934,337],[971,345],[998,363],[998,409],[994,435],[999,471]],"translate":[-6,-36],"mutationVectors":[{"type":"deform","origin":[-98,48],"name":"New Mutator (21)","radius":96},{"type":"deform","origin":[87,54],"name":"New Mutator (20)","radius":101},{"name":"New Mutator (16)","type":"translate","origin":[0,0],"radius":-1}],"name":"HairFront"},{"type":"sprite","points":[[221,213],[265,212],[266,230],[223,233]],"translate":[2,46],"mutationVectors":[{"name":"New Mutator (14)","type":"translate","origin":[0,0],"radius":-1}],"name":"Nose"},{"type":"sprite","points":[[776,110],[780,98],[793,90],[805,91],[818,92],[830,95],[842,106],[833,114],[818,110],[795,108]],"translate":[-42,-46],"mutationVectors":[{"name":"New Mutator (3)","type":"translate","origin":[0,0],"radius":-1},{"type":"rotate","origin":[-55,-48],"name":"New Mutator (2)"}],"name":"LeftEyebrow"},{"type":"sprite","points":[[774,139],[783,154],[794,148],[810,146],[824,148],[837,150],[837,139],[825,132],[808,129],[788,132]],"translate":[41,-43],"mutationVectors":[{"name":"New Mutator (23)","type":"translate","origin":[0,0],"radius":-1},{"type":"rotate","origin":[54,-44],"name":"New Mutator (24)"}],"name":"RightEyebrow"},{"name":"LeftEyeLashes","type":"sprite","points":[[679,86],[679,108],[738,111],[736,86]],"translate":[-47,-13],"mutationVectors":[{"type":"stretch","origin":[-47,-6],"name":"LeftEyeLashes","radius":-1}]},{"name":"RightEyeLashes","type":"sprite","points":[[613,106],[668,108],[667,86],[611,84]],"translate":[43,-14],"mutationVectors":[{"type":"stretch","origin":[37,-6],"name":"RightEyeLashes","radius":-1}]},{"name":"Face","type":"sprite","points":[[431,266],[485,277],[509,270],[507,259],[435,255],[481,248],[462,248],[462,277],[572,54],[373,52],[572,272],[375,277]],"translate":[2,-34],"mutationVectors":[{"type":"deform","origin":[2,79],"name":"New Mutator (9)","radius":26}]},{"type":"sprite","points":[[128,165],[135,173],[145,170],[162,129],[160,113],[151,102],[134,113],[130,121]],"translate":[93,-3],"mutationVectors":[{"name":"New Mutator (12)","type":"translate","origin":[0,0],"radius":-1}],"name":"RightEar"},{"type":"sprite","points":[[103,111],[112,168],[103,176],[92,174],[74,110],[86,104]],"translate":[-91,-6],"mutationVectors":[{"name":"New Mutator (13)","type":"translate","origin":[0,0],"radius":-1}],"name":"LeftEar"},{"name":"UpperTeeth","type":"sprite","points":[[636,235],[717,236],[717,247],[694,256],[653,256],[636,245]],"translate":[0,65],"mutationVectors":[{"name":"New Mutator (11)","type":"translate","origin":[0,0]}]},{"name":"Mouth","type":"sprite","points":[[759,189],[761,210],[770,228],[785,235],[814,235],[833,232],[844,218],[847,194]],"translate":[0,83],"mutationVectors":[{"type":"stretch","origin":[1,65],"name":"New Mutator (10)","radius":-1}]},{"name":"Jaw","type":"sprite","points":[[612,266],[787,262],[777,310],[737,355],[701,362],[662,352],[622,313]],"translate":[0,87],"mutationVectors":[{"type":"stretch","origin":[0,40],"name":"New Mutator (8)","radius":-1}]},{"name":"RightEye","type":"folder","items":[{"name":"RightEyeLid","type":"sprite","points":[[618,149],[664,142],[657,131],[646,128],[630,128],[620,138],[634,149],[645,148]],"translate":[41,-11],"mutationVectors":[{"type":"deform","origin":[38,-6],"name":"New Mutator (1)","radius":15}]},{"name":"RightEyeWhite (1)","type":"sprite","points":[[624,79],[630,79],[630,71],[621,71]],"translate":[30,-10],"mutationVectors":[]},{"name":"RightIrisPupil","type":"sprite","points":[[653,186],[653,160],[627,160],[627,186]],"translate":[37,-9],"mutationVectors":[{"name":"New Mutator","type":"translate","origin":[0,0]},{"type":"stretch","origin":[38,-9],"name":"New Mutator (4)","radius":-1}]},{"name":"RightEyeWhite","type":"sprite","points":[[621,197],[620,228],[667,197],[666,227]],"translate":[40,-6],"mutationVectors":[]}],"mutationVectors":[]},{"name":"LeftEye","type":"folder","items":[{"name":"LeftEyeLid","type":"sprite","points":[[688,143],[695,131],[709,127],[721,129],[731,136],[736,151],[704,146],[716,148]],"translate":[-42,-12],"mutationVectors":[{"type":"deform","origin":[-42,-9],"name":"New Mutator (5)","radius":15}]},{"name":"LeftEyeWhite","type":"sprite","points":[[697,77],[705,78],[706,70],[697,70]],"translate":[-48,-12],"mutationVectors":[]},{"name":"LeftIrisPupil","type":"sprite","points":[[698,161],[698,186],[724,186],[724,161]],"translate":[-42,-11],"mutationVectors":[{"name":"New Mutator (6)","type":"translate","origin":[0,0]},{"type":"stretch","origin":[-41,-10],"name":"New Mutator (7)","radius":-1}]},{"name":"LeftEyeWhite (1)","type":"sprite","points":[[685,197],[685,227],[734,229],[733,197]],"translate":[-43,-6],"mutationVectors":[]}],"mutationVectors":[]}],"mutationVectors":[{"type":"rotate","origin":[-5,98],"name":"New Mutator (18)"},{"name":"New Mutator (15)","type":"translate","origin":[0,0],"radius":-1}]},{"type":"sprite","points":[[1214,246],[2027,1820],[1738,244],[961,1842],[1620,334],[1681,336],[1678,350],[1629,369]],"translate":[14,896],"mutationVectors":[],"name":"Body2"},{"type":"sprite","points":[[325,586],[430,939],[384,658],[320,941],[198,687],[197,654],[269,585]],"translate":[227,359],"mutationVectors":[],"name":"TopArmRight"},{"type":"sprite","points":[[415,1020],[482,1105],[434,1125],[335,1373],[268,1384],[238,1331],[284,1061],[346,1031]],"translate":[-173,354],"mutationVectors":[],"name":"TopArmLeft"},{"type":"sprite","points":[[779,611],[822,582],[864,568],[921,567],[979,582],[1013,632],[1042,707],[1038,813],[1028,847],[1040,912],[1030,948],[1027,1024],[990,1103],[954,1120],[907,1064],[867,1106],[822,1083],[779,1105],[750,1084],[754,992],[743,934],[759,844],[753,753],[761,709],[747,660]],"translate":[-2,108],"mutationVectors":[{"type":"deform","origin":[-7,263],"name":"New Mutator (22)","radius":331},{"type":"rotate","origin":[-3,106],"name":"New Mutator (19)"},{"name":"New Mutator (17)","type":"translate","origin":[0,0],"radius":-1}],"name":"HairBack"}],"version":"1.0"}'));let X=[];const z=t=>{X=X.filter((e=>e.name!==t))},D=(t,e,a,o,r)=>new Promise((n=>{z(t);let i=e;X=X.concat({name:t,ticker:()=>{i===a?(z(t),n()):i<a?i+=Math.min(o,a-i):i-=Math.min(o,i-a),r(i)}})})),H=(t,e)=>new Promise((a=>{z(t);let o=e;X=X.concat({name:t,ticker:()=>{0===o?(z(t),a()):o--}})})),O=document.getElementById("root"),Y=(t,e)=>async a=>{t.startTrack("Talking",{startAt:800}),t.startTrack("Eyebrows");const o=(t=>{const a=document.createElement("div");a.classList.add("dialogbox");const o=document.createElement("h3");o.classList.add("dialogname"),o.textContent=e,a.appendChild(o),O.appendChild(a);const r=document.createElement("p");return r.textContent=t,a.appendChild(r),()=>{O.removeChild(a)}})(a);(async e=>{await H("talking",6*e.length),t.startTrack("StopTalking"),t.startTrack("EyebrowReset")})(a),await(async()=>new Promise((t=>{const e=()=>{t(),O.removeEventListener("click",e)};O.addEventListener("click",e)})))(),t.startTrack("StopTalking"),t.startTrack("EyebrowReset"),o()},G=async t=>{await H("startTalking",60);const e=Y(t,"Innkeeper");await e("Hi! Welcome adventurer, welcome to my inn! Is there something you want to know?"),await(async t=>{let e=!0;const a={endDialog:()=>{e=!1}};for(;e;){const e=document.createElement("div");e.classList.add("choicebox"),O.appendChild(e);const o=await new Promise((a=>{Object.keys(t).forEach((t=>{const o=document.createElement("button");o.textContent=t,o.addEventListener("click",(()=>{O.removeChild(e),setTimeout((()=>{a(t)}))})),e.appendChild(o)}))}));await t[o](a)}})({"What is Geppetto?":async()=>{await e("Geppetto consists of two parts. A desktop application to define animated images, and a JavaScript library to play them.")},"Is Geppetto free?":async()=>{await e("Yes! It is free to use and distribute. It's also opensource (MIT License). So everyone can see how it works and extend it.")},"How does it work?":async()=>{await e("You need to create a texture file as .PNG. in Geppetto you will make layers from your texture, and compose them into your image."),await e("The next step is to add mutations to your layer tree to create motion. You can then create timelines to define multiple animations.")},"I think I'll start exploring!":async({endDialog:t})=>{await e("Good luck!"),t()}})},$=document.getElementById("theatre"),j=(t=>{const e=A(t);return e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),C(t)})($),J=async t=>new Promise((e=>{const a=new Image;a.crossOrigin="anonymous",a.src=t,a.onload=()=>e(a)}));(async()=>{try{const t=await J(F),e=b(U),a=j.addAnimation(e,t,0,{zoom:2,panX:0}),o=await J(P),r=b(W),n={zoom:.26,panX:-2.1,panY:-.5,zIndex:2},i={zoom:2.2,panX:-.3,panY:.1,zIndex:2},s=j.addAnimation(r,o,1,n),u=$.getBoundingClientRect(),l=navigator.userAgent.includes("SMART-TV")?2:1;$.width=Math.min(2048,u.width*window.devicePixelRatio*l),$.height=Math.min(1024,u.height*window.devicePixelRatio*l),window.addEventListener("resize",(()=>{const t=$.getBoundingClientRect();$.width=t.width*window.devicePixelRatio,$.height=t.height*window.devicePixelRatio})),a.startTrack("Wheel"),a.startTrack("WheelBlades"),a.startTrack("Tree"),a.startTrack("Bird"),a.startTrack("Cloud1",{speed:.15}),a.startTrack("Cloud2",{speed:.1}),a.startTrack("Cloud3",{speed:.15}),a.startTrack("Eyes"),a.startTrack("Smoke"),a.startTrack("Water");let m=!0;s.startTrack("Eye blink"),s.startTrack("HeadTilt");const c=async()=>{const t=.0025,e={x:.72,y:.87,z:.8},o=.51,r=.29,n=.95,i={...e};a.setControlValue("ButterflyX",i.x),a.setControlValue("ButterflyY",i.y),a.setControlValue("ButterflyZoom",i.z),a.startTrack("ButterflyWings",{speed:.2}),await H("bfParked",320);let s=!1;const u=(e,o,r)=>(s||(a.startTrack("ButterflyWings"),s=!0),e<i.x?a.setControlValue("ButterflyTurn",0):a.setControlValue("ButterflyTurn",1),Promise.all([D("ButterflyX",i.x,e,t,(t=>{i.x=t,a.setControlValue("ButterflyX",t)})),D("ButterflyY",i.y,o,t,(t=>{i.y=t,a.setControlValue("ButterflyY",t)})),D("ButterflyZoom",i.z,r,.025,(t=>{i.z=t,a.setControlValue("ButterflyZoom",t)}))])),l=()=>{const t=.3*Math.random();let e=Math.random()>.5?1:-1,a=Math.random()>.5?1:-1;(i.x+e*t>1||i.x+e*t<0)&&(e*=-1),(i.y+a*t>1||i.y+a*t<0)&&(a*=-1);const o=i.x+e*t,r=i.y+a*t,n=Math.min(Math.max(i.z+Math.random()*t,0),1);return u(o,r,n)};for(;;){const t=Math.random();t>.95?(await u(e.x,e.y,e.z),s&&(a.startTrack("ButterflyWings",{speed:.2}),s=!1),await H("bfParked",320)):t<.05?(await u(o,r,n),s&&(a.startTrack("ButterflyWings",{speed:.2}),s=!1),await H("bfParked",320)):await l()}};(()=>{let t=[0,0];const e=[.145,.388],a=(e,a)=>Promise.all([D("eye-X",t[0],e,.025,(e=>{t[0]=e,s.setControlValue("RightEye-x",e+1),s.setControlValue("LeftEye-x",e+1),s.setControlValue("HeadTurn",1-.5*(e+1))})),D("eye-Y",t[1],a,.025,(e=>{t[1]=e,s.setControlValue("RightEye-y",.5*(e+1)),s.setControlValue("LeftEye-y",.5*(e+1))}))]).then((()=>{}));$.addEventListener("click",(async t=>{const o=$.getBoundingClientRect(),r=[t.x/o.width,t.y/o.height];if(r[0]>.203&&r[0]<.263&&r[1]>.458&&r[1]<.706&&m)return s.setZoom(i.zoom),s.setPanning(i.panX,i.panY),m=!1,void G(s).then((()=>{s.setZoom(n.zoom),s.setPanning(n.panX,n.panY),m=!0}));const u=Math.min(1,Math.max(-1,(r[0]-e[0])/.4)),l=Math.min(1,Math.max(-1,(r[1]-e[1])/.4));z("resetDelay"),await a(u,l),await H("resetDelay",180),await a(0,-.1)})),a(0,-.1)})(),c();const p=()=>{(()=>{for(const t of X)t.ticker()})(),j.render(),a.render(),s.render(),window.requestAnimationFrame(p)};window.requestAnimationFrame(p)}catch(t){writeError(t.message)}})();
//# sourceMappingURL=index.03816cdd.js.map
