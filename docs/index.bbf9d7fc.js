function t(t){return t&&t.__esModule?t.default:t}var e,n,o,r,a=!1;function i(t,e,n,o){const r=t-n,a=e-o;return r*r+a*a}function s(t,e,n,o,r,a){const i=(o-e)*(r-t),s=(n-t)*(a-e);return Math.abs(i-s)>=33306690738754716e-32*Math.abs(i+s)?i-s:0}function u(t,e,n,o,r,a){return(s(r,a,t,e,n,o)||s(t,e,n,o,r,a)||s(n,o,r,a,t,e))<0}function l(t,e,n,o,r,a,i,s){const u=t-i,l=e-s,c=n-i,m=o-s,h=r-i,f=a-s,p=c*c+m*m,d=h*h+f*f;return u*(m*d-p*f)-l*(c*d-p*h)+(u*u+l*l)*(c*f-m*h)<0}function c(t,e,n,o,r,a){const i=n-t,s=o-e,u=r-t,l=a-e,c=i*i+s*s,m=u*u+l*l,h=.5/(i*l-s*u),f=(l*c-s*m)*h,p=(i*m-u*c)*h;return f*f+p*p}function m(t,e,n,o){if(o-n<=20)for(let r=n+1;r<=o;r++){const o=t[r],a=e[o];let i=r-1;for(;i>=n&&e[t[i]]>a;)t[i+1]=t[i--];t[i+1]=o}else{let r=n+1,a=o;h(t,n+o>>1,r),e[t[n]]>e[t[o]]&&h(t,n,o),e[t[r]]>e[t[o]]&&h(t,r,o),e[t[n]]>e[t[r]]&&h(t,n,r);const i=t[r],s=e[i];for(;;){do{r++}while(e[t[r]]<s);do{a--}while(e[t[a]]>s);if(a<r)break;h(t,r,a)}t[n+1]=t[a],t[a]=i,o-r+1>=a-n?(m(t,e,r,o),m(t,e,n,a-1)):(m(t,e,n,a-1),m(t,e,r,o))}}function h(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function f(t){return t[0]}function p(t){return t[1]}function d(){var t,a,s,h;e={},n=Math.pow(2,-52),o=new Uint32Array(512),r=class t{static from(e,n=f,o=p){const r=e.length,a=new Float64Array(2*r);for(let t=0;t<r;t++){const r=e[t];a[2*t]=n(r),a[2*t+1]=o(r)}return new t(a)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:o,_hullTri:r,_hullHash:a}=this,s=t.length>>1;let l=1/0,h=1/0,f=-1/0,p=-1/0;for(let e=0;e<s;e++){const n=t[2*e],o=t[2*e+1];n<l&&(l=n),o<h&&(h=o),n>f&&(f=n),o>p&&(p=o),this._ids[e]=e}const d=(l+f)/2,y=(h+p)/2;let g,w,M,E=1/0;for(let e=0;e<s;e++){const n=i(d,y,t[2*e],t[2*e+1]);n<E&&(g=e,E=n)}const N=t[2*g],x=t[2*g+1];E=1/0;for(let e=0;e<s;e++){if(e===g)continue;const n=i(N,x,t[2*e],t[2*e+1]);n<E&&n>0&&(w=e,E=n)}let V=t[2*w],_=t[2*w+1],T=1/0;for(let e=0;e<s;e++){if(e===g||e===w)continue;const n=c(N,x,V,_,t[2*e],t[2*e+1]);n<T&&(M=e,T=n)}let R=t[2*M],v=t[2*M+1];if(T===1/0){for(let e=0;e<s;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];m(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let n=0;for(let t=0,o=-1/0;t<s;t++){const r=this._ids[t];this._dists[r]>o&&(e[n++]=r,o=this._dists[r])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(u(N,x,V,_,R,v)){const t=w,e=V,n=_;w=M,V=R,_=v,M=t,R=e,v=n}const A=function(t,e,n,o,r,a){const i=n-t,s=o-e,u=r-t,l=a-e,c=i*i+s*s,m=u*u+l*l,h=.5/(i*l-s*u);return{x:t+(l*c-s*m)*h,y:e+(i*m-u*c)*h}}(N,x,V,_,R,v);this._cx=A.x,this._cy=A.y;for(let e=0;e<s;e++)this._dists[e]=i(t[2*e],t[2*e+1],A.x,A.y);m(this._ids,this._dists,0,s-1),this._hullStart=g;let L=3;o[g]=e[M]=w,o[w]=e[g]=M,o[M]=e[w]=g,r[g]=0,r[w]=1,r[M]=2,a.fill(-1),a[this._hashKey(N,x)]=g,a[this._hashKey(V,_)]=w,a[this._hashKey(R,v)]=M,this.trianglesLen=0,this._addTriangle(g,w,M,-1,-1,-1);for(let i,s,l=0;l<this._ids.length;l++){const c=this._ids[l],m=t[2*c],h=t[2*c+1];if(l>0&&Math.abs(m-i)<=n&&Math.abs(h-s)<=n)continue;if(i=m,s=h,c===g||c===w||c===M)continue;let f=0;for(let t=0,e=this._hashKey(m,h);t<this._hashSize&&(f=a[(e+t)%this._hashSize],-1===f||f===o[f]);t++);f=e[f];let p,d=f;for(;p=o[d],!u(m,h,t[2*d],t[2*d+1],t[2*p],t[2*p+1]);)if(d=p,d===f){d=-1;break}if(-1===d)continue;let y=this._addTriangle(d,c,o[d],-1,-1,r[d]);r[c]=this._legalize(y+2),r[d]=y,L++;let E=o[d];for(;p=o[E],u(m,h,t[2*E],t[2*E+1],t[2*p],t[2*p+1]);)y=this._addTriangle(E,c,p,r[c],-1,r[E]),r[c]=this._legalize(y+2),o[E]=E,L--,E=p;if(d===f)for(;p=e[d],u(m,h,t[2*p],t[2*p+1],t[2*d],t[2*d+1]);)y=this._addTriangle(p,c,d,-1,r[d],r[p]),this._legalize(y+2),r[p]=y,o[d]=d,L--,d=p;this._hullStart=e[c]=d,o[d]=e[E]=c,o[c]=E,a[this._hashKey(m,h)]=c,a[this._hashKey(t[2*d],t[2*d+1])]=d}this.hull=new Uint32Array(L);for(let t=0,e=this._hullStart;t<L;t++)this.hull[t]=e,e=o[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let a=0,i=0;for(;;){const s=n[t],u=t-t%3;if(i=u+(t+2)%3,-1===s){if(0===a)break;t=o[--a];continue}const c=s-s%3,m=u+(t+1)%3,h=c+(s+2)%3,f=e[i],p=e[t],d=e[m],y=e[h];if(l(r[2*f],r[2*f+1],r[2*p],r[2*p+1],r[2*d],r[2*d+1],r[2*y],r[2*y+1])){e[t]=y,e[s]=f;const r=n[h];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===h){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(s,n[i]),this._link(i,h);const u=c+(s+1)%3;a<o.length&&(o[a++]=u)}else{if(0===a)break;t=o[--a]}}return i}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,o,r,a){const i=this.trianglesLen;return this._triangles[i]=t,this._triangles[i+1]=e,this._triangles[i+2]=n,this._link(i,o),this._link(i+1,r),this._link(i+2,a),this.trianglesLen+=3,i}},t=e,a="default",s=function(){return r},Object.defineProperty(t,a,{get:s,enumerable:!0}),h=e,Object.defineProperty(h,"__esModule",{value:!0})}var y,g=(a||(a=!0,d()),(y=e)&&y.__esModule?y.default:y);const w=t=>"folder"===t.type||"sprite"===t.type,M=(t,e,n=[])=>{for(const o of t){e(o,n);for(const t of o.mutationVectors)e(t,[...n,o]);"folder"===o.type&&M(o.items,e,[...n,o])}},E=t=>t.reduce(((t,e)=>t.concat(e)),[]),N=t=>({data:new Float32Array(E(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),x=t=>({data:new Int16Array(E(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),V={translate:1,stretch:2,rotate:3,deform:4,opacity:5},_=(t,e)=>{const n=t[t.length-1];if(w(n)){const o=e?n.mutationVectors.indexOf(e):-1;if(o>0)return n.mutationVectors[o-1];for(let n=t.length-(e?2:1);n>=0;n--){const e=t[n];if(e&&w(e)&&e.mutationVectors.length>0)return e.mutationVectors[e.mutationVectors.length-1]}}return null},T=t=>{const e=t.controls.map((t=>t.name));return t.animations.map((t=>{const n=[];return t.keyframes.reduce(((t,e)=>t.concat(Object.keys(e.controlValues))),[]).filter(((t,e,n)=>n.indexOf(t)===e)).forEach((o=>{const r=[];t.keyframes.forEach((t=>{const e=t.controlValues[o];void 0!==e&&r.push([t.time,e])})),n.push([e.indexOf(o),new Float32Array(E(r))])})),{name:t.name,duration:t.keyframes[t.keyframes.length-1].time,looping:t.looping,tracks:n}}))};var R=t=>{const e=[],n=[],o=[];M(t.shapes,(t=>{if("sprite"!==t.type)return;const r=(t=>{let e=1/0,n=-1/0,o=1/0,r=-1/0;return t.points.forEach((([t,a])=>{e=t<e?t:e,n=t>n?t:n,o=a<o?a:o,r=a>r?a:r})),[(e+n)/2,(o+r)/2]})(t),a=(i=t.points,g.from(i).triangles);var i;const s=[...t.translate,.1*e.length],u=n.length;e.push({name:t.name,start:2*o.length,amount:a.length,mutator:0,x:s[0],y:s[1],z:1e-4*s[2]-.9}),t.points.forEach((([t,e])=>{n.push([t-r[0],e-r[1],t,e])})),a.forEach((t=>{o.push(t+u)}))}));const r=(t=>{const e=[],n=[],o={};M(t,((t,r)=>{if((t=>"deform"===t.type||"rotate"===t.type||"translate"===t.type||"stretch"===t.type||"opacity"===t.type)(t)){const i=[V[(a=t).type],a.origin[0],a.origin[1],"deform"===a.type||"translate"===a.type?a.radius:-1],s=n.length;n.push(i);const u=_(r,t),l=null===u?-1:e.findIndex((t=>t.name===u.name));e.push({name:t.name,index:s,parent:l}),o[t.name]=l}var a}));const r={};M(t,((t,n)=>{if(w(t)){const o=_(n.concat(t)),a=null===o?-1:e.findIndex((t=>t.name===o.name));r[t.name]=a}}));const a=new Int16Array(n.length);return e.forEach(((t,e)=>{a[e]=t.parent})),{mutatorMapping:o,parentList:a,vectorSettings:n,shapeMutatorMapping:r}})(t.shapes),a=r.parentList.length,i=Object.keys(r.mutatorMapping),s=[],u=new Float32Array(2*a);Object.entries(t.defaultFrame).forEach((([t,e])=>{const n=i.indexOf(t);-1!==n&&(u[2*n]=e[0],u[2*n+1]=e[1])}));const l=[],c=[],m=[];e.forEach((t=>{t.mutator=r.shapeMutatorMapping[t.name]})),e.sort(((t,e)=>(e.z||0)-(t.z||0)));const h=new Float32Array(t.controls.length),f=t.controls.reduce(((e,n,o)=>{const r=n.steps.reduce(((t,e)=>t.concat(Object.keys(e).filter((e=>!t.includes(e))))),[]);return s.push({name:n.name,steps:n.steps.length}),h[o]=t.controlValues[n.name],r.forEach((o=>{const r=i.indexOf(o),a=n.steps.map((t=>t[o])),s=t?.controls?.findIndex?.((t=>t.name===n.name))||0,u={name:n.name,controlIndex:s,valueStartIndex:l.length,values:a,stepType:0};l.push(...a),e={...e,[r]:{controls:((e[r]||{}).controls||[]).concat(u)}}})),e}),{}),p=Math.max(...Object.keys(f).map((t=>parseInt(t,10))));m.length=p,m.fill([0,0]);let d=0;return Object.entries(f).forEach((([t,e])=>{const n=e.controls.map((t=>[t.valueStartIndex,t.controlIndex,t.stepType]));m[parseInt(t,10)]=[c.length,n.length],d=Math.max(d,n.length),c.push(...n)})),{mutators:N(r.vectorSettings),mutatorParents:{data:r.parentList,length:r.parentList.length,stride:1},mutationValues:{data:u,length:r.parentList.length,stride:2},controlMutationValues:N(l),mutationValueIndices:x(c),controlMutationIndices:x(m),defaultControlValues:h,shapeVertices:N(n),shapeIndices:new Uint16Array(o),shapes:e,controls:s,maxIteration:d,animations:T(t)}};const v=(t,e,n=0)=>{for(let o=0;o<t.length;o+=2)if(t[o]>e){const r=o>1?t[o-2]:0,a=o>1?t[o-1]:n,i=(e-r)/(t[o]-r);return a*(1-i)+t[o+1]*i}return t[t.length-1]},A={zoom:1,panX:0,panY:0,zIndex:0};const L=t=>{const e=t.getContext("webgl",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"}),n=[];let o=[],r=[],a=[];return{render:()=>{e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,t.width,t.height)},addAnimation:(i,s,u,l)=>{const c=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9][u],[m,h,f]=((t,e)=>{const n=t.createProgram();if(!n)throw new Error("Failed to create shader program");const o=(t=>{return`\n  uniform vec2 viewport;\n  uniform vec3 basePosition;\n  uniform vec3 translate;\n  uniform float mutation;\n  uniform vec4 scale;\n\n  attribute vec2 coordinates;\n  attribute vec2 aTextureCoord;\n\n  varying lowp vec2 vTextureCoord;\n  varying lowp float vOpacity;\n\n  mat4 viewportScale = mat4(\n    2.0 / viewport.x, 0, 0, 0,   \n    0, -2.0 / viewport.y, 0, 0,    \n    0, 0, 1, 0,    \n    -1, +1, 0, 1\n  );\n\n  ${(t=>`\n  uniform vec2 uControlMutationValues[${t.controlMutationValues.length}];\n  uniform vec3 uMutationValueIndices[${t.mutationValueIndices.length}];\n  uniform vec2 uControlMutationIndices[${t.controlMutationIndices.length}];\n\n  uniform float uControlValues[${t.controls.length}];\n  uniform vec2 uMutationValues[${t.mutators.length}];\n\n  vec2 getMutationValue(int mutationIndex, int mutationType) {\n    vec2 result = uMutationValues[mutationIndex];\n    vec2 controlMutations = uControlMutationIndices[mutationIndex];\n    int start = int(controlMutations.x);\n    int steps = int(controlMutations.y);\n    if (steps == 0) {\n      return result;\n    }\n    for(int i = 0; i < ${t.maxIteration}; i++) {\n      if (i < steps) {\n        vec3 valueIndices = uMutationValueIndices[start + i];\n        // x = offset\n        // y = control value index\n        // z = stepType\n        float controlValue = uControlValues[int(valueIndices.y)];\n\n        int startIndex = int(floor(valueIndices.x + controlValue));\n        int endIndex = int(ceil(valueIndices.x + controlValue));\n        float mixFactor = controlValue - floor(controlValue);\n\n        vec2 mutAValue = uControlMutationValues[startIndex];\n        vec2 mutBValue = uControlMutationValues[endIndex];\n        vec2 mutValue = mix(mutAValue, mutBValue, mixFactor);\n\n        if (mutationType == 2 || mutationType == 5) { // Stretch & Opacity\n          result *= mutValue;\n        } else {\n          result += mutValue;\n        }\n      } else {\n        return result;\n      }\n    }\n\n    return result;\n  }\n`)(t)}\n  ${e=t.mutators.length,`\n  #define PI_FRAC 0.017453292519943295\n\n  // x = type, yz = origin, a = radius\n  uniform vec4 uMutationVectors[${e}];\n  uniform float uMutationParent[${e}];\n\n  vec3 mutateOnce(vec3 startValue, int mutationIndex) {\n    vec4 mutation = uMutationVectors[mutationIndex];\n    int mutationType = int(mutation.x);\n\n    vec2 mutationValue = getMutationValue(mutationIndex, mutationType);\n    vec2 origin = mutation.yz;\n    vec3 result = startValue;\n\n    if (mutationType == 1) { // Translate\n      float effect = 1.0;\n      if (mutation.a > 0.0 && distance(startValue.xy, origin) > mutation.a) {\n        effect = 0.0;\n      }\n      result = vec3(startValue.xy + mutationValue * effect, startValue.z);\n    }\n\n    if (mutationType == 2) { // Stretch\n      result = vec3(origin.xy + vec2(\n        (startValue.x - origin.x) * mutationValue.x, \n        (startValue.y - origin.y) * mutationValue.y\n      ), startValue.z);\n    }\n\n    if (mutationType == 3) { // Rotation\n      float rotation = mutationValue.x * PI_FRAC;\n      mat2 entityRotationMatrix = mat2(cos(rotation), sin(rotation), -sin(rotation), cos(rotation));\n      result = vec3((startValue.xy - origin) * entityRotationMatrix + origin, startValue.z);\n    }\n\n    if (mutationType == 4) { // Deform\n      float effect = 1.0 - clamp(distance(startValue.xy, origin), 0.0, mutation.a) / mutation.a;\t\n      result = vec3(startValue.xy + mutationValue * effect, startValue.z);\t\n    }\n\n    if (mutationType == 5) { // Opacity\n      float opacity = mutationValue.x;\n      result = vec3(startValue.xy, startValue.z * opacity);\t\n    }\n\n    return result;\n  }\n\n  vec3 mutatePoint(vec3 startValue, int mutationIndex) {\n    int currentNode = mutationIndex;\n    vec3 result = startValue;\n\n    for(int i = 0; i < ${e}; i++) {\n        if (currentNode == -1) {\n            return result;\n        }\n        result = mutateOnce(result, currentNode);\n        currentNode = int(uMutationParent[currentNode]);\n    }\n    return result;\n  }\n\n`}\n\n  void main() {\n    vec3 deform = mutatePoint(vec3(coordinates + translate.xy, 1.0), int(mutation));\n\n    vec4 pos = viewportScale * vec4((deform.xy + basePosition.xy) * scale.x, translate.z - basePosition.z, 1.0);\n    gl_Position = vec4((pos.xy + scale.ba) * scale.y, pos.z, 1.0);\n    vTextureCoord = aTextureCoord.xy;\n    vOpacity = deform.z;\n  }\n`;var e})(e),r=t.createShader(t.VERTEX_SHADER),a=t.createShader(t.FRAGMENT_SHADER);if(!r||!a)throw t.deleteProgram(n),t.deleteShader(r),t.deleteShader(a),new Error("Failed to create shader program");if(t.shaderSource(r,o),t.shaderSource(a,"\nprecision mediump float;\n\nvarying mediump vec2 vTextureCoord;\nvarying mediump float vOpacity;\nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord = vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 texelColor = texture2D(uSampler, coord);\n\n  gl_FragColor = vec4(texelColor.rgb * texelColor.a * vOpacity, texelColor.a * vOpacity);\n}\n"),t.compileShader(r),t.compileShader(a),t.attachShader(n,r),t.attachShader(n,a),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw console.error("Link failed: "+t.getProgramInfoLog(n)),console.error("vs info-log: "+t.getShaderInfoLog(r)),console.error("fs info-log: "+t.getShaderInfoLog(a)),new Error("Could not initialise shaders");return[n,r,a]})(e,i);e.useProgram(m);const p=((t,e,n)=>{const o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.useProgram(e),t.uniform2f(t.getUniformLocation(e,"uTextureDimensions"),n.width,n.height),o})(e,m,s),d=((t,e)=>(n,o)=>{const r=t.getUniformLocation(e,n),a=o.stride;1==a?t.uniform1fv(r,o.data):2==a?t.uniform2fv(r,o.data):3==a?t.uniform3fv(r,o.data):4==a&&t.uniform4fv(r,o.data)})(e,m);d("uMutationVectors",i.mutators),d("uMutationParent",i.mutatorParents),d("uMutationValues",i.mutationValues),d("uControlMutationValues",i.controlMutationValues),d("uMutationValueIndices",i.mutationValueIndices),d("uControlMutationIndices",i.controlMutationIndices);const y=e.getUniformLocation(m,"uControlValues");e.uniform1fv(y,i.defaultControlValues);const g=new Float32Array(i.defaultControlValues),w=new Float32Array(i.defaultControlValues),M=e.createBuffer(),E=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,M),e.bufferData(e.ARRAY_BUFFER,i.shapeVertices.data,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,E),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.shapeIndices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);const N=e.getUniformLocation(m,"basePosition"),x=e.getUniformLocation(m,"translate"),V=e.getUniformLocation(m,"mutation"),_=e.getUniformLocation(m,"viewport"),T=e.getUniformLocation(m,"scale"),R=e.getAttribLocation(m,"coordinates"),L=e.getAttribLocation(m,"aTextureCoord");let b=0,S=0,{zoom:I,panX:k,panY:C,zIndex:U}={...A,...l},P=[0,0],F=1;const O=[],B=i.animations.map((t=>t.name)),z=i.controls.map((t=>t.name)),D=i.animations.map((t=>t.looping)),X={destroy:function(){e.deleteShader(h),e.deleteShader(f),e.deleteProgram(m),e.deleteTexture(p),e.deleteBuffer(M),e.deleteBuffer(E),n.splice(n.indexOf(X),1)},setLooping:function(t,e){const n=B.indexOf(e);if(-1===n)throw new Error(`Track ${e} does not exist in ${B.join(",")}`);D[n]=t},startTrack:function(t){const e=B.indexOf(t);if(-1===e)throw new Error(`Track ${t} does not exist in ${B.join(",")}`);O.push({name:t,index:e,startAt:0,startedAt:+new Date})},stopTrack:t=>{const e=O.findIndex((e=>e.name===t));if(-1===e)return;const n=O[e];let r=+new Date-n.startedAt+n.startAt;const s=i.animations[n.index];D[n.index]&&(r%=s.duration),O.splice(e,1);for(const e of o)e(t);for(const[t,e]of s.tracks){const n=v(e,r,g[t]);g[t]=n;for(const e of a)e(t,n)}},setControlValue:(t,e)=>{const n=z.indexOf(t);if(-1===n)throw new Error(`Control ${t} does not exist in ${z.join(",")}`);const o=i.controls[n].steps-1;if(e<0||e>o)throw new Error(`Control ${t} value shoulde be between 0 and ${o}. ${e} is out of bounds.`);g[n]=e},setPanning:function(t,e){k=t,C=e},setZoom:function(t){I=t},setZIndex:function(t){U=t},render:function(){if(e.useProgram(m),e.bindBuffer(e.ARRAY_BUFFER,M),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,E),e.vertexAttribPointer(R,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),e.enableVertexAttribArray(R),e.vertexAttribPointer(L,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,2*Float32Array.BYTES_PER_ELEMENT),e.enableVertexAttribArray(L),t.width!==b||t.height!==S){const n=t.width,o=t.height,r=s.width/n>s.height/o;F=r?n/s.width:o/s.height,e.uniform2f(_,n,o),P=[n/2/F,o/2/F],b=t.width,S=t.height}e.uniform4f(T,F,I,k,C),e.activeTexture(c),e.bindTexture(e.TEXTURE_2D,p),e.uniform1i(e.getUniformLocation(m,"uSampler"),u),e.uniform3f(N,P[0],P[1],.01*U),w.set(g,0);const n=+new Date;for(const t of O){const e=n-t.startedAt+t.startAt,o=i.animations[t.index];if(o.duration<e&&!D[t.index]){for(const[t,n]of o.tracks){const o=v(n,e,g[t]);w[t]=o}continue}const r=e%o.duration;for(const[t,e]of o.tracks){const n=v(e,r,g[t]);w[t]=n}}e.uniform1fv(y,w);for(const t of i.shapes)e.uniform3f(x,t.x,t.y,t.z),e.uniform1f(V,t.mutator),e.drawElements(e.TRIANGLES,t.amount,e.UNSIGNED_SHORT,t.start)},onTrackStopped:function(t){return o=o.concat(t),()=>{o=o.filter((e=>e!==t))}},onEvent:function(t){return r=r.concat(t),()=>{r=r.filter((e=>e!==t))}},onControlChange:function(t){return a=a.concat(t),()=>{a=a.filter((e=>e!==t))}}};return n.push(X),X},destroy:function(){for(const t of n)t.destroy();n.length=0}}};var b=null;var S=function(){return b||(b=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),b},I=t(S()+"landscape.01ccf7de.png"),k=t(JSON.parse('{"animations":[{"name":"Waterrad","looping":true,"keyframes":[{"time":0,"controlValues":{"New Control":1,"Rad":1}},{"time":12000,"controlValues":{"New Control":0,"Rad":0}}]},{"name":"Waterrad2","looping":true,"keyframes":[{"time":0,"controlValues":{"Schoepen":0}},{"time":1000,"controlValues":{"Schoepen":1}}]},{"name":"Rook","looping":true,"keyframes":[{"time":0,"controlValues":{"Rook":0}},{"time":4999,"controlValues":{"Rook":2}}]}],"controlValues":{"New Control":0,"Rook":0,"Schoepen":1,"Rad":1},"controls":[{"name":"Rook","type":"slider","steps":[{"New Mutator (10)":[0,0],"New Mutator (9)":[0,0],"New Mutator (12)":[22,0],"New Mutator (11)":[0,0],"New Mutator (8)":[-23,0]},{"New Mutator (10)":[0,-100],"New Mutator (9)":[28,0],"New Mutator (12)":[-27,0],"New Mutator (11)":[-38,0],"New Mutator (8)":[47,0]},{"New Mutator (10)":[0,-216],"New Mutator (9)":[0,0],"New Mutator (12)":[22,0],"New Mutator (11)":[0,0],"New Mutator (8)":[-23,0]}]},{"name":"Schoepen","type":"slider","steps":[{"New Mutator (20)":[0,0],"New Mutator (17)":[0,0],"New Mutator (19)":[0,0],"New Mutator (18)":[0,0],"New Mutator (3)":[1,1],"New Mutator (7)":[0,0],"New Mutator (15)":[1,1],"New Mutator (16)":[0,0],"New Mutator (22)":[1,0.05],"New Mutator (21)":[0,0],"New Mutator (23)":[20,-35]},{"New Mutator (20)":[-43,-62],"New Mutator (17)":[72,0],"New Mutator (19)":[-36,-28],"New Mutator (18)":[69,0],"New Mutator (3)":[1,0.7],"New Mutator (7)":[-10,-91],"New Mutator (15)":[1,0.05],"New Mutator (16)":[0,0],"New Mutator (22)":[1,-0.6],"New Mutator (21)":[25,-88],"New Mutator (23)":[-3,0]}]},{"name":"Rad","type":"slider","steps":[{"New Mutator (1)":[0,0],"New Mutator (6)":[0,0]},{"New Mutator (1)":[360,0],"New Mutator (6)":[360,0]}]}],"defaultFrame":{"New Mutator":[0.45,1],"New Mutator (1)":[0,0],"New Mutator (2)":[0.5,1],"New Mutator (4)":[0.5,1],"New Mutator (5)":[0.45,1],"New Mutator (6)":[0,0],"New Mutator (17)":[84,0],"New Mutator (18)":[0,-3],"New Mutator (19)":[0,0],"New Mutator (3)":[1,1],"New Mutator (15)":[1,0.8],"New Mutator (16)":[63,0],"New Mutator (22)":[1,1],"New Mutator (10)":[0,0],"New Mutator (8)":[0,0],"New Mutator (11)":[0,0],"New Mutator (12)":[0,0],"New Mutator (9)":[0,0]},"shapes":[{"type":"sprite","points":[[3101,119],[3107,588],[2698,557],[2692,114]],"translate":[-214,-14],"mutationVectors":[],"name":"WheelHouse"},{"name":"Watermolen","type":"folder","items":[{"name":"Waterrad","type":"sprite","points":[[24,408],[384,408],[24,768],[384,768]],"translate":[-169,14],"mutationVectors":[{"type":"stretch","origin":[-181,14],"name":"New Mutator"},{"type":"rotate","origin":[-169,14],"name":"New Mutator (1)"}]},{"name":"Waterrad2","type":"sprite","points":[[24,24],[384,24],[24,384],[384,384]],"translate":[-187,15],"mutationVectors":[{"type":"stretch","origin":[-173,14],"name":"New Mutator (2)"}]},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-293,-14],"mutationVectors":[{"name":"New Mutator (21)","type":"translate","origin":[-15,-67]},{"type":"stretch","origin":[-291,12],"name":"New Mutator (22)"}],"name":"Schoep (1) (1)"},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-282,74],"mutationVectors":[{"name":"New Mutator (7)","type":"translate","origin":[-6,4]},{"type":"stretch","origin":[-283,102],"name":"New Mutator (15)"},{"type":"deform","origin":[-316,37],"name":"New Mutator (16)","radius":68}],"name":"Schoep (2)"},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-264,130],"mutationVectors":[{"name":"New Mutator (20)","type":"translate","origin":[-6,4]},{"type":"stretch","origin":[-268,156],"name":"New Mutator (3)"},{"type":"deform","origin":[-272,107],"name":"New Mutator (17)","radius":86}],"name":"Schoep (1)"},{"name":"Schoep","type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-213,162],"mutationVectors":[{"name":"New Mutator (19)","type":"translate","origin":[-6,4]},{"type":"deform","origin":[-216,131],"name":"New Mutator (18)","radius":76}]},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-205,159],"mutationVectors":[{"name":"New Mutator (23)","type":"translate","origin":[-6,4]}],"name":"Schoep (1) (2)"},{"name":"Waterrad (1)","type":"sprite","points":[[24,408],[384,408],[24,768],[384,768]],"translate":[-268,12],"mutationVectors":[{"type":"stretch","origin":[-274,12],"name":"New Mutator (5)"},{"type":"rotate","origin":[-268,12],"name":"New Mutator (6)"}]},{"name":"Waterrad2 (1)","type":"sprite","points":[[24,24],[384,24],[24,384],[384,384]],"translate":[-274,12],"mutationVectors":[{"type":"stretch","origin":[-281,9],"name":"New Mutator (4)"}]}],"mutationVectors":[]},{"type":"sprite","points":[[23,1265],[847,1273],[38,1915],[813,1912]],"translate":[-449,-87],"mutationVectors":[],"name":"House"},{"type":"sprite","points":[[97,790],[167,790],[244,789],[245,1178],[168,1176],[95,1176],[27,1176],[26,792],[26,825],[27,894],[25,960],[25,1030],[25,1093],[96,1143],[96,1068],[95,993],[95,925],[95,862],[167,822],[167,893],[166,964],[167,1035],[167,1115],[245,1083],[244,1000],[243,924],[241,856]],"translate":[-425,-348],"mutationVectors":[{"type":"deform","origin":[-478,-407],"name":"New Mutator (8)","radius":40},{"type":"deform","origin":[-386,-485],"name":"New Mutator (11)","radius":41},{"type":"deform","origin":[-473,-508],"name":"New Mutator (12)","radius":36},{"type":"deform","origin":[-385,-404],"name":"New Mutator (9)","radius":31},{"name":"New Mutator (10)","type":"translate","origin":[-5,0],"radius":-1}],"name":"Rook"},{"name":"Base Image","type":"sprite","points":[[710,-2],[712,1084],[2621,1086],[2621,2]],"translate":[0,0],"mutationVectors":[]}]}')),C=t(S()+"body-texture.4f175e26.png"),U=t(JSON.parse('{"animations":[{"name":"Eye blink","looping":true,"keyframes":[{"time":2500,"controlValues":{"LeftEyeClose":0,"RightEyeClose":0}},{"time":2750,"controlValues":{"LeftEyeClose":1,"RightEyeClose":1}},{"time":3000,"controlValues":{"RightEyeClose":0,"LeftEyeClose":0}}]},{"name":"Look around","looping":true,"keyframes":[{"time":1000,"controlValues":{"LeftEye-x":0.18,"RightEye-x":0.24}},{"time":2000,"controlValues":{"LeftEye-x":1,"RightEye-x":1.02}},{"time":3980,"controlValues":{"LeftEye-x":1.02,"RightEye-x":1}},{"time":5000,"controlValues":{"RightEye-x":1.8,"LeftEye-x":1.84}},{"time":6000,"controlValues":{"LeftEye-x":0.98,"RightEye-x":1.06}},{"time":8000,"controlValues":{"RightEye-x":1,"LeftEye-x":1}}]},{"name":"Talking","looping":true,"keyframes":[{"time":1000,"controlValues":{"Mouth":0}},{"time":1340,"controlValues":{"Mouth":0.62}},{"time":1670,"controlValues":{"Mouth":0}},{"time":2120,"controlValues":{"Mouth":0}},{"time":2430,"controlValues":{"Mouth":0.68}},{"time":2790,"controlValues":{"Mouth":0.24}},{"time":3160,"controlValues":{"Mouth":1}},{"time":3470,"controlValues":{"Mouth":0}}]},{"name":"Eyebrow Raise","looping":false,"keyframes":[{"time":2980,"controlValues":{"RightEyebrow1":0.12,"RightEyebrow2":0}}]},{"name":"Eyebrow lower","looping":false,"keyframes":[{"time":2990,"controlValues":{"RightEyebrow1":0.83,"RightEyebrow2":0.78}}]}],"controlValues":{"RightEye-x":1.02,"RightEye-y":0.38,"RightEyeClose":0,"RightEyebrow2":0.29,"RightEyebrow1":0.51,"LeftEyeClose":0,"LeftEye-x":0.92,"LeftEye-y":0.42,"Mouth":0},"controls":[{"name":"Mouth","type":"slider","steps":[{"New Mutator (8)":[1,1],"New Mutator (10)":[1,1],"New Mutator (9)":[0,0],"New Mutator (11)":[0,0]},{"New Mutator (8)":[1,1.1],"New Mutator (10)":[1,3.85],"New Mutator (9)":[0,-20],"New Mutator (11)":[0,3]}]},{"name":"RightEyebrow1","type":"slider","steps":[{"New Mutator (3)":[0,-27]},{"New Mutator (3)":[0,23]}]},{"name":"RightEyebrow2","type":"slider","steps":[{"New Mutator (2)":[0,-21]},{"New Mutator (2)":[0,39]}]},{"name":"RightEye-y","type":"slider","steps":[{"New Mutator":[0,-8]},{"New Mutator":[0,11]}]},{"name":"LeftEye-y","type":"slider","steps":[{"New Mutator (6)":[0,-7]},{"New Mutator (6)":[0,11]}]},{"name":"RightEye-x","type":"slider","steps":[{"New Mutator":[-7,0],"New Mutator (4)":[0.85,1]},{"New Mutator":[1,0],"New Mutator (4)":[1,1]},{"New Mutator":[13,0],"New Mutator (4)":[0.85,1]}]},{"name":"LeftEye-x","type":"slider","steps":[{"New Mutator (6)":[-12,0],"New Mutator (7)":[0.85,1]},{"New Mutator (7)":[1,1],"New Mutator (6)":[0,0]},{"New Mutator (6)":[9,0],"New Mutator (7)":[0.85,1]}]},{"name":"RightEyeClose","type":"slider","steps":[{"RightEyeLashes":[1,1],"New Mutator (1)":[0,0]},{"New Mutator (1)":[0,48],"RightEyeLashes":[1,-1.2]}]},{"name":"LeftEyeClose","type":"slider","steps":[{"New Mutator (5)":[0,0],"LeftEyeLashes":[1,1]},{"LeftEyeLashes":[1,-1.1],"New Mutator (5)":[0,50]}]}],"defaultFrame":{"New Mutator (1)":[0,-29],"New Mutator (2)":[0,2],"New Mutator (3)":[0,0],"RightEyeLashes":[1,1],"New Mutator (4)":[1,1],"New Mutator":[0,0],"New Mutator (5)":[0,-25],"LeftEyeLashes":[1,1],"New Mutator (7)":[1,1],"New Mutator (6)":[0,0],"New Mutator (8)":[1,1],"New Mutator (10)":[1,0.25],"New Mutator (9)":[0,0]},"shapes":[{"name":"Head","type":"folder","items":[{"name":"LeftEyeLashes","type":"sprite","points":[[679,86],[679,108],[738,111],[736,86]],"translate":[-47,-13],"mutationVectors":[{"type":"stretch","origin":[-47,-6],"name":"LeftEyeLashes"}]},{"name":"RightEyeLashes","type":"sprite","points":[[613,106],[668,108],[667,86],[611,84]],"translate":[43,-14],"mutationVectors":[{"type":"stretch","origin":[37,-6],"name":"RightEyeLashes"}]},{"name":"Face","type":"sprite","points":[[343,52],[599,54],[589,342],[358,344],[480,156],[485,169],[498,166],[511,165],[524,166],[535,170],[543,159],[529,152],[515,148],[495,152],[486,181],[541,184],[555,173],[549,144],[528,130],[495,130],[473,136],[469,169],[497,179],[510,176],[524,179],[431,266],[485,277],[509,270],[507,259],[435,255],[502,239],[481,248],[462,248],[448,239],[462,277]],"translate":[0,0],"mutationVectors":[{"type":"deform","origin":[2,79],"name":"New Mutator (9)","radius":26},{"type":"deform","origin":[44,-42],"name":"New Mutator (3)","radius":20},{"type":"deform","origin":[19,-39],"name":"New Mutator (2)","radius":16}]},{"name":"UpperTeeth","type":"sprite","points":[[636,235],[717,236],[717,247],[694,256],[653,256],[636,245]],"translate":[0,65],"mutationVectors":[{"name":"New Mutator (11)","type":"translate","origin":[0,0]}]},{"name":"Mouth","type":"sprite","points":[[759,189],[761,210],[770,228],[785,235],[814,235],[833,232],[844,218],[847,194]],"translate":[0,83],"mutationVectors":[{"type":"stretch","origin":[1,65],"name":"New Mutator (10)"}]},{"name":"Jaw","type":"sprite","points":[[612,266],[787,262],[777,310],[737,355],[701,362],[662,352],[622,313]],"translate":[0,87],"mutationVectors":[{"type":"stretch","origin":[0,40],"name":"New Mutator (8)"}]},{"name":"RightEye","type":"folder","items":[{"name":"RightEyeLid","type":"sprite","points":[[618,149],[664,142],[657,131],[646,128],[630,128],[620,138],[634,149],[645,148]],"translate":[41,-11],"mutationVectors":[{"type":"deform","origin":[38,-6],"name":"New Mutator (1)","radius":15}]},{"name":"RightEyeWhite (1)","type":"sprite","points":[[624,79],[630,79],[630,71],[621,71]],"translate":[30,-10],"mutationVectors":[]},{"name":"RightIrisPupil","type":"sprite","points":[[653,186],[653,160],[627,160],[627,186]],"translate":[37,-9],"mutationVectors":[{"name":"New Mutator","type":"translate","origin":[0,0]},{"type":"stretch","origin":[38,-9],"name":"New Mutator (4)"}]},{"name":"RightEyeWhite","type":"sprite","points":[[621,197],[620,228],[667,197],[666,227]],"translate":[40,-6],"mutationVectors":[]}],"mutationVectors":[]},{"name":"LeftEye","type":"folder","items":[{"name":"LeftEyeLid","type":"sprite","points":[[688,143],[695,131],[709,127],[721,129],[731,136],[736,151],[704,146],[716,148]],"translate":[-42,-12],"mutationVectors":[{"type":"deform","origin":[-42,-9],"name":"New Mutator (5)","radius":15}]},{"name":"LeftEyeWhite","type":"sprite","points":[[697,77],[705,78],[706,70],[697,70]],"translate":[-48,-12],"mutationVectors":[]},{"name":"LeftIrisPupil","type":"sprite","points":[[698,161],[698,186],[724,186],[724,161]],"translate":[-42,-11],"mutationVectors":[{"name":"New Mutator (6)","type":"translate","origin":[0,0]},{"type":"stretch","origin":[-41,-10],"name":"New Mutator (7)"}]},{"name":"LeftEyeWhite (1)","type":"sprite","points":[[685,197],[685,227],[734,229],[733,197]],"translate":[-43,-6],"mutationVectors":[]}],"mutationVectors":[]}],"mutationVectors":[]}]}'));const P=document.getElementById("theatre"),F=(t=>{const e=t.getContext("webgl",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"});if(!e)throw new Error("No WebGL Support");return e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),L(t)})(P),O=async t=>new Promise((e=>{const n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=()=>e(n)}));(async()=>{const t=await O(I),e=R(k),n=F.addAnimation(e,t,0,{zoom:2}),o=await O(C),r=R(U),a=F.addAnimation(r,o,1,{zoom:2.4,panX:-.3,panY:.1,zIndex:2}),i=P.getBoundingClientRect();P.width=i.width*window.devicePixelRatio,P.height=i.height*window.devicePixelRatio,n.startTrack("Waterrad"),n.startTrack("Waterrad2"),n.startTrack("Rook"),a.startTrack("Eye blink"),a.startTrack("Talking");const[s,u]=document.querySelectorAll("button");let l=!0,c=!0;u.addEventListener("click",(()=>{c=!c,u.innerText=c?"Stop wheel":"Start wheel",c?(n.startTrack("Waterrad"),n.startTrack("Waterrad2")):(n.stopTrack("Waterrad"),n.stopTrack("Waterrad2"))})),s.addEventListener("click",(()=>{l=!l,s.innerText=l?"Stop smoke":"Start smoke",l?n.startTrack("Rook"):n.stopTrack("Rook")}));let m=[0,0],h=[0,0];const f=[.145,.385];P.addEventListener("click",(t=>{const e=P.getBoundingClientRect(),n=[t.x/e.width,t.y/e.height];m=[Math.min(1,Math.max(-1,(n[0]-f[0])/.4)),Math.min(1,Math.max(-1,(n[1]-f[1])/.4))]}));const p=.025,d=()=>{h[0]!==m[0]&&(h[0]<m[0]?h[0]+=Math.min(p,m[0]-h[0]):h[0]-=Math.min(p,h[0]-m[0])),h[1]!==m[1]&&(h[1]<m[1]?h[1]+=Math.min(p,m[1]-h[1]):h[1]-=Math.min(p,h[1]-m[1])),a.setControlValue("RightEye-x",h[0]+1),a.setControlValue("LeftEye-x",h[0]+1),a.setControlValue("RightEye-y",.5*(h[1]+1)),a.setControlValue("LeftEye-y",.5*(h[1]+1)),F.render(),n.render(),a.render(),window.requestAnimationFrame(d)};window.requestAnimationFrame(d)})();
//# sourceMappingURL=index.bbf9d7fc.js.map
