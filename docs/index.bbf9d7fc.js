function t(t){return t&&t.__esModule?t.default:t}var e,n,r,a,o=!1;function i(t,e,n,r){const a=t-n,o=e-r;return a*a+o*o}function s(t,e,n,r,a,o){const i=(r-e)*(a-t),s=(n-t)*(o-e);return Math.abs(i-s)>=33306690738754716e-32*Math.abs(i+s)?i-s:0}function u(t,e,n,r,a,o){return(s(a,o,t,e,n,r)||s(t,e,n,r,a,o)||s(n,r,a,o,t,e))<0}function l(t,e,n,r,a,o,i,s){const u=t-i,l=e-s,c=n-i,h=r-s,m=a-i,d=o-s,f=c*c+h*h,p=m*m+d*d;return u*(h*p-f*d)-l*(c*p-f*m)+(u*u+l*l)*(c*d-h*m)<0}function c(t,e,n,r,a,o){const i=n-t,s=r-e,u=a-t,l=o-e,c=i*i+s*s,h=u*u+l*l,m=.5/(i*l-s*u),d=(l*c-s*h)*m,f=(i*h-u*c)*m;return d*d+f*f}function h(t,e,n,r){if(r-n<=20)for(let a=n+1;a<=r;a++){const r=t[a],o=e[r];let i=a-1;for(;i>=n&&e[t[i]]>o;)t[i+1]=t[i--];t[i+1]=r}else{let a=n+1,o=r;m(t,n+r>>1,a),e[t[n]]>e[t[r]]&&m(t,n,r),e[t[a]]>e[t[r]]&&m(t,a,r),e[t[n]]>e[t[a]]&&m(t,n,a);const i=t[a],s=e[i];for(;;){do{a++}while(e[t[a]]<s);do{o--}while(e[t[o]]>s);if(o<a)break;m(t,a,o)}t[n+1]=t[o],t[o]=i,r-a+1>=o-n?(h(t,e,a,r),h(t,e,n,o-1)):(h(t,e,n,o-1),h(t,e,a,r))}}function m(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function d(t){return t[0]}function f(t){return t[1]}function p(){var t,o,s,m;e={},n=Math.pow(2,-52),r=new Uint32Array(512),a=class t{static from(e,n=d,r=f){const a=e.length,o=new Float64Array(2*a);for(let t=0;t<a;t++){const a=e[t];o[2*t]=n(a),o[2*t+1]=r(a)}return new t(o)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:r,_hullTri:a,_hullHash:o}=this,s=t.length>>1;let l=1/0,m=1/0,d=-1/0,f=-1/0;for(let e=0;e<s;e++){const n=t[2*e],r=t[2*e+1];n<l&&(l=n),r<m&&(m=r),n>d&&(d=n),r>f&&(f=r),this._ids[e]=e}const p=(l+d)/2,g=(m+f)/2;let y,w,M,_=1/0;for(let e=0;e<s;e++){const n=i(p,g,t[2*e],t[2*e+1]);n<_&&(y=e,_=n)}const T=t[2*y],E=t[2*y+1];_=1/0;for(let e=0;e<s;e++){if(e===y)continue;const n=i(T,E,t[2*e],t[2*e+1]);n<_&&n>0&&(w=e,_=n)}let x=t[2*w],N=t[2*w+1],v=1/0;for(let e=0;e<s;e++){if(e===y||e===w)continue;const n=c(T,E,x,N,t[2*e],t[2*e+1]);n<v&&(M=e,v=n)}let V=t[2*M],R=t[2*M+1];if(v===1/0){for(let e=0;e<s;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];h(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let n=0;for(let t=0,r=-1/0;t<s;t++){const a=this._ids[t];this._dists[a]>r&&(e[n++]=a,r=this._dists[a])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(u(T,E,x,N,V,R)){const t=w,e=x,n=N;w=M,x=V,N=R,M=t,V=e,R=n}const A=function(t,e,n,r,a,o){const i=n-t,s=r-e,u=a-t,l=o-e,c=i*i+s*s,h=u*u+l*l,m=.5/(i*l-s*u);return{x:t+(l*c-s*h)*m,y:e+(i*h-u*c)*m}}(T,E,x,N,V,R);this._cx=A.x,this._cy=A.y;for(let e=0;e<s;e++)this._dists[e]=i(t[2*e],t[2*e+1],A.x,A.y);h(this._ids,this._dists,0,s-1),this._hullStart=y;let S=3;r[y]=e[M]=w,r[w]=e[y]=M,r[M]=e[w]=y,a[y]=0,a[w]=1,a[M]=2,o.fill(-1),o[this._hashKey(T,E)]=y,o[this._hashKey(x,N)]=w,o[this._hashKey(V,R)]=M,this.trianglesLen=0,this._addTriangle(y,w,M,-1,-1,-1);for(let i,s,l=0;l<this._ids.length;l++){const c=this._ids[l],h=t[2*c],m=t[2*c+1];if(l>0&&Math.abs(h-i)<=n&&Math.abs(m-s)<=n)continue;if(i=h,s=m,c===y||c===w||c===M)continue;let d=0;for(let t=0,e=this._hashKey(h,m);t<this._hashSize&&(d=o[(e+t)%this._hashSize],-1===d||d===r[d]);t++);d=e[d];let f,p=d;for(;f=r[p],!u(h,m,t[2*p],t[2*p+1],t[2*f],t[2*f+1]);)if(p=f,p===d){p=-1;break}if(-1===p)continue;let g=this._addTriangle(p,c,r[p],-1,-1,a[p]);a[c]=this._legalize(g+2),a[p]=g,S++;let _=r[p];for(;f=r[_],u(h,m,t[2*_],t[2*_+1],t[2*f],t[2*f+1]);)g=this._addTriangle(_,c,f,a[c],-1,a[_]),a[c]=this._legalize(g+2),r[_]=_,S--,_=f;if(p===d)for(;f=e[p],u(h,m,t[2*f],t[2*f+1],t[2*p],t[2*p+1]);)g=this._addTriangle(f,c,p,-1,a[p],a[f]),this._legalize(g+2),a[f]=g,r[p]=p,S--,p=f;this._hullStart=e[c]=p,r[p]=e[_]=c,r[c]=_,o[this._hashKey(h,m)]=c,o[this._hashKey(t[2*p],t[2*p+1])]=p}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=r[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:a}=this;let o=0,i=0;for(;;){const s=n[t],u=t-t%3;if(i=u+(t+2)%3,-1===s){if(0===o)break;t=r[--o];continue}const c=s-s%3,h=u+(t+1)%3,m=c+(s+2)%3,d=e[i],f=e[t],p=e[h],g=e[m];if(l(a[2*d],a[2*d+1],a[2*f],a[2*f+1],a[2*p],a[2*p+1],a[2*g],a[2*g+1])){e[t]=g,e[s]=d;const a=n[m];if(-1===a){let e=this._hullStart;do{if(this._hullTri[e]===m){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,a),this._link(s,n[i]),this._link(i,m);const u=c+(s+1)%3;o<r.length&&(r[o++]=u)}else{if(0===o)break;t=r[--o]}}return i}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,a,o){const i=this.trianglesLen;return this._triangles[i]=t,this._triangles[i+1]=e,this._triangles[i+2]=n,this._link(i,r),this._link(i+1,a),this._link(i+2,o),this.trianglesLen+=3,i}},t=e,o="default",s=function(){return a},Object.defineProperty(t,o,{get:s,enumerable:!0}),m=e,Object.defineProperty(m,"__esModule",{value:!0})}var g,y=(o||(o=!0,p()),(g=e)&&g.__esModule?g.default:g);const w=t=>"folder"===t.type||"sprite"===t.type,M=(t,e,n=[])=>{for(let r of t){e(r,n);for(let t of r.mutationVectors)e(t,[...n,r]);"folder"===r.type&&M(r.items,e,[...n,r])}},_=t=>t.reduce(((t,e)=>t.concat(e)),[]),T=t=>({data:new Float32Array(_(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),E=t=>({data:new Int16Array(_(t)),length:t.length,stride:void 0===t[0]?0:t[0].length}),x={translate:1,stretch:2,rotate:3,deform:4,opacity:5},N=(t,e)=>{const n=t[t.length-1];if(w(n)){const r=e?n.mutationVectors.indexOf(e):-1;if(r>0)return n.mutationVectors[r-1];for(let n=t.length-(e?2:1);n>=0;n--){const e=t[n];if(e&&w(e)&&e.mutationVectors.length>0)return e.mutationVectors[e.mutationVectors.length-1]}}return null},v=t=>{const e=t.controls.map((t=>t.name));return t.animations.map((t=>{const n=[];return t.keyframes.reduce(((t,e)=>t.concat(Object.keys(e.controlValues))),[]).filter(((t,e,n)=>n.indexOf(t)===e)).forEach((r=>{const a=[];t.keyframes.forEach((t=>{const e=t.controlValues[r];void 0!==e&&a.push([t.time,e])})),n.push([e.indexOf(r),new Float32Array(_(a))])})),{name:t.name,looping:t.looping,duration:t.keyframes[t.keyframes.length-1].time,tracks:n}}))};var V=t=>{const e=[],n=[],r=[];M(t.shapes,(t=>{if("sprite"!==t.type)return;const a=(t=>{let e=1/0,n=-1/0,r=1/0,a=-1/0;return t.points.forEach((([t,o])=>{e=t<e?t:e,n=t>n?t:n,r=o<r?o:r,a=o>a?o:a})),[(e+n)/2,(r+a)/2]})(t),o=(i=t.points,y.from(i).triangles);var i;const s=[...t.translate,.1*e.length],u=n.length;e.push({name:t.name,start:2*r.length,amount:o.length,mutator:0,x:s[0],y:s[1],z:.001*s[2]-.5}),t.points.forEach((([t,e])=>{n.push([t-a[0],e-a[1],t,e])})),o.forEach((t=>{r.push(t+u)}))}));const a=(t=>{const e=[],n=[],r={};M(t,((t,a)=>{if((t=>"deform"===t.type||"rotate"===t.type||"translate"===t.type||"stretch"===t.type||"opacity"===t.type)(t)){const i=[x[(o=t).type],o.origin[0],o.origin[1],"deform"===o.type||"translate"===o.type?o.radius:-1],s=n.length;n.push(i);const u=N(a,t),l=null===u?-1:e.findIndex((t=>t.name===u.name));e.push({name:t.name,index:s,parent:l}),r[t.name]=l}var o}));const a={};M(t,((t,n)=>{if(w(t)){const r=N(n.concat(t)),o=null===r?-1:e.findIndex((t=>t.name===r.name));a[t.name]=o}}));const o=new Int16Array(n.length);return e.forEach(((t,e)=>{o[e]=t.parent})),{mutatorMapping:r,parentList:o,vectorSettings:n,shapeMutatorMapping:a}})(t.shapes),o=a.parentList.length,i=Object.keys(a.mutatorMapping),s=[],u=new Float32Array(2*o);Object.entries(t.defaultFrame).forEach((([t,e])=>{const n=i.indexOf(t);-1!==n&&(u[2*n]=e[0],u[2*n+1]=e[1])}));const l=[],c=[],h=[];e.forEach((t=>{t.mutator=a.shapeMutatorMapping[t.name]})),e.sort(((t,e)=>(e.z||0)-(t.z||0)));const m=new Float32Array(t.controls.length),d=t.controls.reduce(((e,n,r)=>{const a=n.steps.reduce(((t,e)=>t.concat(Object.keys(e).filter((e=>!t.includes(e))))),[]);return s.push({name:n.name,steps:n.steps.length}),m[r]=t.controlValues[n.name],a.forEach((r=>{const a=i.indexOf(r),o=n.steps.map((t=>t[r])),s=t?.controls?.findIndex?.((t=>t.name===n.name))||0,u={name:n.name,controlIndex:s,valueStartIndex:l.length,values:o,stepType:0};l.push(...o),e={...e,[a]:{controls:((e[a]||{}).controls||[]).concat(u)}}})),e}),{}),f=Math.max(...Object.keys(d).map((t=>parseInt(t,10))));h.length=f,h.fill([0,0]);let p=0;return Object.entries(d).forEach((([t,e])=>{const n=e.controls.map((t=>[t.valueStartIndex,t.controlIndex,t.stepType]));h[parseInt(t,10)]=[c.length,n.length],p=Math.max(p,n.length),c.push(...n)})),{mutators:T(a.vectorSettings),mutatorParents:{data:a.parentList,length:a.parentList.length,stride:1},mutationValues:{data:u,length:a.parentList.length,stride:2},controlMutationValues:T(l),mutationValueIndices:E(c),controlMutationIndices:E(h),defaultControlValues:m,shapeVertices:T(n),shapeIndices:new Uint16Array(r),shapes:e,controls:s,maxIteration:p,animations:v(t)}};const R=(t,e,n=0)=>{for(let r=0;r<t.length;r+=2)if(t[r]>e){const a=r>1?t[r-2]:0,o=r>1?t[r-1]:n,i=(e-a)/(t[r]-a);return o*(1-i)+t[r+1]*i}return t[t.length-1]},A={zoom:1,panX:0,panY:0};const S=t=>{const e=t.getContext("webgl2",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"}),n=[];return{render:()=>{e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,t.width,t.height)},addAnimation:(r,a,o,i)=>{const s=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7,e.TEXTURE8,e.TEXTURE9][o],[u,l,c]=((t,e)=>{const n=t.createProgram();if(!n)throw new Error("Failed to create shader program");const r=(t=>{return`\n  uniform vec2 viewport;\n  uniform vec3 basePosition;\n  uniform vec3 translate;\n  uniform float mutation;\n  uniform vec4 scale;\n\n  attribute vec2 coordinates;\n  attribute vec2 aTextureCoord;\n\n  varying lowp vec2 vTextureCoord;\n  varying lowp float vOpacity;\n\n  mat4 viewportScale = mat4(\n    2.0 / viewport.x, 0, 0, 0,   \n    0, -2.0 / viewport.y, 0, 0,    \n    0, 0, 1, 0,    \n    -1, +1, 0, 1\n  );\n\n  ${(t=>`\n  uniform vec2 uControlMutationValues[${t.controlMutationValues.length}];\n  uniform vec3 uMutationValueIndices[${t.mutationValueIndices.length}];\n  uniform vec2 uControlMutationIndices[${t.controlMutationIndices.length}];\n\n  uniform float uControlValues[${t.controls.length}];\n  uniform vec2 uMutationValues[${t.mutators.length}];\n\n  vec2 getMutationValue(int mutationIndex, int mutationType) {\n    vec2 result = uMutationValues[mutationIndex];\n    vec2 controlMutations = uControlMutationIndices[mutationIndex];\n    int start = int(controlMutations.x);\n    int steps = int(controlMutations.y);\n    if (steps == 0) {\n      return result;\n    }\n    for(int i = 0; i < ${t.maxIteration}; i++) {\n      if (i < steps) {\n        vec3 valueIndices = uMutationValueIndices[start + i];\n        // x = offset\n        // y = control value index\n        // z = stepType\n        float controlValue = uControlValues[int(valueIndices.y)];\n\n        int startIndex = int(floor(valueIndices.x + controlValue));\n        int endIndex = int(ceil(valueIndices.x + controlValue));\n        float mixFactor = controlValue - floor(controlValue);\n\n        vec2 mutAValue = uControlMutationValues[startIndex];\n        vec2 mutBValue = uControlMutationValues[endIndex];\n        vec2 mutValue = mix(mutAValue, mutBValue, mixFactor);\n\n        if (mutationType == 2 || mutationType == 5) { // Stretch & Opacity\n          result *= mutValue;\n        } else {\n          result += mutValue;\n        }\n      } else {\n        return result;\n      }\n    }\n\n    return result;\n  }\n`)(t)}\n  ${e=t.mutators.length,`\n  #define PI_FRAC 0.017453292519943295\n\n  // x = type, yz = origin, a = radius\n  uniform vec4 uMutationVectors[${e}];\n  uniform float uMutationParent[${e}];\n\n  vec3 mutateOnce(vec3 startValue, int mutationIndex) {\n    vec4 mutation = uMutationVectors[mutationIndex];\n    int mutationType = int(mutation.x);\n\n    vec2 mutationValue = getMutationValue(mutationIndex, mutationType);\n    vec2 origin = mutation.yz;\n    vec3 result = startValue;\n\n    if (mutationType == 1) { // Translate\n      float effect = 1.0;\n      if (mutation.a > 0.0 && distance(startValue.xy, origin) > mutation.a) {\n        effect = 0.0;\n      }\n      result = vec3(startValue.xy + mutationValue * effect, startValue.z);\n    }\n\n    if (mutationType == 2) { // Stretch\n      result = vec3(origin.xy + vec2(\n        (startValue.x - origin.x) * mutationValue.x, \n        (startValue.y - origin.y) * mutationValue.y\n      ), startValue.z);\n    }\n\n    if (mutationType == 3) { // Rotation\n      float rotation = mutationValue.x * PI_FRAC;\n      mat2 entityRotationMatrix = mat2(cos(rotation), sin(rotation), -sin(rotation), cos(rotation));\n      result = vec3((startValue.xy - origin) * entityRotationMatrix + origin, startValue.z);\n    }\n\n    if (mutationType == 4) { // Deform\n      float effect = 1.0 - clamp(distance(startValue.xy, origin), 0.0, mutation.a) / mutation.a;\t\n      result = vec3(startValue.xy + mutationValue * effect, startValue.z);\t\n    }\n\n    if (mutationType == 5) { // Opacity\n      float opacity = mutationValue.x;\n      result = vec3(startValue.xy, startValue.z * opacity);\t\n    }\n\n    return result;\n  }\n\n  vec3 mutatePoint(vec3 startValue, int mutationIndex) {\n    int currentNode = mutationIndex;\n    vec3 result = startValue;\n\n    for(int i = 0; i < ${e}; i++) {\n        if (currentNode == -1) {\n            return result;\n        }\n        result = mutateOnce(result, currentNode);\n        currentNode = int(uMutationParent[currentNode]);\n    }\n    return result;\n  }\n\n`}\n\n  void main() {\n    vec3 deform = mutatePoint(vec3(coordinates + translate.xy, 1.0), int(mutation));\n\n    vec4 pos = viewportScale * vec4((deform.xy + basePosition.xy) * scale.x, translate.z, 1.0);\n    gl_Position = vec4((pos.xy + scale.ba) * scale.y, pos.z, 1.0);\n    vTextureCoord = aTextureCoord.xy;\n    vOpacity = deform.z;\n  }\n`;var e})(e),a=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER);if(!a||!o)throw t.deleteProgram(n),t.deleteShader(a),t.deleteShader(o),new Error("Failed to create shader program");if(t.shaderSource(a,r),t.shaderSource(o,"\nprecision mediump float;\n\nvarying mediump vec2 vTextureCoord;\nvarying mediump float vOpacity;\nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord = vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 texelColor = texture2D(uSampler, coord);\n\n  gl_FragColor = vec4(texelColor.rgb * texelColor.a * vOpacity, texelColor.a * vOpacity);\n}\n"),t.compileShader(a),t.compileShader(o),t.attachShader(n,a),t.attachShader(n,o),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw console.error("Link failed: "+t.getProgramInfoLog(n)),console.error("vs info-log: "+t.getShaderInfoLog(a)),console.error("fs info-log: "+t.getShaderInfoLog(o)),new Error("Could not initialise shaders");return[n,a,o]})(e,r);e.useProgram(u);const h=((t,e,n,r)=>{const a=t.createTexture();return t.activeTexture(r),t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.useProgram(e),t.uniform2f(t.getUniformLocation(e,"uTextureDimensions"),n.width,n.height),t.uniform1i(t.getUniformLocation(e,"uSampler"),r),a})(e,u,a,s),m=((t,e)=>(n,r)=>{const a=t.getUniformLocation(e,n),o=r.stride;1==o?t.uniform1fv(a,r.data):2==o?t.uniform2fv(a,r.data):3==o?t.uniform3fv(a,r.data):4==o&&t.uniform4fv(a,r.data)})(e,u);m("uMutationVectors",r.mutators),m("uMutationParent",r.mutatorParents),m("uMutationValues",r.mutationValues),m("uControlMutationValues",r.controlMutationValues),m("uMutationValueIndices",r.mutationValueIndices),m("uControlMutationIndices",r.controlMutationIndices);const d=e.getUniformLocation(u,"uControlValues");e.uniform1fv(d,r.defaultControlValues);const f=new Float32Array(r.defaultControlValues),p=new Float32Array(r.defaultControlValues),g=e.createBuffer(),y=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,g),e.bufferData(e.ARRAY_BUFFER,r.shapeVertices.data,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,y),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.shapeIndices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);const w=e.getUniformLocation(u,"basePosition"),M=e.getUniformLocation(u,"translate"),_=e.getUniformLocation(u,"mutation"),T=e.getUniformLocation(u,"viewport"),E=e.getUniformLocation(u,"scale"),x=e.getAttribLocation(u,"coordinates"),N=e.getAttribLocation(u,"aTextureCoord");let v=0,V=0,S=[0,0,.1],I=1,{zoom:b,panX:k,panY:U}={...A,...i};const P=[],F=r.animations.map((t=>t.name)),L=r.animations.map((t=>t.looping)),C={destroy:function(){e.deleteShader(l),e.deleteShader(c),e.deleteProgram(u),e.deleteTexture(h),e.deleteBuffer(g),e.deleteBuffer(y),n.splice(n.indexOf(C),1)},setLooping:function(t,e){const n=F.indexOf(e);if(-1===n)throw new Error(`Track ${e} does not exist in ${F.join(",")}`);L[n]=t},startTrack:function(t){const e=F.indexOf(t);if(-1===e)throw new Error(`Track ${t} does not exist in ${F.join(",")}`);P.push({name:t,index:e,startAt:0,startedAt:+new Date})},stopTrack:t=>{const e=P.findIndex((e=>e.name===t));if(-1===e)return;const n=P[e];let a=+new Date-n.startedAt+n.startAt;const o=r.animations[n.index];L[n.index]&&(a%=o.duration),P.splice(e,1);for(let[t,e]of o.tracks){const n=R(e,a,f[t]);f[t]=n}},setControlValue:()=>{},setPanning:function(t,e){k=t,U=e},setZoom:function(t){b=t},render:function(){if(e.useProgram(u),e.bindBuffer(e.ARRAY_BUFFER,g),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,y),e.vertexAttribPointer(x,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),e.enableVertexAttribArray(x),e.vertexAttribPointer(N,2,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,2*Float32Array.BYTES_PER_ELEMENT),e.enableVertexAttribArray(N),t.width!==v||t.height!==V){const n=t.width,r=t.height,o=a.width/n>a.height/r;I=o?n/a.width:r/a.height,e.uniform2f(T,n,r),S=[n/2/I,r/2/I,.1],v=t.width,V=t.height}e.uniform4f(E,I,b,k,U),e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,h),e.uniform3f(w,S[0],S[1],S[2]);const n=+new Date;for(let t of P){const e=n-t.startedAt+t.startAt,a=r.animations[t.index];if(a.duration<e&&!L[t.index]){for(let[t,n]of a.tracks){const r=R(n,e,f[t]);p[t]=r}continue}const o=e%a.duration;for(let[t,e]of a.tracks){const n=R(e,o,f[t]);p[t]=n}}e.uniform1fv(d,p);for(let t of r.shapes)e.uniform3f(M,t.x,t.y,t.z),e.uniform1f(_,t.mutator),e.drawElements(e.TRIANGLES,t.amount,e.UNSIGNED_SHORT,t.start)},onTrackStopped:function(){return()=>{}},onEvent:function(){return()=>{}},onControlChange:function(){return()=>{}}};return n.push(C),C},destroy:function(){for(let t of n)t.destroy();n.length=0}}};var I=null;var b=t(function(){return I||(I=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),I}()+"landscape.01ccf7de.png"),k=t(JSON.parse('{"animations":[{"name":"Waterrad","looping":true,"keyframes":[{"time":0,"controlValues":{"New Control":1,"Rad":1}},{"time":12000,"controlValues":{"New Control":0,"Rad":0}}]},{"name":"Waterrad2","looping":true,"keyframes":[{"time":0,"controlValues":{"Schoepen":0}},{"time":1000,"controlValues":{"Schoepen":1}}]},{"name":"Rook","looping":true,"keyframes":[{"time":0,"controlValues":{"Rook":0}},{"time":4999,"controlValues":{"Rook":2}}]}],"controlValues":{"New Control":0,"Rook":0,"Schoepen":1,"Rad":1},"controls":[{"name":"Rook","type":"slider","steps":[{"New Mutator (10)":[0,0],"New Mutator (9)":[0,0],"New Mutator (12)":[22,0],"New Mutator (11)":[0,0],"New Mutator (8)":[-23,0]},{"New Mutator (10)":[0,-100],"New Mutator (9)":[28,0],"New Mutator (12)":[-27,0],"New Mutator (11)":[-38,0],"New Mutator (8)":[47,0]},{"New Mutator (10)":[0,-216],"New Mutator (9)":[0,0],"New Mutator (12)":[22,0],"New Mutator (11)":[0,0],"New Mutator (8)":[-23,0]}]},{"name":"Schoepen","type":"slider","steps":[{"New Mutator (20)":[0,0],"New Mutator (17)":[0,0],"New Mutator (19)":[0,0],"New Mutator (18)":[0,0],"New Mutator (3)":[1,1],"New Mutator (7)":[0,0],"New Mutator (15)":[1,1],"New Mutator (16)":[0,0],"New Mutator (22)":[1,0.05],"New Mutator (21)":[0,0],"New Mutator (23)":[20,-35]},{"New Mutator (20)":[-43,-62],"New Mutator (17)":[72,0],"New Mutator (19)":[-36,-28],"New Mutator (18)":[69,0],"New Mutator (3)":[1,0.7],"New Mutator (7)":[-10,-91],"New Mutator (15)":[1,0.05],"New Mutator (16)":[0,0],"New Mutator (22)":[1,-0.6],"New Mutator (21)":[25,-88],"New Mutator (23)":[-3,0]}]},{"name":"Rad","type":"slider","steps":[{"New Mutator (1)":[0,0],"New Mutator (6)":[0,0]},{"New Mutator (1)":[360,0],"New Mutator (6)":[360,0]}]}],"defaultFrame":{"New Mutator":[0.45,1],"New Mutator (1)":[0,0],"New Mutator (2)":[0.5,1],"New Mutator (4)":[0.5,1],"New Mutator (5)":[0.45,1],"New Mutator (6)":[0,0],"New Mutator (17)":[84,0],"New Mutator (18)":[0,-3],"New Mutator (19)":[0,0],"New Mutator (3)":[1,1],"New Mutator (15)":[1,0.8],"New Mutator (16)":[63,0],"New Mutator (22)":[1,1],"New Mutator (10)":[0,0],"New Mutator (8)":[0,0],"New Mutator (11)":[0,0],"New Mutator (12)":[0,0],"New Mutator (9)":[0,0]},"shapes":[{"type":"sprite","points":[[3101,119],[3107,588],[2698,557],[2692,114]],"translate":[-214,-14],"mutationVectors":[],"name":"WheelHouse"},{"name":"Watermolen","type":"folder","items":[{"name":"Waterrad","type":"sprite","points":[[24,408],[384,408],[24,768],[384,768]],"translate":[-169,14],"mutationVectors":[{"type":"stretch","origin":[-181,14],"name":"New Mutator"},{"type":"rotate","origin":[-169,14],"name":"New Mutator (1)"}]},{"name":"Waterrad2","type":"sprite","points":[[24,24],[384,24],[24,384],[384,384]],"translate":[-187,15],"mutationVectors":[{"type":"stretch","origin":[-173,14],"name":"New Mutator (2)"}]},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-293,-14],"mutationVectors":[{"name":"New Mutator (21)","type":"translate","origin":[-15,-67]},{"type":"stretch","origin":[-291,12],"name":"New Mutator (22)"}],"name":"Schoep (1) (1)"},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-282,74],"mutationVectors":[{"name":"New Mutator (7)","type":"translate","origin":[-6,4]},{"type":"stretch","origin":[-283,102],"name":"New Mutator (15)"},{"type":"deform","origin":[-316,37],"name":"New Mutator (16)","radius":68}],"name":"Schoep (2)"},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-264,130],"mutationVectors":[{"name":"New Mutator (20)","type":"translate","origin":[-6,4]},{"type":"stretch","origin":[-268,156],"name":"New Mutator (3)"},{"type":"deform","origin":[-272,107],"name":"New Mutator (17)","radius":86}],"name":"Schoep (1)"},{"name":"Schoep","type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-213,162],"mutationVectors":[{"name":"New Mutator (19)","type":"translate","origin":[-6,4]},{"type":"deform","origin":[-216,131],"name":"New Mutator (18)","radius":76}]},{"type":"sprite","points":[[455,1143],[455,1197],[335,1143],[335,1196]],"translate":[-205,159],"mutationVectors":[{"name":"New Mutator (23)","type":"translate","origin":[-6,4]}],"name":"Schoep (1) (2)"},{"name":"Waterrad (1)","type":"sprite","points":[[24,408],[384,408],[24,768],[384,768]],"translate":[-268,12],"mutationVectors":[{"type":"stretch","origin":[-274,12],"name":"New Mutator (5)"},{"type":"rotate","origin":[-268,12],"name":"New Mutator (6)"}]},{"name":"Waterrad2 (1)","type":"sprite","points":[[24,24],[384,24],[24,384],[384,384]],"translate":[-274,12],"mutationVectors":[{"type":"stretch","origin":[-281,9],"name":"New Mutator (4)"}]}],"mutationVectors":[]},{"type":"sprite","points":[[23,1265],[847,1273],[38,1915],[813,1912]],"translate":[-449,-87],"mutationVectors":[],"name":"House"},{"type":"sprite","points":[[97,790],[167,790],[244,789],[245,1178],[168,1176],[95,1176],[27,1176],[26,792],[26,825],[27,894],[25,960],[25,1030],[25,1093],[96,1143],[96,1068],[95,993],[95,925],[95,862],[167,822],[167,893],[166,964],[167,1035],[167,1115],[245,1083],[244,1000],[243,924],[241,856]],"translate":[-425,-348],"mutationVectors":[{"type":"deform","origin":[-478,-407],"name":"New Mutator (8)","radius":40},{"type":"deform","origin":[-386,-485],"name":"New Mutator (11)","radius":41},{"type":"deform","origin":[-473,-508],"name":"New Mutator (12)","radius":36},{"type":"deform","origin":[-385,-404],"name":"New Mutator (9)","radius":31},{"name":"New Mutator (10)","type":"translate","origin":[-5,0],"radius":-1}],"name":"Rook"},{"name":"Base Image","type":"sprite","points":[[710,-2],[712,1084],[2621,1086],[2621,2]],"translate":[0,0],"mutationVectors":[]}]}'));const U=document.getElementById("theatre"),P=(t=>{const e=t.getContext("webgl2",{premultipliedalpha:!0,depth:!0,antialias:!0,powerPreference:"low-power"});if(!e)throw new Error("No WebGL Support");return e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),S(t)})(U);(async()=>{const t=await(async t=>new Promise((e=>{const n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=()=>e(n)})))(b),e=V(k),n=P.addAnimation(e,t,0,{zoom:2}),r=U.getBoundingClientRect();U.width=r.width*window.devicePixelRatio,U.height=r.height*window.devicePixelRatio,n.startTrack("Waterrad"),n.startTrack("Waterrad2"),n.startTrack("Rook");const[a,o]=document.querySelectorAll("button");let i=!0,s=!0;o.addEventListener("click",(()=>{s=!s,o.innerText=s?"Stop wheel":"Start wheel",s?(n.startTrack("Waterrad"),n.startTrack("Waterrad2")):(n.stopTrack("Waterrad"),n.stopTrack("Waterrad2"))})),a.addEventListener("click",(()=>{i=!i,a.innerText=i?"Stop smoke":"Start smoke",i?n.startTrack("Rook"):n.stopTrack("Rook")}));const u=()=>{P.render(),n.render(),window.requestAnimationFrame(u)};window.requestAnimationFrame(u)})();
//# sourceMappingURL=index.bbf9d7fc.js.map
